"use strict";(self.webpackChunkvintage_machine=self.webpackChunkvintage_machine||[]).push([[743],{1039:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".vVgLniZGJcn5HHLg4g_e {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  background: #007;\n  overflow: hidden;\n  display: grid;\n  place-items: center;\n  padding: 0;\n}\n\n.vVgLniZGJcn5HHLg4g_e > canvas {\n  border: none;\n  box-shadow: none;\n  background: transparent;\n  height: 100%;\n}\n",""]),o.locals={panelMonitor:"vVgLniZGJcn5HHLg4g_e"};const a=o},1057:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".CL1VFo0EzgJYCRpYRaZ8 {\n}\n",""]),o.locals={editor:"CL1VFo0EzgJYCRpYRaZ8"};const a=o},1212:(e,t,n)=>{e.exports=n.p+"fnt/bangers.f0f1f39c39ee2df57fd7.ttf"},1240:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".uOeVlr9ph9XwxMH2Dewg {\n  --custom-ratio1: 1fr;\n  --custom-ratio2: 1fr;\n  display: grid;\n  grid-template-rows: var(--custom-ratio1) var(--custom-ratio2);\n  width: 100%;\n  height: 100%;\n}\n\n.uOeVlr9ph9XwxMH2Dewg > div.F9U5vPJTaCaM37DfvcLt {\n  position: relative;\n  min-height: 0;\n}\n",""]),o.locals={splitVertical:"uOeVlr9ph9XwxMH2Dewg",container:"F9U5vPJTaCaM37DfvcLt"};const a=o},1343:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".UdUM3C1SFkVhXUrt9EQT {\n}\n",""]),o.locals={workBench:"UdUM3C1SFkVhXUrt9EQT"};const a=o},1945:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".inouPEQJqnUd6bbpZ3yg {\n}\n",""]),o.locals={menu:"inouPEQJqnUd6bbpZ3yg"};const a=o},3453:(e,t,n)=>{n.d(t,{A:()=>d});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i),a=n(4417),l=n.n(a),c=new URL(n(1212),n.b),u=o()(r()),h=l()(c);u.push([e.id,`/* vietnamese */\n@font-face {\n  font-family: bangers;\n  font-style: normal;\n  font-weight: 400;\n  font-display: swap;\n  src: url(${h}) format("woff2");\n  unicode-range:\n    U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1,\n    U+01AF-01B0, U+0300-0301, U+0303-0304, U+0308-0309, U+0323, U+0329,\n    U+1EA0-1EF9, U+20AB;\n}\n/* latin-ext */\n@font-face {\n  font-family: bangers;\n  font-style: normal;\n  font-weight: 400;\n  font-display: swap;\n  src: url(${h}) format("woff2");\n  unicode-range:\n    U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304,\n    U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB,\n    U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;\n}\n/* latin */\n@font-face {\n  font-family: bangers;\n  font-style: normal;\n  font-weight: 400;\n  font-display: swap;\n  src: url(${h}) format("woff2");\n  unicode-range:\n    U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC,\n    U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212,\n    U+2215, U+FEFF, U+FFFD;\n}\n`,""]);const d=u},6717:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".bYFbQ007eyAlPkKJJ640 blockquote {\n  font-family: bangers;\n  color: var(--theme-color-on-neutral-9-7);\n  background: var(--theme-color-neutral-9);\n  border-radius: 2em;\n  padding: 0.5em 1em;\n  box-shadow: 0 0 0.25em #000;\n  letter-spacing: 0.1em;\n  line-height: 1.4;\n}\n\n.bYFbQ007eyAlPkKJJ640 blockquote > p {\n  margin: 0;\n}\n\ndiv.sju8Tw3U10wXcjzW6uyM {\n  cursor: pointer;\n}\n\ndiv.sju8Tw3U10wXcjzW6uyM pre {\n  white-space: pre-wrap;\n  background: transparent;\n  color: #fff;\n}\n",""]),o.locals={panelManual:"bYFbQ007eyAlPkKJJ640",error:"sju8Tw3U10wXcjzW6uyM"};const a=o},6865:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".oPcl6WEWmddsJUpEd2uV {\n  color: #fff;\n  background: #333;\n}\n",""]),o.locals={panelEditor:"oPcl6WEWmddsJUpEd2uV"};const a=o},8743:(e,t,n)=>{n.r(t),n.d(t,{default:()=>st});var s=n(4848),r=n(5968),i=n(5072),o=n.n(i),a=n(7825),l=n.n(a),c=n(7659),u=n.n(c),h=n(5056),d=n.n(h),p=n(540),f=n.n(p),m=n(1113),g=n.n(m),v=n(1343),y={};y.styleTagTransform=g(),y.setAttributes=d(),y.insert=u().bind(null,"head"),y.domAPI=l(),y.insertStyleElement=f(),o()(v.A,y);const x=v.A&&v.A.locals?v.A.locals:void 0;var b=n(9384),E={};E.styleTagTransform=g(),E.setAttributes=d(),E.insert=u().bind(null,"head"),E.domAPI=l(),E.insertStyleElement=f(),o()(b.A,E);const A=b.A&&b.A.locals?b.A.locals:void 0,w=r.Sxu.classNames;function I({className:e,children:[t,n]}){return(0,s.jsxs)("div",{className:w.join(e,A.splitHorizontal),children:[(0,s.jsx)("div",{className:A.container,children:t}),(0,s.jsx)("div",{className:A.container,children:n})]})}var C=n(1240),S={};S.styleTagTransform=g(),S.setAttributes=d(),S.insert=u().bind(null,"head"),S.domAPI=l(),S.insertStyleElement=f(),o()(C.A,S);const F=C.A&&C.A.locals?C.A.locals:void 0,T=r.Sxu.classNames;function N({className:e,children:[t,n]}){return(0,s.jsxs)("div",{className:T.join(e,F.splitVertical),children:[(0,s.jsx)("div",{className:F.container,children:t}),(0,s.jsx)("div",{className:F.container,children:n})]})}var R=n(6865),_={};_.styleTagTransform=g(),_.setAttributes=d(),_.insert=u().bind(null,"head"),_.domAPI=l(),_.insertStyleElement=f(),o()(R.A,_);const k=R.A&&R.A.locals?R.A.locals:void 0;var P=n(1945),U={};U.styleTagTransform=g(),U.setAttributes=d(),U.insert=u().bind(null,"head"),U.domAPI=l(),U.insertStyleElement=f(),o()(P.A,U);const L=P.A&&P.A.locals?P.A.locals:void 0;var O=n(4865);class ${constructor(e,t){this.gl=e,this.screenWidthInverse=2/t.screenWidth,this.screenHeightInverse=2/t.screenHeight,this.texture=t.symbols;const n=new O.a6X(e,{vert:"// attPosition.x is +1 or -1\n// attPosition.y is +1 or -1\nattribute vec2 attPos;\n// UV coordinates are either 0 or 1.\nattribute vec2 attUV;\n\n// Double of the inverse of screen width/height in pixels.\nuniform vec2 uniScreenSizeInverse;\n// Screen coordinates of the center, in pixels.\n// The center of the screen is at (0,0).\nuniform vec2 uniCenter;\n// Size of the symbol in pixels divided by 256;\nuniform vec2 uniSymbolSize;\n// Position of the top left corner of the symbol,\n// expressed in pixels divided by 256.\nuniform vec2 uniSymbolCorner;\n// Scale of a symbol.\nuniform float uniScale;\n\nvarying vec2 varUV;\n\nvoid main() {\n    vec2 center = uniCenter * uniScreenSizeInverse;\n    vec2 point = 128.0 * uniSymbolSize * attPos;   // Later, we will add rotation and scale.\n    gl_Position = vec4(center + point * uniScale * uniScreenSizeInverse, 0.0, 1.0);\n    varUV = uniSymbolCorner + uniSymbolSize * attUV;\n}\n",frag:"precision mediump float;\n\n// The symbols' page.\nuniform sampler2D texSymbols;\nuniform float uniColor;\n\n// Coords of the current pixel. (0,0) is le left bottom one and (1,1) is the upper right one.\nvarying vec2 varUV;\n\nvoid main() {\n  float alpha = texture2D( texSymbols, varUV ).a;\n  if (alpha < 0.5) discard;\n  \n  gl_FragColor = vec4( vec3(uniColor), 1.0);\n//   if (varUV.x < 32.0 / 256.0) {\n//     gl_FragColor = vec4(0, 1, 0, 1);\n//   } else {\n//     gl_FragColor = vec4(1, 0, 0, 1);\n//   }\n}\n"});this.prg=n;const s=new O.I9j({attPos:"vec2",attUV:"vec2"});s.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),s.set("attUV",new Float32Array([0,1,0,0,1,1,1,0]));const r=new O.ZV_(e,n,[s]);this.vao=r}delete(){this.texture.delete(),this.prg.delete(),this.vao.delete()}paint({screenX:e,screenY:t,symbolX:n,symbolY:s,width:r=16,height:i=16,colorIndex:o,scale:a=1}){const{gl:l,prg:c,vao:u,texture:h,screenWidthInverse:d,screenHeightInverse:p}=this;c.use(),h.activate(0,c,"texSymbols"),c.uniform1f("uniScale",a),c.uniform1f("uniColor",o/255),c.uniform2f("uniScreenSizeInverse",d,p),c.uniform2f("uniCenter",e,t),c.uniform2f("uniSymbolCorner",n/256,s/256),c.uniform2f("uniSymbolSize",r/256,i/256),u.bind(),l.drawArrays(l.TRIANGLE_STRIP,0,4),u.unbind()}}class j extends O.tbm{constructor(e,t,n){super(),this.context=e,this.textureRead=t,this.action=n;const s=new O.dLJ({varying:{varUV:"vec2"},attributes:{attPos:"vec2",attUV:"vec2"},mainCode:["varUV = attUV;","gl_Position = vec4(attPos, 0.0, 1.0);"]}).code,r=new O.NI6({varying:{varUV:"vec2"},uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["float colorIndex = texture(uniTexture, varUV).r;","FragColor = vec4(colorIndex, 0.0, 0.0, 1.0);"]}).code,i=new O.a6X(e.gl,{vert:s,frag:r});this.prg=i;const o=new O.I9j({attPos:"vec2",attUV:"vec2"});o.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),o.set("attUV",new Float32Array([0,1,0,0,1,1,1,0]));const a=new O.ZV_(e.gl,i,[o]);this.vao=a}delete(){this.prg.delete(),this.vao.delete()}paint(){const{context:e,prg:t,vao:n,textureRead:s}=this,{gl:r}=e;t.use(),s.activate(0,t,"uniTexture"),n.bind(),r.drawArrays(r.TRIANGLE_STRIP,0,4),n.unbind(),this.action()}}class M extends O.tbm{constructor(e,t,n,s){super(),this.surface=new j(e,t,s),this.framebuffer=new O.K7(e,{textureColor0:n,children:[this.surface]})}delete(){this.surface.delete(),this.framebuffer.delete()}paint(e,t){this.framebuffer.paint(e,t)}}class B{constructor(e){this.context=e,this.action=H,this.currentFramebufferIndex=0,this.applyAction=()=>{this.action()};const t=new O.HTX(e),n=new O.HTX(e);this.textures=[t,n];for(const e of this.textures)e.setParams({magFilter:"NEAREST",minFilter:"NEAREST",wrapS:"REPEAT",wrapT:"REPEAT"});const s=this.applyAction;this.framebuffers=[new M(e,n,t,s),new M(e,t,n,s)]}get texture(){return this.textures[this.currentFramebufferIndex]}swap(){this.currentFramebufferIndex=1-this.currentFramebufferIndex}delete(){for(const e of this.textures)e.delete();for(const e of this.framebuffers)e.delete()}paint(e=H){this.swap(),this.action=e,this.framebuffers[this.currentFramebufferIndex].paint(0,0)}}const H=()=>{};class V{constructor(e,t){this.context=e,this.texturePalette=t;const n=new O.dLJ({varying:{varUV:"vec2"},attributes:{attPos:"vec2",attUV:"vec2"},mainCode:["varUV = attUV;","gl_Position = vec4(attPos, 0.0, 1.0);"]}).code,s=new O.NI6({varying:{varUV:"vec2"},uniforms:{uniTexture:"sampler2D",uniPalette:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["vec4 texel = texture(uniTexture, varUV);","float colorIndex = texel.r;","float u = colorIndex + 1.0 / 512.0;","FragColor = texture(uniPalette, vec2(u, 0.5));","if (colorIndex == 0.0) FragColor.a = 0.0;"]}).code,r=new O.a6X(e.gl,{vert:n,frag:s});this.prg=r;const i=new O.I9j({attPos:"vec2",attUV:"vec2"});i.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),i.set("attUV",new Float32Array([0,0,0,1,1,0,1,1]));const o=new O.ZV_(e.gl,r,[i]);this.vao=o}delete(){this.prg.delete(),this.vao.delete()}paint(e){const{context:t,prg:n,vao:s,texturePalette:r}=this,{gl:i}=t;n.use(),e.activate(0,n,"uniTexture"),r.activate(1,n,"uniPalette"),s.bind(),i.drawArrays(i.TRIANGLE_STRIP,0,4),s.unbind()}}var J=n(2197);function X(e,t,n){return s=>{try{return null==t||t(s),n(s)}catch(t){throw new Error(`Erreur de l'instruction "${e.toUpperCase()}": ${t}`)}}}function D(e=1,t=999){return n=>{if((n.length<e||n.length>t)&&e===t){if(0===e)throw new Error("Cette function n'attend aucun argument.");if(1===e)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${e} et ${t} arguments.`)}for(const e of n)if("number"!=typeof e)throw new Error("Tous les arguments de cette fonction doivent Ãªtre des nombres.")}}function W(e=1,t=999){return n=>{if((n.length<e||n.length>t)&&e===t){if(0===e)throw new Error("Cette function n'attend aucun argument.");if(1===e)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${e} et ${t} arguments.`)}for(const e of n)if("string"!=typeof e)throw new Error("Tous les arguments de cette fonction doivent Ãªtre des nombres.")}}function Z(e=0,t=999){return n=>{if((n.length<e||n.length>t)&&e===t){if(0===e)throw new Error("Cette function n'attend aucun argument.");if(1===e)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${e} et ${t} arguments.`)}}}const G=e=>X("cls",D(0,1),(([t])=>{e.paintFB((()=>{if((0,J.Et)(t))return void e.painterRect.paint(0,0,1,1,(0,O.P_T)(Math.round(t),0,255));const{gl:n}=e;n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)})),e.x=e.TEXT_ORIGIN_X,e.y=e.TEXT_ORIGIN_Y,e.paint()})),z=e=>X("color",D(1,1),(([t])=>{e.colorIndex=t})),K=e=>X("disk",D(1,2),(([t,n])=>{e.paintFB((()=>{e.painterDisk.paint(e.screenSpaceX(e.x),e.screenSpaceY(e.y),e.screenSpaceX(t),e.screenSpaceY(null!=n?n:t),e.colorIndex)}))})),Y=e=>X("label",Z(1,2),(([t,n=1])=>{if(!(0,J.Et)(n))throw new Error("Si tu spÃ©cifie un deuxiÃ¨me argument pour LABEL(), il faut que ce soit un nombre.");const{x:s,y:r}=e,i=(0,J.Kg)(t)?t:JSON.stringify(t);let o=e.x-n*(i.length/2)*e.CHAR_SIZE;const a=e.y-n*e.CHAR_SIZE/2;for(const t of i.split(""))e.x=o,e.y=a,e.print(t,n),o+=e.CHAR_SIZE*n;e.x=s,e.y=r})),q=e=>X("locate",D(2,2),(([t,n])=>{const s=(0,O.P_T)(Math.floor(t),0,e.TEXT_COLS-1),r=(0,O.P_T)(Math.floor(n),0,e.TEXT_ROWS-1);e.x=e.TEXT_ORIGIN_X+s*e.CHAR_SIZE,e.y=e.TEXT_ORIGIN_Y+r*e.CHAR_SIZE})),Q=e=>X("move",D(2,2),(([t,n])=>{e.x=t,e.y=n})),ee=e=>X("pause",D(0,1),(([t])=>new Promise((n=>{(0,J.Et)(t)?(e.paint(),globalThis.setTimeout((()=>{console.log("Slept",t,"seconds."),n()}),1e3*t)):globalThis.requestAnimationFrame((()=>{e.paint(),n()}))}))));function te(e,t){const n=t.map((e=>(0,J.Kg)(e)?e:JSON.stringify(e))).join("");e.print(n)}const ne=e=>X("print",Z(),(t=>{te(e,t)})),se=e=>X("println",Z(),(t=>{te(e,t),e.x=e.TEXT_ORIGIN_X,e.y+=e.CHAR_SIZE})),re=e=>X("rect",D(1,2),(([t,n])=>{e.paintFB((()=>{e.painterRect.paint(e.screenSpaceX(e.x),e.screenSpaceY(e.y),e.screenSpaceX(t),e.screenSpaceY(null!=n?n:t),e.colorIndex)}))}));function ie(e,t,n){return s=>{try{return null==t||t(s),n(s)}catch(t){throw new Error(`Erreur de la fonction "${e.toUpperCase()}": ${t}`)}}}const oe=e=>ie("ASK",Z(0),(t=>new Promise((n=>{const s=t.map((e=>(0,J.Kg)(e)?e:JSON.stringify(e))).join("");e.print(s),e.paint();let r="";const i=t=>{if(!(t.ctrlKey||t.altKey||t.metaKey))try{const{key:s}=t;if(1===s.length)return r+=s,void e.print(s);if("Enter"===s)return globalThis.document.removeEventListener("keydown",i),e.x=e.TEXT_ORIGIN_X,e.y+=e.CHAR_SIZE,void n(r);console.log("ðŸš€ [input] key =",s)}finally{e.paint()}};globalThis.document.addEventListener("keydown",i)}))));class ae{constructor(e){this.context=e,this.STEPS=128;const t=new O.dLJ({uniforms:{uniCenter:"vec2",uniRadius:"vec2"},attributes:{attPos:"vec2"},mainCode:["gl_Position = vec4(uniCenter + attPos * uniRadius, 0.0, 1.0);"]}).code,n=new O.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,s=new O.a6X(e.gl,{vert:t,frag:n});this.prg=s;const r=[0,0],i=2*Math.PI/this.STEPS;for(let e=0;e<this.STEPS;e++){const t=i*e,n=Math.cos(t),s=Math.sin(t);r.push(n,s)}r.push(1,0);const o=new O.I9j({attPos:"vec2"});o.set("attPos",new Float32Array(r));const a=new O.ZV_(e.gl,s,[o]);this.vao=a}delete(){this.prg.delete(),this.vao.delete()}paint(e,t,n,s,r){const{context:i,prg:o,vao:a}=this,{gl:l}=i;o.use(),o.uniform2f("uniCenter",e,t),o.uniform2f("uniRadius",n,s),o.uniform1f("uniColor",r/255),a.bind(),l.drawArrays(l.TRIANGLE_FAN,0,this.STEPS+2),a.unbind()}}class le{constructor(e){this.context=e;const t=new O.dLJ({uniforms:{uniCenter:"vec2",uniRadius:"vec2"},attributes:{attPos:"vec2"},mainCode:["gl_Position = vec4(uniCenter + attPos * uniRadius, 0.0, 1.0);"]}).code,n=new O.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,s=new O.a6X(e.gl,{vert:t,frag:n});this.prg=s;const r=new O.I9j({attPos:"vec2"});r.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1]));const i=new O.ZV_(e.gl,s,[r]);this.vao=i}delete(){this.prg.delete(),this.vao.delete()}paint(e,t,n,s,r){const{context:i,prg:o,vao:a}=this,{gl:l}=i;o.use(),o.uniform2f("uniCenter",e,t),o.uniform2f("uniRadius",n,s),o.uniform1f("uniColor",r/255),a.bind(),l.drawArrays(l.TRIANGLE_STRIP,0,4),a.unbind()}}const ce=()=>{};class ue extends O.tbm{constructor(e,t){super(),this.id="Kernel#"+ue.ID++,this.LAYERS_COUNT=1,this.WIDTH=640,this.HEIGHT=480,this.CHAR_SIZE=16,this.TEXT_COLS=Math.floor(this.WIDTH/this.CHAR_SIZE),this.TEXT_ROWS=Math.floor(this.HEIGHT/this.CHAR_SIZE),this.TEXT_ORIGIN_X=(this.CHAR_SIZE-this.WIDTH)/2,this.TEXT_ORIGIN_Y=(this.CHAR_SIZE-this.HEIGHT)/2,this.x=(this.CHAR_SIZE-this.WIDTH)/2,this.y=(this.CHAR_SIZE-this.HEIGHT)/2,this.colorIndex=24,this.variables=new Map,this.layers=[],this.canvasPalette=(0,O.rY8)(["#000000","#000080","#0000FF","#800000","#800080","#8000FF","#FF0000","#FF0080","#FF00FF","#008000","#008080","#0080FF","#808000","#808080","#8080FF","#FF8000","#FF8080","#FF80FF","#00FF00","#00FF80","#00FFFF","#80FF00","#80FF80","#80FFFF","#FFFF00","#FFFF80","#FFFFFF","#000000"],256,1),this._currentLayerindex=0,e.width=this.WIDTH,e.height=this.HEIGHT;const n=new O.tfp(e,{alpha:!0,antialias:!1,preserveDrawingBuffer:!0,onResize(e,t,n){}});this.context=n,this.painterDisk=new ae(n),this.painterRect=new le(n),this.texturePalette=new O.HTX(n).loadBitmap(this.canvasPalette),this.colorizer=new V(n,this.texturePalette),this.textureSymbols=new O.HTX(n).setParams({magFilter:"LINEAR",minFilter:"LINEAR",wrapS:"MIRRORED_REPEAT",wrapT:"MIRRORED_REPEAT"}).loadBitmap(t);for(let e=0;e<this.LAYERS_COUNT;e++)this.layers.push(new B(n));var s;n.add(this),n.paint(),this.painterSymbols=new $(n.gl,{symbols:this.textureSymbols,screenWidth:this.WIDTH,screenHeight:this.HEIGHT}),this.instructions={CLS:G(s=this),COLOR:z(s),DISK:K(s),LABEL:Y(s),LOCATE:q(s),MOVE:Q(s),PAUSE:ee(s),PRINT:ne(s),PRINTLN:se(s),RECT:re(s)},this.functions=(e=>({ABS:ie("ABS",D(1,1),(([e])=>Math.abs(e))),ASK:oe(e),CHR:ie("CHR",D(1),(e=>e.map((e=>String.fromCharCode(e))).join(""))),INT:ie("INT",W(1,1),(([e])=>Math.round(Number(e)))),LIST:ie("LIST",(e=>{const[t]=e;if(2!==e.length||"number"!=typeof t)throw new Error("Cette fonction attends deux arguments: le nombre d'Ã©lÃ©ments et la valeur initiale de ces Ã©lÃ©ments.")}),(([e,t])=>new Array(e).fill(t))),MIN:ie("MIN",D(1),(([e,...t])=>t.reduce(((e,t)=>Math.min(e,t)),e))),MAX:ie("MAX",D(1),(([e,...t])=>t.reduce(((e,t)=>Math.max(e,t)),e))),NOT:ie("NOT",D(1,1),(([e])=>0===e?1:0)),RANDOM:ie("RANDOM",D(1,2),(e=>{const[t,n]=e;return(0,J.Et)(n)?t===n?t:Math.min(t,n)+Math.floor(Math.random()*(Math.abs(n-t)+1)):Math.floor(Math.random()*t)})),RANGE:ie("RANGE",D(1,3),(e=>{let[t,n,s]=e;(0,J.Et)(n)||(n=t,t=0),(0,J.Et)(s)||(s=1);const r=[];for(let e=t;n>0;n--)r.push(e),e+=s;return r})),RGB:ie("RGB",D(3,3),(e=>{const[t,n,s]=e;return 256*(0,O.P_T)(Math.round(t),0,15)+16*(0,O.P_T)(Math.round(n),0,15)+(0,O.P_T)(Math.round(s),0,15)})),TIME:ie("TIME",D(0,0),(()=>Date.now()))}))(this)}get gl(){return this.context.gl}screenSpaceX(e){return 2*e/this.WIDTH}screenSpaceY(e){return 2*e/this.HEIGHT}executeInstruction(e,t){try{const n=this.instructions[e];if(!n)throw new Error(`L'instruction "${e.toUpperCase()}" n'existe pas.\nLes instructions disponibles sont: ${Object.keys(this.instructions).sort().join(", ")}.`);return n(t)}catch(t){const n=t instanceof Error?t.message:JSON.stringify(t);throw new Error(`Erreur de l'instruction ${e.toUpperCase()} :\n${n}`)}}executeFunction(e,t){try{const n=this.functions[e];if(!n)throw new Error(`La fonction "${e.toUpperCase()}" n'existe pas.\nLes fonctions disponibles sont: ${Object.keys(this.functions).sort().join(", ")}.`);return n(t)}catch(t){const n=t instanceof Error?t.message:JSON.stringify(t);throw new Error(`Erreur de la fonction ${e.toUpperCase()} :\n${n}`)}}get currentLayerIndex(){return this._currentLayerindex}set currentLayerIndex(e){e=1===this.LAYERS_COUNT?0:(0,O.P_T)(Math.round(e),0,this.LAYERS_COUNT-1),this._currentLayerindex=e}get layer(){return this.layers[this.currentLayerIndex]}delete(){for(const e of this.layers)e.delete();this.painterDisk.delete(),this.painterSymbols.delete(),this.textureSymbols.delete()}paint(){try{const{context:e,colorizer:t}=this,{gl:n}=e;console.log("PAINT"),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT);for(const e of this.layers)t.paint(e.texture)}catch(e){console.error("Error while painting:",e)}}paintFB(e=ce){this.layer.paint(e)}print(e,t=1){this.paintFB((()=>{for(const n of e.split("")){const e=255&n.charCodeAt(0),s=15&e,r=e-s>>4;this.painterSymbols.paint({screenX:this.x,screenY:this.y,symbolX:s*this.CHAR_SIZE,symbolY:r*this.CHAR_SIZE,colorIndex:this.colorIndex,scale:t}),this.x+=this.CHAR_SIZE*t,this.x>=this.WIDTH/2&&(this.x=this.TEXT_ORIGIN_X,this.y+=this.CHAR_SIZE*t)}}))}getVar(e){var t;if(e=e.toUpperCase(),!this.variables.has(e)){const t=[`La variable $${e.toLocaleLowerCase()} n'existe pas.`],n=Array.from(this.variables.keys()).map((e=>`$${e.toLocaleLowerCase()}`));throw 0===n.length?t.push("Aucune variable n'a encore Ã©tÃ© crÃ©Ã©e."):1===n.length?t.push(`La seule variable existante maintenant est ${n[0]}.`):t.push(`Les variables disponibles sont : ${n.join("\n")}`),new Error(t.join("\n"))}return null!==(t=this.variables.get(e))&&void 0!==t?t:0}setVar(e,t){this.variables.set(e.toUpperCase(),t)}debugVariables(){for(const e of this.variables.keys())console.log(e,"=",this.getVar(e))}test(){this.paintFB((()=>{this.painterSymbols.paint({colorIndex:4,screenX:0,screenY:0,symbolX:0,symbolY:0,width:512,height:512})}))}}ue.ID=0;var he=n(2772),de=n(8347);const pe={error:new de.A(null),ready:new de.A(!1),running:new de.A(!1),code:new de.A(["REM Ceci est un commentaire",'PRINT("Bonjour le monde !")'].join("\n"),{storage:{id:"TLK-74/Basik/current",guard:J.Kg}}),manualPageId:new de.A("index",{storage:{id:"TLK-74/Manual/current",guard:J.Kg}})},fe={SPC:/^[ \t]+/g,COM:/^(REM )[^\n\r]*[\n\r]+/gi,EOL:/^[\n\r]+/g,VAR:/^\$[a-z0-9\._]+/gi,HEX:/^#[0-9a-f]+/gi,NUM:/^-?([0-9]+(\.[0-9]+)?|\.[0-9]+)/g,STR:/^"(\\"|[^"])*"/g,BINOP:/^(and|or|xor|>=|<=|<>|\^|==|[%+*/<>-])/gi,EQUAL:/^=/g,PAR_OPEN:/^\(/g,PAR_CLOSE:/^\)/g,BRA_OPEN:/^\{/g,BRA_CLOSE:/^\}/g,SQR_OPEN:/^\[/g,SQR_CLOSE:/^\]/g,COMMA:/^,/g,WHILE:/^while(?![a-z0-9])/i,FOR:/^for(?![a-z0-9])/i,IN:/^in(?![a-z0-9])/i,IF:/^if(?![a-z0-9])/i,ELSE:/^else(?![a-z0-9])/i,FUNC:/^[a-z_][a-z_0-9]*\(/i,INST:/^[a-z_][a-z_0-9]*/gi,EOF:/^<<EOF>>/},me=["SPC","COM","EOL"];class ge{constructor(e){this._code=e,this._cursor=0,this._token={id:"EOF",val:"",pos:1e100}}get token(){return this._token}get tokenID(){return this.token.id}get tokenCode(){return this._code.slice(this.token.pos)}all(){const e=this._cursor,t=[];for(this._cursor=0;this.hasMoreCode();)this.next(),t.push(structuredClone(this._token));return this._cursor=e,t}highlight(){const e=[];let t=0;for(;t<this._code.length;){const n=this._code.slice(t);let s=null;for(const[e,r]of Object.entries(fe)){r.lastIndex=-1;const i=r.exec(n);if(i){s={id:e,val:i[0],pos:t};break}}if(s){t+=s.val.length;let n=s.val.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");switch(s.id){case"VAR":n=n.toLowerCase();break;case"COM":n=n.slice(0,3).toUpperCase()+n.slice(3);break;case"HEX":case"FUNC":case"FOR":case"IN":case"IF":case"ELSE":case"WHILE":n=n.toUpperCase()}e.push(`<span class="Basik-${s.id}">${n}</span>`)}else t+=1,e.push(n.charAt(0))}return e.join("")}hasMoreCode(){return this._cursor<this._code.length-1}fatal(e){var t={pos:this._cursor,code:this._code,msg:e};throw console.error(t,this.token),t}next(){let e=this._code.slice(this._cursor);if(0===e.trimEnd().length)return this._token={id:"EOF",pos:this._cursor,val:""},void(this._cursor+=e.length+1);for(;;){let t=null;for(const n of Object.keys(fe)){const s=n,r=fe[s];if(!r)continue;r.lastIndex=0;const i=r.exec(e);if(i){t={id:s,val:i[0],pos:this._cursor};break}}if(t||this.fatal(`Je suis tombÃ© sur un caractÃ¨re qui n'a rien Ã  faire lÃ  : "${e.charAt(0)}".`),this._cursor+=t.val.length,!me.includes(t.id))return void(this._token=t);e=this._code.slice(this._cursor)}}is(...e){return e.includes(this._token.id)}get(...e){if(!e.includes(this._token.id))return null;const t=structuredClone(this._token);return this.next(),t}expect(e,t){(Array.isArray(e)?e:[e]).includes(this._token.id)||this.fatal(t);const n=structuredClone(this._token);return this.next(),n}}function ve(e){return(0,J.Xj)(e,{pos:"number",code:"string",msg:"string"})}function ye(e,t){const n=[e,`Erreur Ã  partir de : |${t.code.slice(t.pos,t.pos+32)}...|`,t.msg,""];console.log(`%c${t.msg}`,"background: #f00;color: #fff");const s=[];let r=0,i=0,o=1;const a=`${t.code}\n\n`;for(;i<a.length;)if("\n"===a.charAt(i++)){const e=a.slice(r,i).trimEnd();if(s.push([o++,e]),i>t.pos){for(const[e,t]of s.slice(-5))n.push(`${`${e}`.padStart(6," ")}:  ${t}`),console.log(`%c${`${e}`.padStart(6," ")}:  ${t}`,"font-family:monospace");throw console.log(`%c${" ".repeat(9+t.pos-r)}^`,"font-family:monospace"),n.push(`${" ".repeat(9+t.pos-r)}^`),new Error(n.join("\n"))}r=i}throw new Error(n.join("\n"))}const xe={"==":(e,t)=>JSON.stringify(e)===JSON.stringify(t)?1:0,"<>":(e,t)=>JSON.stringify(e)!==JSON.stringify(t)?1:0,">":(e,t)=>(0,J.Et)(e)&&(0,J.Et)(t)?e>t?1:0:JSON.stringify(e)>JSON.stringify(t)?1:0,"<":(e,t)=>(0,J.Et)(e)&&(0,J.Et)(t)?e<t?1:0:JSON.stringify(e)<JSON.stringify(t)?1:0,">=":(e,t)=>(0,J.Et)(e)&&(0,J.Et)(t)?e>=t?1:0:JSON.stringify(e)>=JSON.stringify(t)?1:0,"<=":(e,t)=>(0,J.Et)(e)&&(0,J.Et)(t)?e<=t?1:0:JSON.stringify(e)<=JSON.stringify(t)?1:0,"+":(e,t)=>(0,J.Et)(e)&&(0,J.Et)(t)?e+t:Array.isArray(e)?Array.isArray(t)?[...e,...t]:[...e,t]:Array.isArray(t)?Array.isArray(e)?[...e,...t]:[e,...t]:`${e}${t}`,"-":be("-",((e,t)=>e-t)),"/":be("/",((e,t)=>e/t)),"^":be("^",((e,t)=>Math.pow(e,t))),"%":be("^",((e,t)=>e%t)),AND:be("^",((e,t)=>e&t)),OR:be("^",((e,t)=>e|t)),XOR:be("^",((e,t)=>e^t)),"*":(e,t)=>{if((0,J.Et)(e)&&(0,J.Et)(t))return e*t;if(Array.isArray(e)||Array.isArray(t))throw new Error("Il est impossible de multiplier des listes !");if((0,J.Kg)(e)&&(0,J.Kg)(t))throw new Error("Il est impossible de multiplier deux chaÃ®nes de caractÃ¨res !");let n=(0,J.Kg)(e)?e:t,s=(0,J.Kg)(t)?e:t;if(0===s)return"";s<0&&(s=-s,n=n.split("").reverse().join(""));const r=Math.floor(s),i=s-r;return`${n.repeat(r)}${n.slice(0,Math.round(i*n.length))}`}};function be(e,t){return(n,s)=>{if(!(0,J.Et)(n)||!(0,J.Et)(s))throw new Error(`L'opÃ©rateur "${e}" ne fonctionne qu'avec des nombres.`);return t(n,s)}}class Ee{constructor(){this.counter=0,this.labels=new Map,this.links=[]}reset(){this.labels.clear(),this.links.splice(0,this.links.length),this.counter=0}create(e=""){return`:${this.counter++}:${e}`}stick(e,t){this.labels.set(e,t)}link(e,t){this.links.push({cursor:e,label:t})}apply(e){for(const{cursor:t,label:n}of this.links){const s=this.labels.get(n);if(void 0===s)throw Error(`Label not found: ${n}`);e[t].val=s}}getLabelAtCursor(e){for(const[t,n]of this.labels.entries())if(n===e)return t;return""}getLinkAtCursor(e){for(const{label:t,cursor:n}of this.links)if(n===e)return t;return null}getLabelsMaxLength(){let e=0;for(const t of this.labels.keys())e=Math.max(e,t.length);return e}}var Ae=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class we{constructor(e){this.kernel=e,this.labels=new Ee,this.bytecode=[],this.stack=[],this.lexer=new ge(""),this.cursor=0,this.code="",this.parseBloc=()=>{const e=[this.parseInstruction,this.parseAffectation,this.parseIf,this.parseForIn,this.parseWhile];if(!this.parseAny(...e))return!1;for(;this.parseAny(...e););return!0},this.parseIf=()=>{const{lexer:e}=this;if(!e.get("IF"))return!1;this.parseExpression()||this.fatal("AprÃ¨s un IF il faut une expression.");const t=this.labelCreate("Else"),n=this.labelCreate("EndIf");return this.labelLink(t),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour dÃ©finir un bloc, comme dans cet exemple :","IF $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.pushBytecode(this.$if),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante Ã  la fin d'un bloc, comme dans cet exemple :","IF $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.pushJump(n),this.labelStick(t),e.get("ELSE")&&(e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour dÃ©finir un bloc, comme dans cet exemple :","ELSE {",'  PRINTLN("Perdu")',"}"].join("\n")),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante Ã  la fin d'un bloc, comme dans cet exemple :","ELSE {",'  PRINTLN("Perdu")',"}"].join("\n"))),this.labelStick(n),!0},this.parseWhile=()=>{const{lexer:e}=this;if(!e.get("WHILE"))return!1;const t=this.labelCreate("Begin"),n=this.labelCreate("End");return this.labelStick(t),this.parseExpression()||this.fatal("AprÃ¨s un WHILE il faut une expression."),this.pushJumpIfZero(n),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour dÃ©finir un bloc, comme dans cet exemple :","WHILE $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante Ã  la fin d'un bloc, comme dans cet exemple :","WHILE $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.pushJump(t),this.labelStick(n),!0},this.parseForIn=()=>{const{lexer:e}=this;if(!e.get("FOR"))return!1;const t=e.expect("VAR","Il me faut un nom de variable aprÃ¨s le mot clef FOR.");this.pushBytecode(t.val),e.expect("IN","AprÃ¨s le nom de variable, il faut le mot clef IN.\nExemple: FOR $i IN $notes"),this.parseExpression()||this.fatal("Je m'attendais Ã  une expression aprÃ¨s un FOR ... IN."),this.pushBytecode(0);const n=this.labelCreate(),s=this.labelCreate();return this.labelLink(s),this.labelStick(n),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour dÃ©finir un bloc, comme dans cet exemple :","FOR $i IN RANGE(9) {","  PRINTLN($i)","}"].join("\n")),this.pushBytecode(this.$forIn),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante Ã  la fin d'un bloc, comme dans cet exemple :","FOR $i IN RANGE(9) {","  PRINTLN($i)","}"].join("\n")),this.pushJump(n),this.labelStick(s),!0},this.parseAffectation=()=>{const e=this.lexer.get("VAR");if(!e)return!1;const t=e.val;return this.pushBytecode(t),this.lexer.expect("EQUAL",`Je m'attendais Ã  voir le signe "=" pour l'affectation de la variable ${t} !`),this.parseExpression(),this.pushBytecode(this.$setVar),!0},this.parseInstruction=()=>{const{lexer:e}=this,t=e.get("FUNC");if(!t)return!1;const n=t.val.slice(0,-1).trim().toUpperCase();let s=0;for(;this.parseExpression()&&(s++,e.get("COMMA")););return e.expect("PAR_CLOSE",`Il manque une parenthÃ¨se fermante aprÃ¨s les arguments de l'instruction "${n}".`),this.pushBytecode(s,this.$makeArray,n,this.$instruction),!0},this.parseExpression=()=>{if(this.parseAny(this.parseNumber,this.parseVar,this.parseHexa,this.parseString,this.parseExpressionBlock,this.parseFunction)){for(;this.parseBinaryOperator(););return!0}return!1},this.parseFunction=()=>{const{lexer:e}=this,t=e.get("FUNC");if(!t)return!1;const n=t.val.slice(0,-1).trim().toUpperCase();let s=0;for(;this.parseExpression()&&(s++,e.get("COMMA")););return e.expect("PAR_CLOSE",`Il manque une parenthÃ¨se fermante aprÃ¨s les arguments de la fonction "${n}".`),this.pushBytecode(s,this.$makeArray,n,this.$function),!0},this.parseExpressionBlock=()=>{const{lexer:e}=this;return!!e.get("PAR_OPEN")&&(this.parseExpression()||e.fatal("Il manque une expression aprÃ¨s la parenthÃ¨se ouvrante."),e.expect("PAR_CLOSE","Il manque une parenthÃ¨se fermante ici."),!0)},this.parseBinaryOperator=()=>{const{lexer:e}=this,t=e.get("BINOP");if(!t)return!1;const n=t.val;return this.parseExpression()||e.fatal(`Je m'attendais Ã  une expression aprÃ¨s l'opÃ©rateur "${e.token.val}" !`),this.pushBytecode(this.makeBinOp(n)),!0},this.parseNumber=()=>{const e=this.lexer.get("NUM");return!!e&&(this.pushBytecode(Number(e.val)),!0)},this.parseString=()=>{const e=this.lexer.get("STR");return!!e&&(this.pushBytecode(e.val.slice(1,-1)),!0)},this.parseHexa=()=>{const e=this.lexer.get("HEX");return!!e&&(this.pushBytecode(Number(`0x${e.val.trim().slice(1)}`)),!0)},this.parseVar=()=>{const e=this.lexer.get("VAR");return!!e&&(this.pushBytecode(e.val,this.$getVar),!0)},this.$jump=Ie("JMP",(()=>{this.cursor=this.popNum()})),this.$jumpIfZero=Ie("JMP",(()=>{const e=this.popNum();0===this.pop()&&(this.cursor=e)})),this.$setVar=Ie("setVar(name, value)",(()=>{const e=this.pop(),t=this.popStr();this.kernel.setVar(t,e)})),this.$getVar=Ie("getVar(name)",(()=>{var e;const t=this.popStr();this.stack.push(null!==(e=this.kernel.getVar(t))&&void 0!==e?e:0)})),this.$makeArray=Ie("makeArray(count, ...)",(()=>{const e=this.popNum(),t=this.stack.splice(this.stack.length-e,e);this.stack.push(t)})),this.$function=()=>Ae(this,void 0,void 0,(function*(){const e=this.popStr(),t=this.popArr(),n=yield this.kernel.executeFunction(e,t);this.stack.push(n)})),this.$instruction=()=>Ae(this,void 0,void 0,(function*(){const e=this.popStr(),t=this.popArr();yield this.kernel.executeInstruction(e,t)})),this.$if=Ie("IF ... ELSE",(()=>{const e=this.popNum();0===this.pop()&&(this.cursor=e)})),this.$forIn=Ie("FOR ... IN",(()=>{const[e,t,n,s]=this.stack.slice(-4),r=(0,J.Kg)(t)?t.split(""):t;if(!Array.isArray(r))throw new Error(["AprÃ¨s le IN, il me faut une liste ou une chaine.",`Mais j'ai reÃ§u Ã§a : ${JSON.stringify(r)}.`].join("\n"));if(!(0,J.Kg)(e))throw new Error("Internal error! VarName must be a number.");if(!(0,J.Et)(n))throw new Error("Internal error! Index must be a number.");if(!(0,J.Et)(s))throw new Error("Internal error! JumpOut must be a number.");if(n>=r.length)return this.stack.splice(-4,4),void(this.cursor=s);this.kernel.setVar(e,r[n]),this.stack[this.stack.length-2]=n+1}))}execute(e){return Ae(this,void 0,void 0,(function*(){try{this.code=e,console.log(e),this.compile(),this.link()}catch(e){console.error(e),console.log("Byte code:",this.bytecode),ye("Erreur de compilation !",ve(e)?e:{code:this.code,pos:this.bytecode[this.cursor].pos,msg:`${e}`})}try{this.stack.splice(0,this.stack.length);const{bytecode:e,stack:t}=this;for(this.cursor=0;this.cursor<e.length&&Ce.state.running.value;){const n=e[this.cursor++].val;"function"==typeof n?yield n():t.push(n)}this.kernel.debugVariables()}catch(e){console.error(e),console.log("Cursor:",this.cursor),console.log("Byte code:",this.bytecode),console.log("Stack:",this.stack),ye("Erreur d'execution !",ve(e)?e:{code:this.code,pos:this.bytecode[this.cursor].pos,msg:`${e}`})}finally{this.kernel.paint()}}))}compile(){this.labels.reset(),this.bytecode.splice(0,this.bytecode.length);const e=new ge(this.code);for(console.log("Tokens:",e.all()),e.next(),this.lexer=e;e.hasMoreCode();)this.parseBloc()||e.fatal("CaractÃ¨re inattendu ! Je suis perdu...");this.pushBytecode("<<EOF>>"),console.log("Compiled!",this.bytecode)}link(){this.labels.apply(this.bytecode),this.debugBytecode()}fatal(e){const t=this.bytecode[this.cursor];throw t&&console.error(e,t),new Error(e)}pushBytecode(...e){for(const t of e)this.bytecode.push({pos:this.lexer.token.pos,val:t})}pushJump(e){this.labelLink(e),this.pushBytecode(this.$jump)}pushJumpIfZero(e){this.labelLink(e),this.pushBytecode(this.$jumpIfZero)}labelLink(e){this.pushBytecode(0),this.labels.link(this.bytecode.length-1,e)}labelStick(e){return this.labels.stick(e,this.bytecode.length)}labelCreate(e=""){return this.labels.create(e)}parseAny(...e){for(const t of e)if(t())return!0;return!1}pop(){const e=this.stack.pop();return null!=e?e:0}popStr(){const e=this.stack.pop();return(0,J.Kg)(e)?e:JSON.stringify(e)}popNum(){const e=this.stack.pop();return(0,J.Et)(e)?e:0}popArr(){const e=this.stack.pop();return Array.isArray(e)?e:(console.error("We were expecting an array, but got:",e),[])}makeBinOp(e){return Ie(e,(()=>{const t=this.pop(),n=this.pop(),s=xe[e.toUpperCase()];s||this.lexer.fatal(`Unimplemented binary operator: "${e}"!`);const r=s(n,t);this.stack.push(r)}))}debugBytecode(){const e=this.labels.getLabelsMaxLength(),t=this.bytecode.map((({val:e},t)=>{if((0,J.Tn)(e))return`CALL ${e.name}`;const n=this.labels.getLinkAtCursor(t);return n?`LINK ${n}  ->  ${JSON.stringify(e)}`:`PUSH ${JSON.stringify(e)}`})).map(((t,n)=>`${`${n}`.padStart(6," ")}. ${this.labels.getLabelAtCursor(n).padEnd(e)} ${t}`));console.info(t.join("\n"))}}function Ie(e,t){return{[e]:()=>new Promise(((e,n)=>{try{t()}catch(e){n(e)}e()}))}[e]}const Ce=new class{constructor(){this.state=pe,this.canvas=null,this.kernel=null,pe.running.value=!1}setCanvas(e){var t;e!==this.canvas&&(null===(t=this.kernel)||void 0===t||t.delete(),this.canvas=e,e&&(this.kernel=new ue(e,he.m.symbols)))}run(){return e=this,t=void 0,s=function*(){const{kernel:e}=this;if(e)try{Ce.state.error.value=null,Ce.state.running.value=!0;const t=new we(e);yield t.execute(this.state.code.value)}catch(e){console.error(e);const t=(0,J.Kg)(e)?e:e instanceof Error?e.message:JSON.stringify(e);Ce.state.error.value=t}finally{Ce.state.running.value=!1}},new((n=void 0)||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}));var e,t,n,s}},Se=r.Sxu.classNames;function Fe(e){const t=Ce.state.ready.useValue(),n=Ce.state.running.useValue();return(0,r.CbV)("f2",(()=>{Ce.state.running.value||Ce.run()})),console.log("ðŸš€ [Menu] running =",n),(0,s.jsxs)(r.sWC,{className:Se.join(L.menu),color:"primary-5",padding:"S",display:"flex",justifyContent:"space-between",children:[!n&&(0,s.jsxs)(r.yQN,{enabled:t,onClick:()=>{Ce.run()},children:[(0,s.jsx)(r.AYg,{})," Run (F2)"]}),n&&(0,s.jsxs)(r.yQN,{enabled:t,onClick:()=>{Ce.state.running.value=!1},children:[(0,s.jsx)(r._Zj,{})," Stop"]})]})}var Te=n(6069),Ne=n.n(Te),Re=n(1057),_e={};_e.styleTagTransform=g(),_e.setAttributes=d(),_e.insert=u().bind(null,"head"),_e.domAPI=l(),_e.insertStyleElement=f(),o()(Re.A,_e);const ke=Re.A&&Re.A.locals?Re.A.locals:void 0,Pe=r.Sxu.classNames;function Ue(e){const[t,n]=Ce.state.code.useState();return(0,s.jsx)("div",{className:Pe.join(ke.editor),children:(0,s.jsx)(Ne(),{value:t,onValueChange:n,padding:10,style:{fontFamily:'"Fira code", "Fira Mono", monospace'},highlight:Le})})}function Le(e){return new ge(e).highlight()}const Oe=r.Sxu.classNames;function $e(e){return(0,s.jsxs)(r.UkC,{template:"*1",orientation:"column",className:Oe.join(k.panelEditor),children:[(0,s.jsx)(Fe,{}),(0,s.jsx)(Ue,{})]})}var je=n(1039),Me={};Me.styleTagTransform=g(),Me.setAttributes=d(),Me.insert=u().bind(null,"head"),Me.domAPI=l(),Me.insertStyleElement=f(),o()(je.A,Me);const Be=je.A&&je.A.locals?je.A.locals:void 0,He=r.Sxu.classNames;function Ve(e){return(0,s.jsx)("div",{className:He.join(Be.panelMonitor),children:(0,s.jsx)("canvas",{ref:e=>{Ce.setCanvas(e),Ce.state.ready.value=!0},width:"64",height:"48"})})}var Je=n(6540),Xe=n(23),De=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};Xe.xI.use({renderer:{link:e=>{const{href:t,text:n}=e;return t.startsWith("https:")||t.startsWith("http:")?`<a href=${JSON.stringify(e.href)}>${n}</a>`:`<a href="#/workbench/${t}" data-href=${JSON.stringify(t)}>${n}</a>`}}});const We="index";function Ze(...e){return e.filter((e=>e.trim().length>0)).join("/")}var Ge=n(6717),ze={};ze.styleTagTransform=g(),ze.setAttributes=d(),ze.insert=u().bind(null,"head"),ze.domAPI=l(),ze.insertStyleElement=f(),o()(Ge.A,ze);const Ke=Ge.A&&Ge.A.locals?Ge.A.locals:void 0;var Ye=n(3453),qe={};qe.styleTagTransform=g(),qe.setAttributes=d(),qe.insert=u().bind(null,"head"),qe.domAPI=l(),qe.insertStyleElement=f(),o()(Ye.A,qe),Ye.A&&Ye.A.locals&&Ye.A.locals;const Qe=r.Sxu.classNames;function et(){const[e,t]=Ce.state.error.useState();(0,r.CbV)("escape",(()=>t(null)));const n=function(){const[e,t]=Je.useState(null),[n,s]=Ce.state.manualPageId.useState();return Je.useEffect((()=>{(()=>{De(this,void 0,void 0,(function*(){if(!e)return;const t=yield(0,O.jWq)(`assets/help/${n}.md`);t?function(e,t,n,s){De(this,void 0,void 0,(function*(){const r=e.split("/");r.pop();const i=r.join("/"),o=yield Xe.xI.parse(n,{async:!0,gfm:!0});t.innerHTML=o,function(e,t){const n=e.querySelectorAll("img");for(const e of n){const n=e.getAttribute("src");n&&e.setAttribute("src",Ze("assets/help",t,n))}}(t,i),function(e,t,n){const s=e.querySelectorAll("a[data-href]");for(const e of s){const s=e.getAttribute("data-href");s&&e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),n(Ze(t,s))}))}}(t,i,s),function(e){var t;const n=e.querySelectorAll("pre");for(const e of n){const n=null!==(t=e.textContent)&&void 0!==t?t:"",s=new ge(n);e.setAttribute("title","Double clique pour utiliser ce code"),e.innerHTML=s.highlight(),e.addEventListener("dblclick",(()=>Ce.state.code.value=n))}}(t),globalThis.setTimeout((()=>{t.scrollTo({top:0,behavior:"smooth"})}),50)}))}(n,e,yield function(e,t){return De(this,void 0,void 0,(function*(){var n;const s=(null!==(n=yield(0,O.jWq)(Ze("assets/help",[...e.split("/").slice(0,-1),"index.txt"].join("/"))))&&void 0!==n?n:"").trim().split("\n").map((e=>e.trim().split(":")));if(e.endsWith("index"))return`${t}\n\n${s.map((([e,t])=>`- [${t}](${e})`)).join("\n")}`;const r=[],i=s.findIndex((([t])=>e.endsWith(`/${t}`))),o=s[i-1],a=s[i],l=s[i+1];return a&&r.push(`# ${a[1]}`,"\n","\n"),r.push(t,"\n\n----\n\n"),l&&r.push(`- Chapitre suivant : [${l[1]}](${l[0]})`),o&&r.push(`- Chapitre prÃ©cÃ©dent : [${o[1]}](${o[0]})`),r.join("\n")}))}(n,t),s):n!==We&&s(We)}))})()}),[e,n,s]),e=>t(e)}();return console.log("ðŸš€ [PanelManual] error =",e),e?(0,s.jsx)(r.sWC,{fullsize:!0,position:"absolute",padding:"M",overflow:"auto",color:"error",className:Ke.error,children:(0,s.jsxs)("div",{onClick:()=>t(null),children:[(0,s.jsx)("h1",{children:"Erreur !"}),(0,s.jsx)("pre",{children:e})]})}):(0,s.jsxs)(r.UkC,{template:"*1",orientation:"row",color:"neutral-5",fullsize:!0,position:"absolute",children:[(0,s.jsx)(r.sWC,{color:"primary-5",display:"flex",justifyContent:"flex-start",alignItems:"center",flexDirection:"column",padding:"XS",children:(0,s.jsx)(r.qxP,{icon:r.LNh,color:"secondary-5",onClick:()=>Ce.state.manualPageId.value="index"})}),(0,s.jsx)(r.sWC,{className:Qe.join(Ke.panelManual),color:"neutral-5",padding:"M",overflow:"auto",children:(0,s.jsx)("div",{ref:n,children:"Chargement en cours..."})})]})}const tt=r.Sxu.classNames;function nt(e){return(0,s.jsxs)(I,{className:tt.join(x.workBench),children:[(0,s.jsxs)(N,{children:[(0,s.jsx)(Ve,{}),(0,s.jsx)(et,{})]}),(0,s.jsx)($e,{})]})}function st(){return(0,s.jsx)(nt,{})}},9384:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(1601),r=n.n(s),i=n(6314),o=n.n(i)()(r());o.push([e.id,".HCA0RQdvl_1OXyrfGC6i {\n  --custom-ratio1: 1fr;\n  --custom-ratio2: 1fr;\n  display: grid;\n  grid-template-columns: var(--custom-ratio1) var(--custom-ratio2);\n  width: 100%;\n  height: 100%;\n}\n\n.HCA0RQdvl_1OXyrfGC6i > div.MqKoJwA74gB3Pu_7onn7 {\n  position: relative;\n  min-width: 0;\n}\n",""]),o.locals={splitHorizontal:"HCA0RQdvl_1OXyrfGC6i",container:"MqKoJwA74gB3Pu_7onn7"};const a=o}}]);