(()=>{"use strict";var t,e,i,n={631:(t,e,i)=>{i.d(e,{A:()=>d});var n=i(1601),s=i.n(n),r=i(6314),o=i.n(r),a=i(4417),h=i.n(a),c=new URL(i(1680),i.b),u=o()(s()),l=h()(c);u.push([t.id,`/* latin-ext */\n@font-face {\n  font-family: josefin-sans;\n  font-style: normal;\n  font-weight: 400;\n  src: local('Josefin Sans'), local('JosefinSans'), url(${l}) format('woff2');\n  unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;\n}\n/* latin */\n@font-face {\n  font-family: josefin-sans;\n  font-style: normal;\n  font-weight: 400;\n  src: local('Josefin Sans'), local('JosefinSans'), url(${l}) format('woff2');\n  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;\n}\n`,""]);const d=u},1680:(t,e,i)=>{t.exports=i.p+"fnt/josefin.867f564a4eb4c84b3181.woff2"},1858:(t,e,i)=>{function n(t){if(s)for(const e in s)if(s[e]===t)return e;return`${t}`}i.d(e,{tfp:()=>Dt,I9j:()=>Vt,MRb:()=>$,tbm:()=>dt,K7:()=>re,Ipk:()=>ee,a6X:()=>zt,NI6:()=>se,dLJ:()=>ne,HTX:()=>ae,ZV_:()=>te,O6b:()=>a,HPH:()=>u,P_T:()=>l,jtz:()=>At,iJ5:()=>Et,V_9:()=>oe,jWq:()=>ce,aMr:()=>wt});const s=document.createElement("canvas").getContext("webgl2");function r(t,e=6){const i=Math.pow(10,e),n=[];let s=0;for(const r of t){const t=(Math.round(r*i)/i).toFixed(e);s=Math.max(s,t.length),n.push(t)}return n.map((t=>t.padStart(s," ")))}var o=i(1848);function a(t,e,i){return t<e?e:t>i?i:t}function h(t,e,i){return(1-i)*t+i*e}Math.PI;const c=Math.PI/180;function u(t){return t*c}function l(t,e,i){const n=i-e;return 0===n?e:t<e?t+Math.ceil((e-t)/n)*n:t>i?t-Math.ceil((t-i)/n)*n:t}class d extends Float32Array{static newFrom([t,e,i]){return new d(t,e,i)}static newFromMix([t,e,i],[n,s,r],o=.5){const a=1-o;return new d(a*t+o*n,a*e+o*s,a*i+o*r)}static distance(t,e){const i=e.x-t.x,n=e.y-t.y,s=e.z-t.z;return Math.hypot(i,n,s)}constructor(t=0,e=0,i=0){if(super(3),"number"!=typeof t)return this.x=t[0],this.y=t[1],void(this.z=t[2]);this.x=t,this.y=e,this.z=i}clone(){return new d(this)}mix(t,e=.5){const i=1-e;return this.x=i*this.x+e*t.x,this.y=i*this.y+e*t.y,this.z=i*this.z+e*t.z,this}isEqual(t){const[e,i,n]=t;return e===this.x&&i===this.y&&n===this.z}isClose(t,e=1e-6){const[i,n,s]=t;return!(Math.abs(i-this.x)>e||Math.abs(n-this.y)>e||Math.abs(s-this.z)>e)}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),[s,r,o]=this,[a,h,c]=t,u=h*o-c*r,l=c*s-a*o,d=a*r-h*s,f=(s*a+r*h+o*c)*(1-i);return this.x=s*i+u*n+a*f,this.y=r*i+l*n+h*f,this.z=o*i+d*n+c*f,this}applyMatrix(t){const{x:e,y:i,z:n}=this;return this.x=e*t.m00+i*t.m10+n*t.m20,this.y=e*t.m01+i*t.m11+n*t.m21,this.z=e*t.m02+i*t.m12+n*t.m22,this}applyQuaternion(t){return o.gL(this,this,t),this}from(t){const[e,i,n]=t;return this.x=e,this.y=i,this.z=n,this}fromOpposite(t){const[e,i,n]=t;return this.x=-e,this.y=-i,this.z=-n,this}fromMix(t,e,i){const[n,s,r]=t,[o,a,c]=e;return this.reset(h(n,o,i),h(s,a,i),h(r,c,i))}reset(t=0,e=0,i=0){return this[0]=t,this[1]=e,this[2]=i,this}distanceToLineSquared(t,e){const[i,n,s]=this,[r,o,a]=t,[h,c,u]=e,l=h*(i-r)+c*(n-o)+u*(s-a),d=i-(r+l*h),f=n-(o+l*c),m=s-(a+l*u);return d*d+f*f+m*m}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}add(...t){for(const e of t){const[t,i,n]=e;this[0]+=t,this[1]+=i,this[2]+=n}return this}addWithScale(t,e){return this[0]+=t.x*e,this[1]+=t.y*e,this[2]+=t.z*e,this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}get size(){return Math.hypot(this[0],this[1],this[2])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];return 0===t?this:this.scale(1/Math.sqrt(t))}cross(t){const[e,i,n]=this,[s,r,o]=t;return this[0]=i*o-r*n,this[1]=n*s-o*e,this[2]=e*r-s*i,this}random(){return this[0]=Math.random()-.5,this[1]=Math.random()-.5,this[2]=Math.random()-.5,this}debug(t="vec3"){const{x:e,y:i,z:n}=this,s=[e,i,n].map((t=>t.toFixed(6)));console.log(`${t}:   `,s.join(" | "),"   length:",Math.hypot(e,i,n))}}d.X=new d(1,0,0),d.Y=new d(0,1,0),d.Z=new d(0,0,1);class f extends Float32Array{static fromSlerp([t,e,i,n=0],[s,r,o,a=0],h=.5){const c=1-h;return new f(c*t+h*s,c*e+h*r,c*i+h*o,c*n+h*a)}constructor(t=0,e=0,i=0,n=1){if(super(4),t instanceof f)return this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=t.w);if(t instanceof d)return this.x=t.x,this.y=t.y,this.z=t.z,void(this.w=n);if(Array.isArray(t)){if("number"==typeof e){const[i,n,s]=t;return this.x=null!=i?i:0,this.y=null!=n?n:0,this.z=null!=s?s:0,void(this.w=e)}{const[e,i,n,s]=t;return this.x=null!=e?e:0,this.y=null!=i?i:0,this.z=null!=n?n:0,void(this.w=null!=s?s:1)}}this.x=t,this.y=e,this.z=i,this.w=n}reset(t=0,e=0,i=0,n=1){return this.x=t,this.y=e,this.z=i,this.w=n,this}from(t){const[e,i,n,s]=t;return this.x=e,this.y=i,this.z=n,this.w=s,this}fromVec3(t){const[e,i,n]=t;return this.x=e,this.y=i,this.z=n,this}clone(){return new f(this)}mix(t,e=.5){return this.x=(1-e)*this.x+e*t.x,this.y=(1-e)*this.y+e*t.y,this.z=(1-e)*this.z+e*t.z,this.w=(1-e)*this.w+e*t.w,this}isEqual(t){const[e,i,n,s]=t;return e===this.x&&i===this.y&&n===this.z&&s===this.w}isClose({x:t,y:e,z:i,w:n},s=1e-6){return!(Math.abs(t-this.x)>s||Math.abs(e-this.y)>s||Math.abs(i-this.z)>s||Math.abs(n-this.w)>s)}applyMatrix(t){const{x:e,y:i,z:n,w:s}=this;return this.x=e*t.m00+i*t.m01+n*t.m02+s*t.m03,this.y=e*t.m10+i*t.m11+n*t.m12+s*t.m13,this.z=e*t.m20+i*t.m21+n*t.m22+s*t.m23,this.w=e*t.m30+i*t.m31+n*t.m32+s*t.m33,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}add(...t){for(const e of t)this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],e.length>3&&(this[3]+=e[3]);return this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],t.length>3&&(this[3]-=t[3]),this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}get size(){return Math.hypot(this[0],this[1],this[2],this[3])}normalize(){const t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(t="vec4"){const{x:e,y:i,z:n,w:s}=this,r=[e,i,n,s].map((t=>t.toFixed(6)));console.log(`${t}:   `,r.join(" | "),`  (length = ${this.size})`)}}f.X=new f(1,0,0,0),f.Y=new f(0,1,0,0),f.Z=new f(0,0,1,0),f.W=new f(0,0,0,1);var m=i(2157);class g extends Float32Array{constructor(t=1,e=0,i=0,n=0,s=0,r=1,o=0,a=0,h=0,c=0,u=1,l=0,d=0,f=0,m=0,g=1){super("number"==typeof t?[t,e,i,n,s,r,o,a,h,c,u,l,d,f,m,g]:t)}reset(t=f.X,e=f.Y,i=f.Z,n=f.W){const[s,r,o,a]=t,[h,c,u,l]=e,[d,m,g,p]=i,[E,A,b,_]=n;return this.m00=s,this.m01=r,this.m02=o,this.m03=a,this.m10=h,this.m11=c,this.m12=u,this.m13=l,this.m20=d,this.m21=m,this.m22=g,this.m23=p,this.m30=E,this.m31=A,this.m32=b,this.m33=_,this}multiply(t){return m.lw(this,this,t),this}invert(t){return m.B8(this,null!=t?t:this),this}get translation(){const{m03:t,m13:e,m23:i}=this;return new d(t,e,i)}set translation(t){const[e,i,n]=t;this.m03=e,this.m13=i,this.m23=n}toTanslation(t){return t.x=this.m03,t.y=this.m13,t.z=this.m23,this}translate(t){const[e,i,n]=t;return this.m03+=e,this.m13+=i,this.m23+=n,this}from(t){var e;for(let i=0;i<this.length;i++)this[i]=null!==(e=t[i])&&void 0!==e?e:0;return this}fromMat3(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this}toAxes(t,e,i){return this.toAxisX(t),this.toAxisY(e),this.toAxisZ(i)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}fromQuat({x:t,y:e,z:i,w:n}){return m.I0(this,[t,e,i,n]),this}get m00(){return this[p]}set m00(t){this[p]=t}get m10(){return this[E]}set m10(t){this[E]=t}get m20(){return this[A]}set m20(t){this[A]=t}get m30(){return this[b]}set m30(t){this[b]=t}get m01(){return this[_]}set m01(t){this[_]=t}get m11(){return this[x]}set m11(t){this[x]=t}get m21(){return this[y]}set m21(t){this[y]=t}get m31(){return this[v]}set m31(t){this[v]=t}get m02(){return this[R]}set m02(t){this[R]=t}get m12(){return this[T]}set m12(t){this[T]=t}get m22(){return this[L]}set m22(t){this[L]=t}get m32(){return this[w]}set m32(t){this[w]=t}get m03(){return this[C]}set m03(t){this[C]=t}get m13(){return this[S]}set m13(t){this[S]=t}get m23(){return this[P]}set m23(t){this[P]=t}get m33(){return this[M]}set m33(t){this[M]=t}debug(t="Mat4"){const e=r([this.m00,this.m01,this.m02,this.m03]),i=r([this.m10,this.m11,this.m12,this.m13]),n=r([this.m20,this.m21,this.m22,this.m23]),s=r([this.m30,this.m31,this.m32,this.m33]);console.log(t),console.log("   ",e.join(" | ")),console.log("   ",i.join(" | ")),console.log("   ",n.join(" | ")),console.log("   ",s.join(" | "))}}const p=0,E=1,A=2,b=3,_=4,x=5,y=6,v=7,R=8,T=9,L=10,w=11,C=12,S=13,P=14,M=15;var F=i(5663),N=i(1304);class U extends Float32Array{constructor(t=1,e=0,i=0,n=0,s=1,r=0,o=0,a=0,h=1){if("number"==typeof t&&"number"==typeof e&&"number"==typeof i)super([t,e,i,n,s,r,o,a,h]);else if((t instanceof d||t instanceof f)&&(e instanceof d||e instanceof f)&&(i instanceof d||i instanceof f)){const n=t,s=e,r=i;super([n.x,n.y,n.z,s.x,s.y,s.z,r.x,r.y,r.z])}else if(t instanceof U){const e=t;super([e.m00,e.m10,e.m20,e.m01,e.m11,e.m21,e.m02,e.m12,e.m22])}else{if(!(t instanceof g))throw console.error("[TgdMat3]",arguments),new Error("Invalid TgdMat3 initialization!");{const e=t;super([e.m00,e.m10,e.m20,e.m01,e.m11,e.m21,e.m02,e.m12,e.m22])}}}multiply(t){return N.lw(this,this,t),this}transpose(){let t=this.m10;return this.m10=this.m01,this.m01=t,t=this.m20,this.m20=this.m02,this.m02=t,t=this.m21,this.m21=this.m12,this.m12=t,this}fromQuat({x:t,y:e,z:i,w:n}){return N.I0(this,[t,e,i,n]),this}toAxes(t,e,i){return this.toAxisX(t),this.toAxisY(e),this.toAxisZ(i)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this}get m00(){return this[O]}set m00(t){this[O]=t}get m10(){return this[B]}set m10(t){this[B]=t}get m20(){return this[D]}set m20(t){this[D]=t}get m01(){return this[I]}set m01(t){this[I]=t}get m11(){return this[k]}set m11(t){this[k]=t}get m21(){return this[W]}set m21(t){this[W]=t}get m02(){return this[G]}set m02(t){this[G]=t}get m12(){return this[H]}set m12(t){this[H]=t}get m22(){return this[j]}set m22(t){this[j]=t}debug(t="Mat3"){const e=r([this.m00,this.m01,this.m02]),i=r([this.m10,this.m11,this.m12]),n=r([this.m20,this.m21,this.m22]);console.log(t,this.slice()),console.log("   ",e.join(" | ")),console.log("   ",i.join(" | ")),console.log("   ",n.join(" | "))}}const O=0,B=1,D=2,I=3,k=4,W=5,G=6,H=7,j=8;class $ extends Float32Array{constructor(t=1,e=0,i=0,n=1){if("number"==typeof t&&"number"==typeof e)super([t,e,i,n]);else if((t instanceof d||t instanceof f)&&(e instanceof d||e instanceof f)){const i=t,n=e;super([i.x,i.y,n.x,n.y])}else{if(!(t instanceof $||t instanceof U||t instanceof g))throw console.error("[TgdMat3]",arguments),new Error("Invalid TgdMat3 initialization!");{const e=t;super([e.m00,e.m10,e.m01,e.m11])}}}multiply(t){return F.lw(this,this,t),this}transpose(){const t=this.m10;return this.m10=this.m01,this.m01=t,this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}get m00(){return this[z]}set m00(t){this[z]=t}get m10(){return this[X]}set m10(t){this[X]=t}get m01(){return this[K]}set m01(t){this[K]=t}get m11(){return this[Z]}set m11(t){this[Z]=t}debug(t="Mat3"){const e=r([this.m00,this.m01]),i=r([this.m10,this.m11]);console.log(t,this.slice()),console.log("   ",e.join(" | ")),console.log("   ",i.join(" | "))}}const z=0,X=1,K=2,Z=3;var Y=i(6156);const V=new d,Q=new d,q=new d,J=new U;class tt extends f{static fromMatrix(t){const e=new tt;return e.fromMatrix(t),e}static fromFace(t){return(new tt).face(t)}static fromSlerp(t,e,i){return(new tt).fromSlerp(t,e,i)}constructor(t=0,e=0,i=0,n=1){if(Array.isArray(t)){const[e,i,n,s]=t;super(e,i,n,s)}else"number"==typeof t?super(t,e,i,n):super(t)}clone(){return new tt(this)}multiply(t){return Y.lw(this,this,t),this}fromSlerp(t,e,i){const[n,s,r,o]=t;let a,h,[c,u,l,d]=e,f=n*c+s*u+r*l+o*d;if(f<0&&(f=-f,c=-c,u=-u,l=-l,d=-d),1-f>1e-6){const t=Math.acos(f),e=1/Math.sin(t);a=Math.sin((1-i)*t)*e,h=Math.sin(i*t)*e}else a=1-i,h=i;return this.x=a*n+h*c,this.y=a*s+h*u,this.z=a*r+h*l,this.w=a*o+h*d,this}fromAxesTransposed([t,e,i],[n,s,r],[o,a,h]){return this.fromAxes([t,n,o],[e,s,a],[i,r,h])}fromAxes(t,e,i){const[n,s,r]=i;return Y.ml(this,[-n,-s,-r],t,e),this}fromMatrix(t){return Y.Gn(this,t),this}rotateAround(t,e){return J.fromQuat(this).toAxes(V,Q,q),V.rotateAround(t,e),Q.rotateAround(t,e),q.rotateAround(t,e),this.fromAxes(V,Q,q)}static rotateAroundX(t){return(new tt).rotateAroundX(t)}rotateAroundX(t){return this.rotateAround(d.X,t)}static rotateAroundY(t){return(new tt).rotateAroundY(t)}rotateAroundY(t){return this.rotateAround(d.Y,t)}static rotateAroundZ(t){return(new tt).rotateAroundZ(t)}rotateAroundZ(t){return this.rotateAround(d.Z,t)}toAxisX(t){const[e,i,n,s]=this,r=e+e,o=i+i,a=n+n,h=i*r,c=i*o,u=n*r,l=n*a,d=s*o,f=s*a;return t.x=1-c-l,t.y=h-f,t.z=u+d,t}toAxisY(t){const[e,i,n,s]=this,r=e+e,o=n+n,a=e*r,h=i*r,c=n*(i+i),u=n*o,l=s*r,d=s*o;return t.x=h+d,t.y=1-a-u,t.z=c-l,t}toAxisZ(t){const{x:e,y:i,z:n,w:s}=this,r=e+e,o=i+i,a=e*r,h=i*o,c=n*r,u=n*o,l=s*r,d=s*o;return t.x=c-d,t.y=u+l,t.z=1-a-h,t}toMatrix(t){const e=new d,i=new d,n=new d;return this.toAxisX(e),this.toAxisY(i),this.toAxisZ(n),t.m00=e.x,t.m01=e.y,t.m02=e.z,t.m10=i.x,t.m11=i.y,t.m12=i.z,t.m20=n.x,t.m21=n.y,t.m22=n.z,t}invert(){return Y.B8(this,this),this}face(t="+X+Y+Z"){const[e,i,n,s]=nt[t];return this.x=e,this.y=i,this.z=n,this.w=s,this}}const et=Math.sqrt(2)/2,it=.5,nt={"-X-Y+Z":[0,0,1,0],"-X-Z-Y":[0,-et,+et,0],"-X+Y-Z":[0,1,0,0],"-X+Z+Y":[0,+et,+et,0],"-Y-X-Z":[+et,-et,0,0],"-Y-Z+X":[+it,-it,+it,-it],"-Y+X+Z":[0,0,-et,+et],"-Y+Z-X":[+it,-it,-it,+it],"-Z-X+Y":[+it,-it,-it,-it],"-Z-Y-X":[-et,0,+et,0],"-Z+X-Y":[+it,+it,-it,+it],"-Z+Y+X":[0,+et,0,+et],"+X-Y-Z":[1,0,0,0],"+X-Z+Y":[-et,0,0,+et],"+X+Y+Z":[0,0,0,1],"+X+Z-Y":[+et,0,0,+et],"+Y-X+Z":[0,0,+et,+et],"+Y-Z-X":[-it,-it,+it,+it],"+Y+X-Z":[+et,+et,0,0],"+Y+Z+X":[+it,+it,+it,+it],"+Z-X-Y":[+it,-it,+it,+it],"+Z-Y+X":[+et,0,+et,0],"+Z+X+Y":[+it,+it,+it,-it],"+Z+Y-X":[0,-et,0,+et]};class st{constructor(t){var e,i,n,s;this._matrix=new g(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this._position=new d(0,0,0),this._orientation=new tt(0,0,0,1),this._scale=new d(1,1,1),this._distance=0,this.tmpVec3=new d,this._axisX=new d,this._axisY=new d,this._axisZ=new d,this.dirty=!1,t&&(t instanceof st?this.from(t):(this.distance=null!==(e=t.distance)&&void 0!==e?e:this.distance,this.position=null!==(i=t.position)&&void 0!==i?i:this.position,this.orientation=null!==(n=t.orientation)&&void 0!==n?n:this.orientation,this.scale=null!==(s=t.scale)&&void 0!==s?s:this.scale),this.updateMatrix())}clone(){return new st(this)}from(t){var e,i,n,s;return this.position=null!==(e=t.position)&&void 0!==e?e:this.position,this.orientation=null!==(i=t.orientation)&&void 0!==i?i:this.orientation,this.scale=null!==(n=t.scale)&&void 0!==n?n:this.scale,this.distance=null!==(s=t.distance)&&void 0!==s?s:this.distance,this.updateMatrix(),this}fromMatrix(t){return this.matrix.from(t),this.dirty=!1,this}get matrix(){return this.updateIfNeeded(),this._matrix}set matrix(t){this._matrix.from(t),this.dirty=!1}get axisX(){return this.updateIfNeeded(),this._axisX}get axisY(){return this.updateIfNeeded(),this._axisY}get axisZ(){return this.updateIfNeeded(),this._axisZ}updateIfNeeded(){if(!this.dirty)return;const t=this._matrix;m.o1(t,this._orientation,this._position,this._scale),t.toAxisX(this._axisX),t.toAxisY(this._axisY),t.toAxisZ(this._axisZ);const e=this._distance;0!==e&&(this.tmpVec3.reset(0,0,e).applyQuaternion(this._orientation),t.m03+=this.tmpVec3.x,t.m13+=this.tmpVec3.y,t.m23+=this.tmpVec3.z),this.dirty=!1}reset(){return this.orientation.reset(),this.position.reset(),this.scale.reset(),this.dirty=!0,this}get distance(){return this._distance}set distance(t){this._distance=t,this.updateMatrix()}setDistance(t){return this.distance=t,this}get position(){return this.updateMatrix(),this._position}set position(t){this.updateMatrix(),this._position.from(t)}setPosition(t,e,i){return this.updateMatrix(),"number"==typeof t?this._position.reset(t,e,i):this._position.reset(t[0],t[1],t[2]),this}get actualPosition(){const t=this.distance;return 0===t?this.position:this.tmpVec3.from(this.position).addWithScale(this.axisZ,t)}get scale(){return this._scale}set scale(t){this.updateMatrix(),this._scale.from(t)}setScale(t,e,i){var n;return this.updateMatrix(),"number"==typeof t?this._scale.reset(t,null!=e?e:t,null!==(n=null!=i?i:e)&&void 0!==n?n:t):this._scale.reset(t[0],t[1],t[2]),this}get orientation(){return this.updateMatrix(),this._orientation}set orientation(t){this._orientation.from(t),this.updateMatrix()}setOrientation(t,e,i,n){return"number"==typeof t?this._orientation.reset(t,e,i,n):this._orientation.reset(t[0],t[1],t[2],t[3]),this.updateMatrix(),this}setEulerRotation(t,e,i){return Y.A6(this._orientation,t,e,i),this.updateMatrix(),this}orbitAroundX(t){return this._orientation.rotateAround(d.X,t),this.updateMatrix(),this}orbitAroundY(t){return this._orientation.rotateAround(d.Y,t),this.updateMatrix(),this}orbitAroundZ(t){return this._orientation.rotateAround(d.Z,t),this.updateMatrix(),this}moveAlongAxes(t,e,i){return this.position.addWithScale(this.axisX,t).addWithScale(this.axisY,e).addWithScale(this.axisZ,i),this.updateMatrix(),this}debug(t="Transfo"){console.log(t),console.log("Distance:",this.distance),this.orientation.debug("Orientation"),this.scale.debug("Scale"),this.position.debug("Position"),this.matrix.debug("Matrix")}updateMatrix(){this.dirty=!0}}class rt extends Float32Array{static fromMix(t,e,i=.5){const n=1-i,s=n*t.x+i*e.x,r=n*t.y+i*e.y;return new rt(s,r)}static distance(t,e){const i=e.x-t.x,n=e.y-t.y;return Math.hypot(i,n)}constructor(t=0,e=0){if(super(2),"number"!=typeof t)return this.x=t[0],void(this.y=t[1]);this.x=t,this.y=e}clone(){return new rt(this)}mix(t,e=.5){return this.x=(1-e)*this.x+e*t.x,this.y=(1-e)*this.y+e*t.y,this}isEqual(t){const[e,i]=t;return e===this.x&&i===this.y}isClose(t,e=1e-6){const[i,n]=t;return!(Math.abs(i-this.x)>e||Math.abs(n-this.y)>e)}from(t){const[e,i]=t;return this.x=e,this.y=i,this}fromMix(t,e,i){const[n,s]=t,[r,o]=e;return this.reset(h(n,r,i),h(s,o,i))}reset(t,e){return this[0]=t,this[1]=e,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}add(...t){for(const e of t)this[0]+=e.x,this[1]+=e.y;return this}addWithScale(t,e){return this[0]+=t.x*e,this[1]+=t.y*e,this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this}scale(t){return this[0]*=t,this[1]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]}get size(){return Math.hypot(this[0],this[1])}normalize(){const t=this[0]*this[0]+this[1]*this[1];return 0===t?this:this.scale(1/Math.sqrt(t))}random(){return this[0]=Math.random()-.5,this[1]=Math.random()-.5,this}debug(t="vec2"){const{x:e,y:i}=this,n=[e,i].map((t=>t.toFixed(6)));console.log(`${t}:   `,n.join(" | "),"   length:",Math.hypot(e,i))}}class ot{constructor(t={}){var e,i,n,s;this._screenWidth=1920,this._screenHeight=1080,this._screenAspectRatio=1920/1080,this._dirtyModelView=!0,this.dirtyModelViewInverse=!0,this._dirtyAxis=!0,this._dirtyProjection=!0,this.dirtyProjectionInverse=!0,this._near=.001,this._far=1/0,this._matrixModelView=new g,this._matrixProjectionInverse=new g,this._zoom=1,this.name=null!==(e=t.name)&&void 0!==e?e:"TgdCamera#"+ot.incrementalId++,this._near=null!==(i=t.near)&&void 0!==i?i:.001,this._far=null!==(n=t.far)&&void 0!==n?n:1e6,this.transfo=new st(t.transfo),this.zoom=null!==(s=t.zoom)&&void 0!==s?s:1}getCurrentState(){return{distance:this.transfo.distance,orientation:this.transfo.orientation.clone(),spaceHeightAtTarget:this.spaceHeightAtTarget,position:this.transfo.position.clone(),zoom:this.zoom}}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get screenAspectRatio(){return this._screenAspectRatio}get screenWidth(){return this._screenWidth}set screenWidth(t){t!==this._screenWidth&&(this._screenWidth=t,this.dirtyProjection=!0,this._screenAspectRatio=this._screenWidth/this._screenHeight)}get screenHeight(){return this._screenHeight}set screenHeight(t){t!==this._screenHeight&&(this._screenHeight=t,this.dirtyProjection=!0,this._screenAspectRatio=this._screenWidth/this._screenHeight)}get spaceHeightAtTarget(){return this.getSpaceHeightAtTarget()}set spaceHeightAtTarget(t){this.setSpaceHeightAtTarget(t)}get spaceWidthAtTarget(){return this.screenWidth*this.spaceHeightAtTarget/this.screenHeight}set spaceWidthAtTarget(t){this.setSpaceHeightAtTarget(t*this.screenHeight/this.screenWidth)}from(t){const{zoom:e,screenWidth:i,screenHeight:n}=t;return this.transfo.from(t.transfo),this.zoom=e,this.screenWidth=i,this.screenHeight=n,this.dirtyModelView=!0,this.copyProjectionFrom(t),this}fromTransfo(t){return this.transfo.from(t),this.dirtyModelView=!0,this}get matrixModelView(){return this._matrixModelView.invert(this.transfo.matrix)}get matrixProjectionInverse(){return this.dirtyProjectionInverse&&(this._matrixProjectionInverse.invert(this.matrixProjection),this.dirtyProjectionInverse=!1),this._matrixProjectionInverse}get zoom(){return this._zoom}set zoom(t){this._zoom!==t&&(this._zoom=t,this.transfo.setScale(t,t,t),this.dirtyModelView=!0)}toCode(t){return`// ${null!=t?t:"TgdCamera"}\n// Not implemented yet`}debug(t){const e=`${this.name}: ${null!=t?t:""}`;console.log("TgdCamera",e),console.log("    Distance:",this.transfo.distance),console.log("    Zoom:",this.zoom),this.transfo.orientation.debug("   Orientation"),this.transfo.position.debug("    Target"),this.transfo.actualPosition.debug("    Actual position"),this.matrixModelView.debug("    MatrixModelView"),this.matrixProjection.debug("    MatrixProjection")}get dirtyModelView(){return this._dirtyModelView}set dirtyModelView(t){this._dirtyModelView=t,t&&(this.dirtyModelViewInverse=!0)}get dirtyProjection(){return this._dirtyProjection}set dirtyProjection(t){this._dirtyProjection=t,t&&(this.dirtyProjectionInverse=!0)}}ot.incrementalId=1;class at extends ot{constructor(t={}){var e;super(t),this._matrixProjection=new g,this._fovy=Math.PI/4,this._ray={origin:new d,direction:new d},this._fovy=null!==(e=t.fovy)&&void 0!==e?e:Math.PI/4}copyProjectionFrom(t){return this.fovy=t.fovy,this.near=t.near,this.far=t.far,this}castRay(t,e){const{transfo:i}=this,{origin:n,direction:s}=this._ray;n.from(i.actualPosition);const r=Math.atan(.5*this.fovy),o=r*this.screenAspectRatio;return s.fromOpposite(i.axisZ).addWithScale(i.axisX,o*t).addWithScale(i.axisY,r*e).normalize(),this._ray}get fovy(){return this._fovy}set fovy(t){t!==this._fovy&&(this._fovy=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}getSpaceHeightAtTarget(){return 2*Math.tan(.5*this.fovy)*this.transfo.distance}setSpaceHeightAtTarget(t){this.transfo.setDistance(t/(2*Math.tan(.5*this.fovy)))}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;const t=this._fovy,e=this.screenAspectRatio,i=this._near,n=this._far,s=this._matrixProjection;m.fN(s,t,e,i,n),s[0]*=this.zoom,s[5]*=this.zoom,this.dirtyProjection=!0}toCode(t){const e=[];return t&&e.push(`// ${t}`),e.push("const camera = new TgdCameraPerspective({"),this.name&&e.push(`  name: ${JSON.stringify(this.name)},`),e.push(`  fovy: ${this._fovy},`),e.push(`  near: ${this._near},`),e.push(`  far: ${this._far},`),e.push(`  zoom: ${this.zoom},`),e.push("  transfo: {"),e.push(`  distance: ${this.transfo.distance},`),e.push(`    position: ${JSON.stringify([...this.transfo.position])},`),e.push(`    orientation: ${JSON.stringify([...this.transfo.orientation])},`),e.push(`    scale: ${JSON.stringify([...this.transfo.scale])},`),e.push("  }"),e.push("}"),e.join("\n")}}class ht{constructor(){this.listeners=new Set}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}dispatch(t){for(const e of this.listeners)e(t)}}class ct{constructor(){this.eventKeyPress=new ht,this.keysDown=new Set,this.keysUp=new Set,this.attached=!1,this.handleKeyDown=t=>{this.keysDown.add(t.key),this.keysUp.delete(t.key)},this.handleKeyUp=t=>{this.keysDown.delete(t.key),this.keysUp.add(t.key),this.eventKeyPress.dispatch(t)},document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.attached=!0}detach(){this.attached&&(document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.attached=!1)}isUp(...t){return!this.isDown(...t)}isDown(...t){for(const e of t)if(!this.keysDown.has(e))return!1;return!0}hasClicked(t){return!!this.keysUp.has(t)&&(this.keysUp.delete(t),!0)}}class ut{constructor(t){this.canvas=t,this.eventTap=new ht,this.eventMoveStart=new ht,this.eventMove=new ht,this.eventMoveEnd=new ht,this.eventZoom=new ht,this.tapDelay=300,this.controlKeys={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},this.start={x:0,y:0,t:0,fingersCount:1},this.current={x:0,y:0,t:0,fingersCount:1},this.previous={x:0,y:0,t:0,fingersCount:1},this.pointerEvent=null,this.handleContextMenu=t=>{t.preventDefault()},this.handleCanvasWheel=t=>{let e=t.deltaX+t.deltaY+t.deltaZ;e=e>0?1:-1,this.eventZoom.dispatch(Object.assign({current:this.getPoint(t),direction:e,preventDefault:()=>t.preventDefault()},this.controlKeys))},this.handlePointerDown=t=>{if(!t.isPrimary)return;this.canvas.setPointerCapture(t.pointerId),t.preventDefault(),t.stopPropagation(),this.pointerEvent=t;const e=this.getPoint(t);this.start=this.current=this.previous=e,this.eventMoveStart.dispatch(Object.assign({start:e,current:e,previous:e},this.controlKeys))},this.handlePointerMove=t=>{t.isPrimary&&this.pointerEvent&&this.canvas&&(this.previous=this.current,this.current=this.getPoint(t),this.eventMove.dispatch(Object.assign({start:this.start,current:this.current,previous:this.previous},this.controlKeys)))},this.handlePointerUp=t=>{t.isPrimary&&this.pointerEvent&&(t.preventDefault(),this.current=this.getPoint(t),this.eventMoveEnd.dispatch(Object.assign({start:this.start,current:this.current,previous:this.previous},this.controlKeys)),this.pointerEvent=null,t.timeStamp-this.start.t<this.tapDelay&&this.eventTap.dispatch(Object.assign(Object.assign({},this.start),this.controlKeys)))},t.addEventListener("pointerdown",this.handlePointerDown,!0),t.addEventListener("wheel",this.handleCanvasWheel),t.addEventListener("contextmenu",this.handleContextMenu),t.addEventListener("pointermove",this.handlePointerMove),t.addEventListener("pointerup",this.handlePointerUp)}isTouching(t){return!!this.pointerEvent&&(!t||t(this.current))}detach(){const{canvas:t}=this;t&&(t.removeEventListener("pointerdown",this.handlePointerDown),t.removeEventListener("wheel",this.handleCanvasWheel),t.removeEventListener("contextmenu",this.handleContextMenu),t.removeEventListener("pointermove",this.handlePointerMove),t.removeEventListener("pointerup",this.handlePointerUp))}getPoint(t){this.controlKeys={altKey:t.altKey||2===t.buttons,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey};const{left:e,top:i,width:n,height:s}=this.canvas.getBoundingClientRect();return{x:2*((t.clientX-e)/n-.5),y:-2*((t.clientY-i)/s-.5),t:t.timeStamp,fingersCount:1}}}class lt{constructor(t){this.canvas=t,this._keyboard=null,this._pointer=null}get keyboard(){return this._keyboard||(this._keyboard=new ct),this._keyboard}get pointer(){return this._pointer||(this._pointer=new ut(this.canvas)),this._pointer}}class dt{constructor(){this.name="Painter/"+dt.counter++,this.active=!0}debugHierarchy(){return{[this.active?this.name:`${this.name} (Inactive)`]:null}}}dt.log=new class{constructor(){this.level=0,this.lookupTable=new Map}lookup(t,e){var i;if("number"!=typeof e)return JSON.stringify(e);const{lookupTable:n}=this;if(0===n.size)for(const e in t){const i=t[e];"number"==typeof i&&n.set(i,`gl.${e}`)}return null!==(i=n.get(e))&&void 0!==i?i:`gl[${e}]`}call(t,e){const i="  ".repeat(this.level);console.log(`${i}>>>`,t),this.level++;const n=Date.now();try{return e()}catch(t){throw console.error(t),t}finally{this.level--,console.log(`${i}<<<`,t,`(${Date.now()-n} ms)`)}}stateDepth(t){if(console.log("// [State] Depth"),t.getParameter(t.DEPTH_TEST)){console.log("gl.enable( gl.DEPTH_TEST )"),console.log("gl.depthFunc(",this.lookup(t,t.getParameter(t.DEPTH_FUNC)),")"),console.log("gl.depthMask(",this.lookup(t,t.getParameter(t.DEPTH_WRITEMASK)),")");const[e,i]=t.getParameter(t.DEPTH_RANGE);console.log("gl.depthRange(",e,",",i,")")}else console.log("gl.disable( gl.DEPTH_TEST )")}},dt.counter=0;class ft extends dt{constructor(t=[],{onEnter:e,onExit:i,name:n}={}){super(),this.active=!0,this.onEnter=e,this.onExit=i,this.painters=[...t],this.name=null!=n?n:`Group/${this.name}`}forEachChild(t){for(const[e,i]of this.painters.entries())t(i,e)}has(t){return this.painters.includes(t)}add(...t){for(const e of t)this.painters.push(e)}addFirst(...t){for(let e=t.length-1;e>=0;e--){const i=t[e];this.painters.unshift(i)}}remove(...t){for(const e of t){const t=this.painters.indexOf(e);-1!==t&&(this.painters.splice(t,1),e.delete())}}removeAll(){for(const t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}delete(){for(const t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}paint(t,e){var i,n;if(this.active){null===(i=this.onEnter)||void 0===i||i.call(this,t,e);for(const i of this.painters)i.active&&i.paint(t,e);null===(n=this.onExit)||void 0===n||n.call(this,t,e)}}debugHierarchy(){return{[this.active?this.name:`${this.name} (Inactive)`]:this.painters.map((t=>t.debugHierarchy()))}}}function mt(t,e){var i,n;const s=new st(t.transfo).from(e);s.debug(),"number"==typeof e.distance&&(s.distance=e.distance);const r=t.zoom,o=null!==(i=e.zoom)&&void 0!==i?i:r,a=function(t,e,i){const n=t.clone().from({}),s=n.distance,r=n.position.clone(),o=n.scale.clone(),a=n.orientation.clone(),c=t.clone().from(i),u=c.orientation.clone(),l=c.position.clone(),d=c.scale.clone(),f=c.distance;return e=>{t.distance=h(s,f,e),t.position.fromMix(r,l,e),t.scale.fromMix(o,d,e),t.orientation.fromSlerp(a,u,e),t.updateMatrix()}}(t.transfo,0,s),c=t.spaceHeightAtTarget,u=null!==(n=e.spaceHeightAtTarget)&&void 0!==n?n:t.spaceHeightAtTarget;return i=>{a(i),"number"==typeof e.spaceHeightAtTarget&&(t.spaceHeightAtTarget=h(c,u,i)),t.zoom=h(r,o,i)}}function gt(t){return 1-(1-t)*(1-t)}var pt=i(5664);function Et(t,e){return(0,pt.sH)(this,void 0,void 0,(function*(){if(!t)return!1;try{return yield t.requestFullscreen(null!=e?e:{navigationUI:"hide"}),!0}catch(t){return!1}}))}function At(){return(0,pt.sH)(this,void 0,void 0,(function*(){if(!document.fullscreenElement)return!1;try{return yield document.exitFullscreen(),!0}catch(t){return!1}}))}const bt={index:"number",texCoord:["?","number"]};var _t,xt,yt,vt,Rt,Tt,Lt;Object.assign(Object.assign({},bt),{scale:["?","number"]}),Object.assign(Object.assign({},bt),{strength:["?","number"]}),function(t){t[t.NEVER=WebGL2RenderingContext.NEVER]="NEVER",t[t.LESS=WebGL2RenderingContext.LESS]="LESS",t[t.EQUAL=WebGL2RenderingContext.EQUAL]="EQUAL",t[t.LEQUAL=WebGL2RenderingContext.LEQUAL]="LEQUAL",t[t.GREATER=WebGL2RenderingContext.GREATER]="GREATER",t[t.NOTEQUAL=WebGL2RenderingContext.NOTEQUAL]="NOTEQUAL",t[t.GEQUAL=WebGL2RenderingContext.GEQUAL]="GEQUAL",t[t.ALWAYS=WebGL2RenderingContext.ALWAYS]="ALWAYS"}(_t||(_t={})),function(t){t[t.FUNC_ADD=WebGL2RenderingContext.FUNC_ADD]="FUNC_ADD",t[t.FUNC_SUBTRACT=WebGL2RenderingContext.FUNC_SUBTRACT]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=WebGL2RenderingContext.FUNC_REVERSE_SUBTRACT]="FUNC_REVERSE_SUBTRACT",t[t.MIN=WebGL2RenderingContext.MIN]="MIN",t[t.MAX=WebGL2RenderingContext.MAX]="MAX"}(xt||(xt={})),function(t){t[t.ZERO=WebGL2RenderingContext.ZERO]="ZERO",t[t.ONE=WebGL2RenderingContext.ONE]="ONE",t[t.SRC_COLOR=WebGL2RenderingContext.SRC_COLOR]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=WebGL2RenderingContext.ONE_MINUS_SRC_COLOR]="ONE_MINUS_SRC_COLOR",t[t.DST_COLOR=WebGL2RenderingContext.DST_COLOR]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=WebGL2RenderingContext.ONE_MINUS_DST_COLOR]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA=WebGL2RenderingContext.SRC_ALPHA]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=WebGL2RenderingContext.ONE_MINUS_SRC_ALPHA]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=WebGL2RenderingContext.DST_ALPHA]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=WebGL2RenderingContext.ONE_MINUS_DST_ALPHA]="ONE_MINUS_DST_ALPHA",t[t.CONSTANT_COLOR=WebGL2RenderingContext.CONSTANT_COLOR]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=WebGL2RenderingContext.ONE_MINUS_CONSTANT_COLOR]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=WebGL2RenderingContext.CONSTANT_ALPHA]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=WebGL2RenderingContext.ONE_MINUS_CONSTANT_ALPHA]="ONE_MINUS_CONSTANT_ALPHA",t[t.SRC_ALPHA_SATURATE=WebGL2RenderingContext.SRC_ALPHA_SATURATE]="SRC_ALPHA_SATURATE"}(yt||(yt={})),function(t){t[t.NEVER=WebGL2RenderingContext.NEVER]="NEVER",t[t.LESS=WebGL2RenderingContext.LESS]="LESS",t[t.EQUAL=WebGL2RenderingContext.EQUAL]="EQUAL",t[t.LEQUAL=WebGL2RenderingContext.LEQUAL]="LEQUAL",t[t.GREATER=WebGL2RenderingContext.GREATER]="GREATER",t[t.NOTEQUAL=WebGL2RenderingContext.NOTEQUAL]="NOTEQUAL",t[t.GEQUAL=WebGL2RenderingContext.GEQUAL]="GEQUAL",t[t.ALWAYS=WebGL2RenderingContext.ALWAYS]="ALWAYS"}(vt||(vt={})),function(t){t[t.KEEP=WebGL2RenderingContext.KEEP]="KEEP",t[t.ZERO=WebGL2RenderingContext.ZERO]="ZERO",t[t.REPLACE=WebGL2RenderingContext.REPLACE]="REPLACE",t[t.INCR=WebGL2RenderingContext.INCR]="INCR",t[t.INCR_WRAP=WebGL2RenderingContext.INCR_WRAP]="INCR_WRAP",t[t.DECR=WebGL2RenderingContext.DECR]="DECR",t[t.DECR_WRAP=WebGL2RenderingContext.DECR_WRAP]="DECR_WRAP",t[t.INVERT=WebGL2RenderingContext.INVERT]="INVERT"}(Rt||(Rt={})),function(t){t[t.FRONT=WebGL2RenderingContext.FRONT]="FRONT",t[t.BACK=WebGL2RenderingContext.BACK]="BACK",t[t.FRONT_AND_BACK=WebGL2RenderingContext.FRONT_AND_BACK]="FRONT_AND_BACK"}(Tt||(Tt={})),function(t){t[t.ALPHA=WebGL2RenderingContext.ALPHA]="ALPHA",t[t.RGB=WebGL2RenderingContext.RGB]="RGB",t[t.RGBA=WebGL2RenderingContext.RGBA]="RGBA",t[t.LUMINANCE=WebGL2RenderingContext.LUMINANCE]="LUMINANCE",t[t.LUMINANCE_ALPHA=WebGL2RenderingContext.LUMINANCE_ALPHA]="LUMINANCE_ALPHA"}(Lt||(Lt={}));const wt={off:{enabled:!1,equationColor:xt.FUNC_ADD,functionColorSrc:yt.SRC_ALPHA,functionColorDst:yt.ONE_MINUS_SRC_ALPHA,equationAlpha:xt.FUNC_ADD,functionAlphaSrc:yt.ONE,functionAlphaDst:yt.ZERO},alpha:{enabled:!0,equationColor:xt.FUNC_ADD,functionColorSrc:yt.SRC_ALPHA,functionColorDst:yt.ONE_MINUS_SRC_ALPHA,equationAlpha:xt.FUNC_ADD,functionAlphaSrc:yt.ONE,functionAlphaDst:yt.ZERO},add:{enabled:!0,equationColor:xt.FUNC_ADD,functionColorSrc:yt.ONE,functionColorDst:yt.ONE,equationAlpha:xt.FUNC_ADD,functionAlphaSrc:yt.ONE,functionAlphaDst:yt.ZERO},premultipliedAlpha:{enabled:!0,equationColor:xt.FUNC_ADD,functionColorSrc:yt.ONE,functionColorDst:yt.ONE_MINUS_SRC_ALPHA,equationAlpha:xt.FUNC_ADD,functionAlphaSrc:yt.ONE,functionAlphaDst:yt.ZERO}};function Ct(t,e){e.enabled?t.enable(t.BLEND):t.disable(t.BLEND),t.blendEquationSeparate(e.equationColor,e.equationAlpha),t.blendFuncSeparate(e.functionColorSrc,e.functionColorDst,e.functionAlphaSrc,e.functionAlphaDst)}function St(t){return{enabled:Boolean(t.getParameter(t.BLEND)),equationAlpha:t.getParameter(t.BLEND_EQUATION_ALPHA),equationColor:t.getParameter(t.BLEND_EQUATION_RGB),functionAlphaDst:t.getParameter(t.BLEND_DST_ALPHA),functionAlphaSrc:t.getParameter(t.BLEND_SRC_ALPHA),functionColorDst:t.getParameter(t.BLEND_DST_RGB),functionColorSrc:t.getParameter(t.BLEND_SRC_ALPHA)}}function Pt(t,e){e.enabled?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.cullFace(e.cullFace)}function Mt(t){return{enabled:Boolean(t.getParameter(t.CULL_FACE)),cullFace:t.getParameter(t.CULL_FACE_MODE)}}function Ft(t,e){e.enabled?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthFunc(e.func),t.depthMask(e.mask),t.depthRange(e.rangeMin,e.rangeMax)}function Nt(t){const[e,i]=t.getParameter(t.DEPTH_RANGE);return{enabled:Boolean(t.getParameter(t.DEPTH_TEST)),func:Number(t.getParameter(t.DEPTH_FUNC)),mask:Boolean(t.getParameter(t.DEPTH_WRITEMASK)),rangeMin:e,rangeMax:i}}Tt.BACK,Tt.BACK,Tt.FRONT,_t.ALWAYS,_t.ALWAYS,_t.LESS,_t.LEQUAL,_t.LESS,_t.LEQUAL;const Ut={off:{enabled:!1,maskBack:0,maskFront:0,functionBack:vt.ALWAYS,functionBackMask:0,functionBackRef:0,functionFront:vt.ALWAYS,functionFrontMask:0,functionFrontRef:0,operationBack1FailStencil:Rt.KEEP,operationBack2FailDepth:Rt.KEEP,operationBack3Pass:Rt.KEEP,operationFront1FailStencil:Rt.KEEP,operationFront2FailDepth:Rt.KEEP,operationFront3Pass:Rt.KEEP},write:t=>({enabled:!0,maskBack:255,maskFront:255,functionBack:vt.ALWAYS,functionBackRef:t,functionBackMask:255,functionFront:vt.ALWAYS,functionFrontRef:t,functionFrontMask:255,operationBack1FailStencil:Rt.KEEP,operationBack2FailDepth:Rt.KEEP,operationBack3Pass:Rt.REPLACE,operationFront1FailStencil:Rt.KEEP,operationFront2FailDepth:Rt.KEEP,operationFront3Pass:Rt.REPLACE}),paintIfEqual:t=>({enabled:!0,maskBack:0,maskFront:0,functionBack:vt.EQUAL,functionBackRef:t,functionBackMask:255,functionFront:vt.EQUAL,functionFrontRef:t,functionFrontMask:255,operationBack1FailStencil:Rt.KEEP,operationBack2FailDepth:Rt.KEEP,operationBack3Pass:Rt.KEEP,operationFront1FailStencil:Rt.KEEP,operationFront2FailDepth:Rt.KEEP,operationFront3Pass:Rt.KEEP})};function Ot(t,e){e.enabled?(t.enable(t.STENCIL_TEST),t.stencilFuncSeparate(t.FRONT,e.functionFront,e.functionFrontRef,e.functionFrontMask),t.stencilFuncSeparate(t.BACK,e.functionBack,e.functionBackRef,e.functionBackMask),t.stencilOpSeparate(t.FRONT,e.operationFront1FailStencil,e.operationFront2FailDepth,e.operationFront3Pass),t.stencilOpSeparate(t.BACK,e.operationBack1FailStencil,e.operationBack2FailDepth,e.operationBack3Pass),t.stencilMaskSeparate(t.FRONT,e.maskFront),t.stencilMaskSeparate(t.BACK,e.maskBack)):t.disable(t.STENCIL_TEST)}class Bt{constructor(){this.animations=new Map}schedule(t){var e;t.name||(t.name="TgdAnimation#"+Bt.counter++);const{action:i,duration:n,easingFunction:s,repeat:r}=t;return this.animations.set(t,{start:-1,delay:null!==(e=t.delay)&&void 0!==e?e:0,duration:n,inverseDuration:1/n,action:s?t=>i(s(t)):i,loop:1,repeat:null!=r?r:1,cancel:()=>this.cancel(t),onEnd:t.onEnd}),t}cancel(t){this.animations.delete(t)}paint(t){var e;if(0===this.animations.size)return!1;for(const i of this.animations.values()){i.start<0&&(i.start=t+i.delay);const n=t-i.start;if(n<0)continue;const s=Math.min(1,i.inverseDuration*n);for(i.action(s);t>i.start+i.duration;){try{null===(e=i.onEnd)||void 0===e||e.call(i)}catch(t){console.error("Animation.onEnd() failed for",i),console.error(t)}i.loop++,i.start+=i.duration}i.loop>i.repeat&&i.cancel()}return!0}}Bt.counter=1;class Dt{constructor(t,e={}){var i,n;this.canvas=t,this.options=e,this.eventPaint=new ht,this.resolution=1,this._camera=new at({transfo:{distance:15},far:100,near:.1,fovy:Math.PI/8,zoom:1}),this._fps=0,this._aspectRatio=1,this._aspectRatioInverse=1,this.paintingIsOngoing=!1,this.paintingIsQueued=!1,this.isPlaying=!1,this.requestAnimationFrame=-1,this.lastTime=-1,this.timeShift=0,this.animationManager=new Bt,this.paint=()=>{this.paintingIsOngoing?this.paintingIsQueued=!0:(this.paintingIsQueued=!1,this.paintingIsOngoing=!0,globalThis.cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=globalThis.requestAnimationFrame(this.actualPaint))},this.actualPaint=t=>{try{this.timeShift=t-Date.now();const{lastTime:e,gl:i}=this;if(e<0)return this.lastTime=t,void this.paint();const n=t-this.lastTime;this._fps=Math.round(1/n),this.lastTime=t,this._camera.screenWidth=i.drawingBufferWidth,this._camera.screenHeight=i.drawingBufferHeight,this._aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,this._aspectRatioInverse=1/this._aspectRatio;const s=.001*t,r=.001*n;this.painters.paint(s,r),this.eventPaint.dispatch(this),(this.paintingIsQueued||this.animationManager.paint(s)||this.isPlaying)&&(this.paintingIsOngoing=!1,this.paint())}catch(t){console.error(t)}finally{this.paintingIsOngoing=!1}};const s=t.getContext("webgl2",e);if(!s)throw new Error("Unable to create a WebGL2 context!");this.resolution=null!==(i=e.resolution)&&void 0!==i?i:1,e.enableTextureFloatStorage&&s.getExtension("EXT_color_buffer_float"),this.implementationColorReadFormat=s.getParameter(s.IMPLEMENTATION_COLOR_READ_FORMAT),this.implementationColorReadType=s.getParameter(s.IMPLEMENTATION_COLOR_READ_TYPE),this.gl=s,this.observer=new ResizeObserver((()=>{const i=t.clientWidth*this.resolution,n=t.clientHeight*this.resolution,{onResize:r}=e;r?r(this,t.clientWidth,t.clientHeight):(t.width=i,t.height=n),s.viewport(0,0,t.width,t.height),this.paint()})),this.observer.observe(t),this.inputs=new lt(t),e.camera&&(this._camera=e.camera),this.painters=new ft,this.name=null!==(n=e.name)&&void 0!==n?n:"Context#"+Dt.incrementalId++,this.painters.name=this.name,t.style.touchAction="none",this.stateReset()}get fps(){return this._fps}get time(){return Date.now()+this.timeShift}debugHierarchy(){return this.painters.debugHierarchy()}get camera(){return this._camera}set camera(t){t!==this._camera&&(this._camera=t,this.paint())}animSchedule(...t){var e,i;const n=[];let s=0;for(const r of t){const t=r.duration+(null!==(e=r.delay)&&void 0!==e?e:0);r.delay=s+(null!==(i=r.delay)&&void 0!==i?i:0),s+=t,n.push(this.animationManager.schedule(r))}return this.paint(),n}animCancel(t){this.animationManager.cancel(t)}get onEnter(){return this.painters.onEnter}set onEnter(t){this.painters.onEnter=t}get onExit(){return this.painters.onExit}set onExit(t){this.painters.onExit=t}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}get aspectRatio(){return this._aspectRatio}get aspectRatioInverse(){return this._aspectRatioInverse}get playing(){return this.isPlaying}set playing(t){t!==this.isPlaying&&(t?this.paint():(this.paintingIsOngoing=!1,this.paintingIsQueued=!1,globalThis.cancelAnimationFrame(this.requestAnimationFrame)),this.isPlaying=t)}play(){this.playing=!0}pause(){this.playing=!1}has(t){return this.painters.has(t)}add(...t){this.painters.add(...t)}addFirst(...t){this.painters.addFirst(...t)}remove(...t){this.painters.remove(...t)}removeAll(){this.painters.removeAll()}takeSnapshot(t){const e=t.getContext("2d");if(!e)throw new Error("[TgdContext.takeSnapshot] We cannot get a 2D context for the target canvas! Maybe it already has another type of context.");const{width:i,height:n}=t,s=function(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}(i,n),r=new Dt(s,this.options);this.painters.forEachChild((t=>r.add(t))),r.actualPaint(this.lastTime),r.gl.finish(),e.drawImage(s,0,0)}lookupWebglConstant(t){const{gl:e}=this;for(const i in e)if(e[i]===t)return i;return`Unknown gl[${t}]`}destroy(){this.pause(),this.painters.delete(),this.observer.unobserve(this.canvas)}stateReset(){const{gl:t}=this,e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(let i=0;i<e;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(i);const n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(let e=0;e<n;++e)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);return t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t}}Dt.incrementalId=1;class It{constructor(t,{geo:e,minZoom:i=.001,maxZoom:n=1/0,speedZoom:s=1,speedOrbit:r=1,speedPanning:o=1,inertiaZoom:a=0,inertiaOrbit:h=0,inertiaPanning:c=0,fixedTarget:u=!1,debug:l=!1,onZoomRequest:d=kt}={}){this.context=t,this.id="TgdControllerCameraOrbit-"+It.counter++,this.eventChange=new ht,this.minZoom=.001,this.maxZoom=1/0,this.speedZoom=1,this.speedOrbit=1,this.speedPanning=1,this.inertiaZoom=0,this.inertiaOrbit=0,this.inertiaPanning=0,this.fixedTarget=!1,this._enabled=!0,this.animOrbit=null,this.disabledUntil=0,this.tmpQuat=new tt,this.handleMove=t=>{this.enabled&&!this.animOrbit&&this.actualMove(t)},this.actualMove=t=>{if(t.current.t-t.previous.t<=0)return;const{context:e}=this,{keyboard:i}=e.inputs;if(t.altKey||2===t.current.fingersCount)return this.handlePan(t);if(this.geo){const e=i.isDown("Shift")?.2:2,n=i.isDown("x")?0:e*(t.previous.x-t.current.x),s=i.isDown("y")?0:e*(t.previous.y-t.current.y),r=this.geo.lng+n,o=this.geo.lat+s;this.orbitGeo(o,r)}else{if(i.isDown("z"))return this.handleRotateAroundZ(t);this.orbit(t.current.x-t.previous.x,t.current.y-t.previous.y,t.shiftKey)}},this.handleMoveStart=()=>{if(!this.enabled)return;const{animOrbit:t,context:e}=this;t&&(e.animCancel(t),this.animOrbit=null)},this.handleMoveEnd=t=>{if(!this.enabled)return;const{context:e,inertiaOrbit:i}=this;if(i>0){const n=1/(t.current.t-t.previous.t),s=n*(t.current.x-t.previous.x),r=n*(t.current.y-t.previous.y),o=structuredClone(t);o.current.t=Date.now(),this.animOrbit={duration:.001*i,action:t=>{o.previous.t=o.current.t,o.previous.x=o.current.x,o.previous.y=o.current.y,o.previous.fingersCount=o.current.fingersCount,o.current.t=Date.now();const e=(1-t)*(o.current.t-o.previous.t);o.current.x+=e*s,o.current.y+=e*r,this.actualMove(o)},easingFunction:gt},e.animSchedule(this.animOrbit)}},this.handleZoom=t=>{if(!this.enabled||0===this.speedZoom||!this.onZoomRequest({altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,x:t.current.x,y:t.current.y}))return;const{context:e}=this,{camera:i}=e;let n=.1*this.speedZoom;this.context.inputs.keyboard.isDown("Shift")&&(n*=.1);const s=-t.direction*n;i.transfo.distance=Math.max(0,i.transfo.distance+s),t.preventDefault(),this.fireZoomChange()},this.geo=void 0,e&&(this.geo=Object.assign({lat:0,lng:0,minLat:-Math.PI/2,maxLat:+Math.PI/2,minLng:-Number.MAX_VALUE,maxLng:+Number.MAX_VALUE},e)),this.cameraInitialState=t.camera.getCurrentState();const{inputs:f}=t;f.pointer.eventMoveStart.addListener(this.handleMoveStart),f.pointer.eventMoveEnd.addListener(this.handleMoveEnd),f.pointer.eventMove.addListener(this.handleMove),f.pointer.eventZoom.addListener(this.handleZoom),this.speedOrbit=r,this.speedZoom=s,this.speedPanning=o,this.inertiaOrbit=h,this.inertiaZoom=a,this.inertiaPanning=c,this.fixedTarget=u,this.minZoom=i,this.maxZoom=n,this.onZoomRequest=d,this.geo&&this.orbitGeo(this.geo.lat,this.geo.lng),globalThis.setTimeout((()=>t.paint())),l&&t.inputs.keyboard.eventKeyPress.addListener((t=>{"?"===t.key&&console.log(this.context.camera.toCode())}))}get enabled(){return this.context.time>this.disabledUntil&&this._enabled}set enabled(t){this._enabled=t}reset(t,e){const{context:i}=this;this.disableForSomeTime(t),i.animSchedule({action:mt(i.camera,this.cameraInitialState),duration:t,easingFunction:e})}disableForSomeTime(t){this.disabledUntil=Math.max(this.disabledUntil,this.context.time+t)}detach(){const{inputs:t}=this.context;t.pointer.eventMove.removeListener(this.handleMove),t.pointer.eventZoom.removeListener(this.handleZoom)}orbit(t,e,i){const{context:n}=this,{camera:s}=n,{keyboard:r}=n.inputs,o=3*(i?.1:1)*this.speedOrbit,a=t*o,h=e*o;r.isDown("x")||s.transfo.orbitAroundY(a),r.isDown("y")||s.transfo.orbitAroundX(-h),this.fireOrbitChange()}orbitGeo(t,e){const{geo:i}=this;if(!i)return;t=a(t,i.minLat,i.maxLat),i.lat=t,e=a(e,i.minLng,i.maxLng),i.lng=e;const{orientation:n}=this.cameraInitialState,s=Wt(t,e),r=Wt(t+Math.PI/2,e),o=new d(r).cross(s),h=new U;n.toMatrix(h);const c=new U(o,r,s);c.multiply(h),this.tmpQuat.fromMatrix(c),this.context.camera.transfo.orientation=this.tmpQuat,this.fireOrbitChange()}handlePan(t){const{fixedTarget:e,speedPanning:i,context:n}=this,{camera:s}=n,r=.5*i*(1/s.zoom),o=(t.current.x-t.previous.x)*r*s.spaceWidthAtTarget,a=(t.current.y-t.previous.y)*r*s.spaceHeightAtTarget;e||s.transfo.moveAlongAxes(-o,-a,0),this.fireOrbitChange()}handleRotateAroundZ(t){const{camera:e}=this.context,i=t.previous.x,n=t.previous.y;if(Math.abs(i)+Math.abs(n)===0)return;const s=t.current.x,r=t.current.y;if(Math.abs(s)+Math.abs(r)===0)return;const o=i*s+n*r,a=i*r-n*s,h=Math.atan2(a,o)*this.speedOrbit;e.transfo.orbitAroundZ(h),this.fireOrbitChange()}fireOrbitChange(){this.context.paint(),this.eventChange.dispatch(this.context.camera)}fireZoomChange(){this.context.paint()}}It.counter=0;const kt=()=>!0;function Wt(t,e){const i=Math.cos(t),n=Math.sin(t),s=i*Math.cos(e),r=i*Math.sin(e);return new d(r,n,s)}function Gt(t){if("string"==typeof t)return!0;if(!Array.isArray(t))return!1;for(const e of t)if(!Gt(e))return!1;return!0}function Ht(t,e="",i){if("string"==typeof t)return`${e}${t}`;if(!t)return"";const n=null!=i?i:new Set;if(!Array.isArray(t))return Object.keys(t).map((e=>n.has(e)?null:(n.add(e),`// ${e}\n${t[e]}\n`))).filter((t=>"string"==typeof t)).join("\n");const s=`${e}    `;return t.filter((t=>null!==t)).filter((t=>!Array.isArray(t)||t.length>0)).map((t=>Ht(t,s,n))).join("\n")}function jt(t,e,i="----------------------------------------"){const n=Object.keys(t);return 0===n.length?[]:[`// ${i}`,...n.map((i=>`${e} ${t[i]} ${i};`))]}function $t(t,e){if(Gt(t))return[t];const i=Object.keys(t);if(0===i.length)return[];const n=e?[`// ${e}`]:[];for(const e of i)n.push(t[e],"");return n}class zt{constructor(t,e){var i;this.gl=t,this.options=e;const n=t.createProgram();if(!n)throw new Error("Unable to create WebGLProgram!");const s=Ht(e.vert),r=this.createShader("VERTEX_SHADER",s);t.attachShader(n,r);const o=Ht(e.frag),a=this.createShader("FRAGMENT_SHADER",o);t.attachShader(n,a);const{transformFeedback:h}=e;if(h){const e=Array.isArray(h)?t.INTERLEAVED_ATTRIBS:t[h.bufferMode],i=Array.isArray(h)?h:h.varyings;t.transformFeedbackVaryings(n,i,e)}if(t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){const e=null!==(i=t.getProgramInfoLog(n))&&void 0!==i?i:"";console.warn(e);const r=Kt(e),a=[Yt("Vertex Shader",s,r),Yt("Fragment Shader",o,r)].join("\n");throw new Error(a)}this.program=n,this.shaders=[r,a],this.uniformsLocations=this.getUniformsLocations(),t.detachShader(n,r),t.deleteShader(r),t.detachShader(n,a),t.deleteShader(a)}toCode({indent:t=""}={}){return["function createProgram(gl: WebGL2RenderingContext) {","  const prg = gl.createProgram()","  const vertexShader = gl.createShader(gl.VERTEX_SHADER)",`  gl.shaderSource(vertexShader, \`${Ht(this.options.vert)}\`)`,"  gl.compileShader(vertexShader)","  const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)",`  gl.shaderSource(fragmentShader, \`${Ht(this.options.frag)}\`)`,"  gl.compileShader(fragmentShader)","  gl.attachShader(prg, vertexShader)","  gl.attachShader(prg, fragmentShader)","  gl.linkProgram(prg)","  return prg","}"].map((e=>`${t}${e}`)).join("\n")}hasAttribute(t){const{gl:e,program:i}=this;return e.getAttribLocation(i,t)>=0}getAttribLocation(t){const{gl:e,program:i}=this,n=e.getAttribLocation(i,t);if(n<0)throw new Error(`Attribute "${t}" not found!`);return n}getUniformLocation(t){const{uniformsLocations:e}=this,i=Object.keys(e);if(0===t.length)return console.warn(`Uniform "${t}" has not been found: there is no active uniform in this program!`),0;const n=e[t];return n||console.warn(`No active uniform found with name "${t}"!\nAvailable names are: ${i.join(", ")}.`),n}uniform1f(t,e){const{gl:i}=this;i.uniform1f(this.getUniformLocation(t),e)}uniform2f(t,e,i){const{gl:n}=this;n.uniform2f(this.getUniformLocation(t),e,i)}uniform3f(t,e,i,n){const{gl:s}=this;s.uniform3f(this.getUniformLocation(t),e,i,n)}uniform3fv(t,e){const{gl:i}=this;i.uniform3fv(this.getUniformLocation(t),e)}uniform4f(t,e,i,n,s){const{gl:r}=this;r.uniform4f(this.getUniformLocation(t),e,i,n,s)}uniform4fv(t,e){const{gl:i}=this;i.uniform4fv(this.getUniformLocation(t),e)}uniform1i(t,e){const{gl:i}=this;i.uniform1i(this.getUniformLocation(t),e)}uniform2i(t,e,i){const{gl:n}=this;n.uniform2i(this.getUniformLocation(t),e,i)}uniform3i(t,e,i,n){const{gl:s}=this;s.uniform3i(this.getUniformLocation(t),e,i,n)}uniform4i(t,e,i,n,s){const{gl:r}=this;r.uniform4i(this.getUniformLocation(t),e,i,n,s)}uniform1ui(t,e){const{gl:i}=this;i.uniform1ui(this.getUniformLocation(t),e)}uniform2ui(t,e,i){const{gl:n}=this;n.uniform2ui(this.getUniformLocation(t),e,i)}uniform3ui(t,e,i,n){const{gl:s}=this;s.uniform3ui(this.getUniformLocation(t),e,i,n)}uniform4ui(t,e,i,n,s){const{gl:r}=this;r.uniform4ui(this.getUniformLocation(t),e,i,n,s)}uniformMatrix2fv(t,e){const{gl:i}=this;i.uniformMatrix2fv(this.getUniformLocation(t),!1,e)}uniformMatrix3fv(t,e){const{gl:i}=this;i.uniformMatrix3fv(this.getUniformLocation(t),!1,e)}uniformMatrix4fv(t,e){const{gl:i}=this;i.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}use(){const{gl:t,program:e}=this;t.useProgram(e)}delete(){const{gl:t}=this;for(const e of this.shaders)t.deleteShader(e);t.deleteProgram(this.program)}debug(t="TgdProgram"){console.log(t);const{options:e}=this;Yt("Vertex Shader",Ht(e.vert)),Yt("Fragment Shader",Ht(e.frag))}createShader(t,e){const{gl:i}=this,n=i.createShader(i[t]);if(!n)throw new Error(`Unable to create a WebGLShader of type "${t}"!`);i.shaderSource(n,e),i.compileShader(n);const s=i.getShaderInfoLog(n);if(s){console.error(`Error in ${t} code:`,s);const i=Kt(s);throw new Error(Yt(t,e,i))}return n}getUniformsLocations(){const{gl:t,program:e}=this,i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);if("number"!=typeof i)throw new Error("Unable to get the number of uniforms in a WebGLProgram!");const n={};for(let s=0;s<i;s++){const i=t.getActiveUniform(e,s);if(!i)continue;const r=t.getUniformLocation(e,i.name);if(null===r)throw new Error(`Unable to get location for uniform "${i.name}"!`);n[i.name]=r}return n}}const Xt=/^ERROR:[ \t]+([0-9]+):([0-9]+):/g;function Kt(t){const e=[],i=[];for(const n of t.split("\n")){Xt.lastIndex=-1;const t=Xt.exec(n);t&&(e.push(Number.parseInt(t[2],10)),i.push(n.slice(t[0].length).trim()))}return{lines:e,messages:i}}function Zt(t,e=!1){return`color:#fff;background:${t};font-family:monospace;font-size:80%;font-weight:${e?"bolder":"100"};margin:0;color:${e?"#777":"#fff"}`}function Yt(t,e,i){const{lines:n=[],messages:s=[]}=null!=i?i:{},r=[t],o=[`%c${t}`],a=["font-weight:bolder;font-size:120%"];let h=!1;for(const[t,i]of e.split("\n").entries()){const e=t+1,c=`${e}`.padStart(5," "),u=n.includes(e)?"#f00":"#000";o.push(`%c${c}  %c${i}`),r.push(`${c}  ${i}`),a.push(Zt(u,!0),Zt(u,!1)),n.includes(e)&&(h=!0,o.push(`%c${s[n.indexOf(e)]}`),r.push(`##### ${s[n.indexOf(e)]}`),a.push("color:#f33;background:#333;font-weight:bold"),console.error())}return console.log(o.join("\n"),...a),h?r.join("\n"):""}class Vt{constructor(t,e={}){var i,n;this.attributesDefinition=t,this.options=e,this.stride=0,this.definitions={},this._data=new ArrayBuffer(0),this._count=0,this.target=null!==(i=e.target)&&void 0!==i?i:"ARRAY_BUFFER",this.usage=null!==(n=e.usage)&&void 0!==n?n:"STATIC_DRAW",this.initialize(t,e)}initialize(t,e={}){var i;for(const e of Object.keys(t)){const i=t[e];this.attributesDefinition[e]=i}const n=null!==(i=e.divisor)&&void 0!==i?i:0;let s=0;const r={},o={};for(const e of Object.keys(t)){r[e]=new ArrayBuffer(0);const i={dimension:Qt[t[e]],byteOffset:s,bytesPerElement:Float32Array.BYTES_PER_ELEMENT,divisor:n,getter:(t,e)=>(e>=t.byteLength&&(e%=t.byteLength),t.getFloat32(e,!0)),setter(t,e,i){t.setFloat32(e,i,!0)}};o[e]=i,s+=i.bytesPerElement*i.dimension}this.definitions=o,this.stride=s,this._data=qt(this._data,this.count*this.stride)}assertAttribType(t,...e){const i=this.attributesDefinition[t];if(!i)throw new Error(`Attribute "${t}" does not exist! Available names are: ${Object.keys(this.attributesDefinition).join(", ")}.`);if(!e.includes(i))throw new Error(`Attribute "${t}" is of type "${i}", which is not ${e.join(" nor ")}!`);return this}addAttributes(t){const e=this.clone();for(const e of Object.keys(t)){const i=this.attributesDefinition[e],n=t[e];if(i&&i!==n)throw new Error(`It is not allowed to change the type of attribute "${e}" from "${i}" to "${n}"! Prefer removing the attribute first.`)}this.initialize(Object.assign(Object.assign({},this.attributesDefinition),t),this.options);const i=this;i.count=e.count;for(const t of e.attributesNames)try{const{get:n}=e.getAttribAccessor(t),{set:s}=i.getAttribAccessor(t);for(let i=0;i<e.count;i++){const e=this.getDef(t);for(let t=0;t<e.dimension;t++)s(n(i,t),i,t)}}catch(e){const i=e instanceof Error?e.message:JSON.stringify(e);throw new Error(`Unable to clone attribute "${t}"!\n${i}`)}}clone(){const t=new Vt(structuredClone(this.attributesDefinition),this.options);t.count=this.count;const e=new DataView(this._data),i=new DataView(t._data);for(let t=0;t<e.byteLength;t++)i.setUint8(t,e.getUint8(t));return t}get data(){return this._data}get count(){return this._count}set count(t){this._count!==t&&(this._count=t,this._data=qt(this._data,t*this.stride))}get attributesNames(){return Object.keys(this.attributesDefinition)}getAttribAccessor(t){const e=this.getDef(t),i=new DataView(this.data),n=this.stride;return{get(t,s=0){const r=e.byteOffset+n*t+s*e.bytesPerElement;return e.getter(i,r)},set(t,s,r=0){const o=e.byteOffset+n*s+r*e.bytesPerElement;e.setter(i,o,t)}}}set(t,e,{byteOffset:i=0,byteStride:n,first:s=0,count:r=1/0,targetFirst:o=0}={}){const{bytesPerElement:a,dimension:h,byteOffset:c}=this.getDef(t),u=e instanceof ArrayBuffer?e:e.buffer,l=a*h,d=null!=n?n:l;let f=i+d*s;const m=this.stride;let g=o*m+c;this.count=Math.max(this.count,Math.min(r,Math.floor((u.byteLength-f)/d)));const p=u.byteLength-d+1,E=this._data.byteLength+c-m+1,A=new Uint8Array(u),b=new Uint8Array(this._data);let _=0;for(;_<r&&f<p&&g<E;)b.set(A.subarray(f,f+l),g),_++,f+=d,g+=m}getDef(t){const e=this.definitions[t];if(!e)throw new Error(`[TgdDataset] Attribute "${String(t)}" not found in this DataSet!\nAvailable names are: ${Object.keys(this.definitions).map((t=>JSON.stringify(t))).join(", ")}.`);return e}defineAttributes(t,e){let i=0;const{definitions:n}=this;for(const s of Object.keys(n)){const r=n[s];if(e.hasAttribute(s)){const n=e.getAttribLocation(s);t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r.dimension,t.FLOAT,!1,this.stride,i),t.vertexAttribDivisor(n,r.divisor)}i+=r.dimension*r.bytesPerElement}}toCode({indent:t=""}={}){const e=[];let i=0;const{definitions:n}=this;for(const t of Object.keys(n)){const s=n[t],r=`$${t}`;e.push(`const ${r} = gl.getAttribLocation(prg, "${t}")`,`gl.enableVertexAttribArray(${r})`,"gl.vertexAttribPointer(",`  ${r},`,`  ${s.dimension},  // Dimension`,"  gl.FLOAT,","  false,",`  ${this.stride},   // Stride`,`  ${i}   // Offset`,")",`gl.vertexAttribDivisor(${r}, ${s.divisor})`),i+=s.dimension*s.bytesPerElement}return e.map((e=>`${t}${e}`)).join("\n")}debug(t="Dataset"){console.log(t,"   count:",this.count,"   target:",this.target,"   usage:",this.usage);const e=[["Name","type","offset"]];for(const t of Object.keys(this.definitions)){const i=this.definitions[t];e.push([t,this.attributesDefinition[t],`${i.byteOffset}`])}const i=[0,1,2].map((t=>e.reduce(((e,i)=>Math.max(e,i[t].length)),0)));for(const[t,n,s]of e)console.log(`%c${t.padEnd(i[0]+2)}${n.padStart(i[1]+2)}${s.padStart(i[2]+2)}`,"font-family:monospace");for(const t of Object.keys(this.definitions)){const e=this.definitions[t];if(!e)continue;const{get:i}=this.getAttribAccessor(t),n=[];for(let t=0;t<this.count;t++){const s=[];for(let n=0;n<e.dimension;n++)s.push(i(t,n));n.push(s)}console.log(`Attribute "${t}":`,n)}}}const Qt={float:1,vec2:2,vec3:3,vec4:4},qt="function"==typeof ArrayBuffer.prototype.transfer?function(t,e){return t.transfer(e)}:function(t,e){const i=new ArrayBuffer(null!=e?e:t.byteLength);return new Uint8Array(i).set(new Uint8Array(t)),i};class Jt{constructor(t,e={}){var i,n;this.gl=t;const s=t.createBuffer();if(!s)throw new Error("Unable to create WebGLBuffer!");this._target=null!==(i=null==e?void 0:e.target)&&void 0!==i?i:"ARRAY_BUFFER",this._usage=null!==(n=null==e?void 0:e.usage)&&void 0!==n?n:"STATIC_DRAW",this.buffer=s;const{data:r}=e;r&&this.bufferData(Object.assign(Object.assign({},e),{data:r}))}get target(){return this._target}bind(t){const{gl:e,buffer:i}=this;this._target=null!=t?t:this._target,e.bindBuffer(e[this._target],i)}bufferData(t){var e,i;const{gl:n}=this;this._usage=null!==(e=t.usage)&&void 0!==e?e:this._usage,this._target=null!==(i=t.target)&&void 0!==i?i:this._target,this.bind(t.target),n.bufferData(n[this._target],t.data,n[this._usage])}delete(){const{gl:t,buffer:e}=this;t.deleteBuffer(e)}}class te{constructor(t,e,i,n){this.gl=t,this.program=e,this.datasets=i,this.elements=n,this.drawBuffers=[],this.elemBuffer=null;const s=t.createVertexArray();if(!s)throw new Error("Unable to create VertexArrayObject!");if(this.vao=s,e&&i){if(t.bindVertexArray(s),this.drawBuffers=i.map((i=>{const n=new Jt(t,{data:i.data,target:i.target,usage:i.usage});return n.bind(),i.defineAttributes(t,e),n})),n){const e=new Jt(t,{data:n,target:"ELEMENT_ARRAY_BUFFER"});e.bind(),this.elemBuffer=e}t.bindVertexArray(null)}}updateDataset(t){const{datasets:e}=this;if(!e)return console.error("You cannot update any dataset because no dataset has been attached to this VAO yet!"),!1;const i=e.indexOf(t);if(-1===i)return console.error("This dataset is not bound to this VAO!"),t.debug(),this.debug(),!1;const n=this.getBuffer(i);return n?(n.bufferData({data:t.data}),!0):(console.error(`There is no buffer with index #${i} in this VAO!`),this.debug(),!1)}getBuffer(t){return this.drawBuffers[t]}toCode({indent:t=""}={}){var e;const i=["function createVAO(","  gl: WebGL2RenderingContext,",`  prg: WebGLProgram${null===(e=this.datasets)||void 0===e?void 0:e.map(((t,e)=>`, data${e}: ArrayBuffer`)).join("")}`,") {","  const vao = gl.createVertexArray()","  gl.bindVertexArray(vao)"];if(this.datasets)for(const[e,n]of this.datasets.entries())i.push(`  const buff${e} = gl.createBuffer()`,`  gl.bindBuffer(gl.${n.target}, buff${e})`,`  gl.bufferData(gl.${n.target}, data${e}, gl.${n.usage})`,n.toCode({indent:`${t}  `}));return i.push("  return vao","}"),i.map((e=>`${t}${e}`)).join("\n")}debug(t="TgdVertexArray"){if(console.log(t),this.program&&this.program.debug(),this.datasets)for(const[t,e]of this.datasets.entries())e.debug(`   Dataset #${t}`);this.elements&&console.log("Elements:",this.elements)}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}delete(){const{gl:t,vao:e,drawBuffers:i,elemBuffer:n}=this;t.deleteVertexArray(e);for(const t of i)t.delete();n&&n.delete()}}class ee extends ft{static do(t,e){const{onEnterActions:i,onExitActions:n}=ie({color:{red:!0,green:!0,blue:!0,alpha:!0}},t.gl,t);for(const t of i)t();e();for(const t of n)t()}static debug(t){const e=Nt(t);console.log("Depth:",{enabled:e.enabled,func:n(e.func),mask:e.mask,range:[e.rangeMin,e.rangeMax]}),console.log("Cull:",Mt(t)),console.log("Blend:",St(t))}constructor(t,e={}){var i;super(e.children),this.color={red:!0,green:!0,blue:!0,alpha:!0};const{gl:n}=t,{onEnterActions:s,onExitActions:r}=ie(this,n,e);this.onEnter=(t,i)=>{var n;null===(n=e.onEnter)||void 0===n||n.call(e,t,i);for(const t of s)t()},this.onExit=(t,i)=>{var n;for(const t of r)t();null===(n=e.onExit)||void 0===n||n.call(e,t,i)},this.name=null!==(i=e.name)&&void 0!==i?i:`State/${this.name}`}}function ie(t,e,i){const{color:n,blend:s,depth:r,cull:o,stencil:a}=i,h=[],c=[],u=function(t){return!0===t?[!0,!0,!0,!0]:!1===t?[!1,!1,!1,!1]:t}(n),[l,d,f,m]=null!=u?u:[!0,!0,!0,!0];if(t.color.red=l,t.color.green=d,t.color.blue=f,t.color.alpha=m,Array.isArray(u)){let i;h.push((()=>{i=e.getParameter(e.COLOR_WRITEMASK),e.colorMask(t.color.red,t.color.green,t.color.blue,t.color.alpha)})),c.push((()=>{e.colorMask(...null!=i?i:[!0,!0,!0,!0])}))}if(s){let t;h.push((()=>{t=St(e),Ct(e,s)})),c.push((()=>{t&&Ct(e,t)}))}if(r){let t;h.push((()=>{t=Nt(e),Ft(e,r)})),c.push((()=>{t&&Ft(e,t)}))}if(o){let t;h.push((()=>{t=Mt(e),Pt(e,o)})),c.push((()=>{t&&Pt(e,t)}))}if(a){let t;h.push((()=>{t=function(t){const e=Boolean(t.getParameter(t.STENCIL_TEST));return e?{enabled:e,maskBack:t.getParameter(t.STENCIL_BACK_WRITEMASK),maskFront:t.getParameter(t.STENCIL_WRITEMASK),functionFront:t.getParameter(t.STENCIL_FUNC),functionFrontMask:t.getParameter(t.STENCIL_VALUE_MASK),functionFrontRef:t.getParameter(t.STENCIL_REF),functionBack:t.getParameter(t.STENCIL_BACK_FUNC),functionBackMask:t.getParameter(t.STENCIL_BACK_VALUE_MASK),functionBackRef:t.getParameter(t.STENCIL_BACK_REF),operationFront1FailStencil:t.getParameter(t.STENCIL_FAIL),operationFront2FailDepth:t.getParameter(t.STENCIL_PASS_DEPTH_FAIL),operationFront3Pass:t.getParameter(t.STENCIL_PASS_DEPTH_PASS),operationBack1FailStencil:t.getParameter(t.STENCIL_BACK_FAIL),operationBack2FailDepth:t.getParameter(t.STENCIL_BACK_PASS_DEPTH_FAIL),operationBack3Pass:t.getParameter(t.STENCIL_BACK_PASS_DEPTH_PASS)}:Object.assign({},Ut.off)}(e),Ot(e,a)})),c.push((()=>{t&&Ot(e,t)}))}return{onEnterActions:h,onExitActions:c}}class ne{constructor({precision:t="highp",uniforms:e={},attributes:i={},varying:n={},functions:s={},mainCode:r=[]}={}){this.precision=t,this.uniforms=e,this.attributes=i,this.varying=n,this.functions=s,this.mainCode=r}get code(){return Ht(["#version 300 es",`precision ${this.precision} float;`,...jt(this.uniforms,"uniform"),...jt(this.attributes,"in"),...jt(this.varying,"out"),...$t(this.functions),"","void main() {",this.mainCode,"}"])}}class se{constructor({precision:t="highp",uniforms:e={},outputs:i={FragColor:"vec4"},varying:n={},functions:s={},mainCode:r=["FragColor = vec4(1, 0.667, 0, 1);"]}={}){this.precision="mediump",this.precision=t,this.uniforms=e,this.outputs=i,this.varying=n,this.functions=s,this.mainCode=r}get code(){return Ht(["#version 300 es",`precision ${this.precision} float;`,...jt(this.uniforms,"uniform"),...jt(this.varying,"in"),...jt(this.outputs,"out"),...$t(this.functions),"","void main() {",this.mainCode,"}"])}}class re extends ft{constructor(t,e){super(e.children),this.context=t,this.options=e,this.dirty=!0,this._width=0,this._height=0,this._framebuffer=null,this._depthBuffer=null,this._stencilBuffer=null;const{textureColor0:i,textureColor1:n,textureColor2:s,textureColor3:r}=e;i||n||s||r||console.error("[TgdPainterFramebuffer] You gave no color texture in the constructor: nothing will be rendered!",e),this.textureColor0=i,this.textureColor1=n,this.textureColor2=s,this.textureColor3=r,this.textureDepth=e.textureDepth,this.onEnter=e.onEnter,this.onExit=e.onExit;const{gl:o}=this.context;this.drawBuffers=[this.textureColor0?o.COLOR_ATTACHMENT0:o.NONE,this.textureColor1?o.COLOR_ATTACHMENT1:o.NONE,this.textureColor2?o.COLOR_ATTACHMENT2:o.NONE,this.textureColor3?o.COLOR_ATTACHMENT3:o.NONE]}get width(){return this._width}set width(t){this._width!==t&&(this._width=t,this.dirty=!0)}get height(){return this._height}set height(t){this._height!==t&&(this._height=t,this.dirty=!0)}updateTextureForColor(t,e){if(!t)return;const{context:i,width:n,height:s}=this,{gl:r}=i;t.resize(n,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+e,r.TEXTURE_2D,t.glTexture,0)}createTextureForDepth(){const t=this.textureDepth;if(!t)return;const{context:e,width:i,height:n}=this,{gl:s}=e;t.resize(i,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,t.glTexture,0)}createDepthBuffer(t){if(!1===this.options.depthBuffer)return;const{width:e,height:i}=this,n=t.createRenderbuffer();if(!n)throw new Error("Unable to create WebGLRenderBuffer for depth!");this._depthBuffer=n,t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,i),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,n)}createStencilBuffer(t){if(!1!==this.options.stencilBuffer){const{width:e,height:i}=this,n=t.createRenderbuffer();if(!n)throw new Error("Unable to create WebGLRenderBuffer for stencil!");this._stencilBuffer=n,t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,n)}}createFramebufferIfNeeded(){if(!this.dirty)return;const{context:t}=this,{gl:e}=t;this.delete(),this._framebuffer=function(t){const e=t.createFramebuffer();if(!e)throw new Error("Unable to create a WebGLFramebuffer!");return e}(e),e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),this.updateTextureForColor(this.textureColor0,0),this.updateTextureForColor(this.textureColor1,1),this.updateTextureForColor(this.textureColor2,2),this.updateTextureForColor(this.textureColor3,3),this.createTextureForDepth(),this.createDepthBuffer(e),this.createStencilBuffer(e);const i=e.checkFramebufferStatus(e.FRAMEBUFFER);i!==e.FRAMEBUFFER_COMPLETE&&console.error(`Your Framebuffer is incomplete: ${n(i)}!`),this.dirty=!1}paint(t,e){const{context:i,options:n}=this,{gl:s}=i,{viewportMatchingScale:r=1}=n;this.width=Math.round(i.width*r),this.height=Math.round(i.height*r),this.createFramebufferIfNeeded(),s.bindFramebuffer(s.FRAMEBUFFER,this._framebuffer),s.drawBuffers(this.drawBuffers),super.paint(t,e),s.bindFramebuffer(s.FRAMEBUFFER,null)}delete(){const{context:t,_framebuffer:e,_depthBuffer:i,_stencilBuffer:n}=this,{gl:s}=t;e&&(s.deleteFramebuffer(e),this._framebuffer=null),i&&(s.deleteRenderbuffer(i),this._depthBuffer=null),n&&(s.deleteRenderbuffer(n),this._stencilBuffer=null)}}function oe(t){return(0,pt.sH)(this,void 0,void 0,(function*(){return new Promise((e=>{const i=new Image;i.addEventListener("load",(()=>e(i))),i.addEventListener("error",(()=>{console.error("Unable to load image:",t),e(null)})),i.src=t}))}))}class ae{constructor(t,e){this.context=t,this.eventChange=new ht,this._texture=null,this._width=-1,this._height=-1,this.params={magFilter:"LINEAR",minFilter:"LINEAR",wrapS:"REPEAT",wrapT:"REPEAT",wrapR:"REPEAT"};const{gl:i}=t;this.gl=i,this.name="Texture2D/"+ae.counter++,this.storage=Object.assign({width:0,height:0,internalFormat:"RGBA8",levels:1,flipY:!1,premultipliedAlpha:!1},e);const n=null==e?void 0:e.width,s=null==e?void 0:e.height;"number"==typeof n&&"number"==typeof s?this.resize(n,s):this.createTexture()}delete(){this._texture&&this.gl.deleteTexture(this._texture),this._texture=null}get width(){return this._width}get height(){return this._height}createTexture(){this.delete();const t=this.gl.createTexture();if(!t)throw new Error("Unable to create a WebGLTexture!");const{gl:e}=this;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.storage.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.storage.premultipliedAlpha),this._texture=t,this.setParams(this.params)}resize(t,e){if(t===this.width&&e===this.height)return;const{gl:i,storage:n}=this;this.createTexture(),this._width=t,this._height=e,n.width=t,n.height=e,this.bind(),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.storage.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.storage.premultipliedAlpha);const{internalFormat:s,levels:r}=this.storage;if(s.startsWith("COMPRESSED_")&&!i.getExtension("WEBGL_compressed_texture_etc"))throw new Error('Your browser does not support extension "WEBGL_compressed_texture_etc" on this device!');i.texStorage2D(i.TEXTURE_2D,r,i[s],t,e),this.checkError()}checkError(){const{gl:t}=this,e=t.getError();e!==t.NO_ERROR&&console.error(`[TgdTexture2D::${this.name}] Error:`,n(e))}get glTexture(){if(this._texture)return this._texture;throw new Error(`Texture "${this.name}" has been deleted!`)}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.glTexture)}loadBitmap(t,e={}){var i,n,s,r;if(!t)return this;if("string"==typeof t)return this.loadBitmap(oe(t),e);if(!((r=t)instanceof ImageData||r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageBitmap))return t.then((t=>this.loadBitmap(t))).catch((t=>console.error("Unable to load texture BMP:",t))),this;const{storage:o,gl:a}=this,{level:h=0}=e;return this._width=t.width,this._height=t.height,this.bind(),a.texImage2D(a.TEXTURE_2D,h,a[o.internalFormat],a[function(t){for(const[e,i]of he)if(i.has(t))return e;throw new Error(`There is no compatible format for internalFormat "${t}" and type "UNSIGNED_BYTE"!`)}(o.internalFormat)],a.UNSIGNED_BYTE,t),this.checkError(),e.generateMipmap&&(this.generateMipmap(),this.checkError()),null===(n=(i=this.context).paint)||void 0===n||n.call(i),null===(s=e.onLoad)||void 0===s||s.call(e),this.eventChange.dispatch(this),this}loadData(t,e){const{level:i=0,width:n,height:s,internalFormat:r="RGB",format:o="RGB"}=e,{gl:a}=this;return this.bind(),a.texImage2D(a.TEXTURE_2D,i,a[r],n,s,0,a[o],a.UNSIGNED_BYTE,t),this.checkError(),this.eventChange.dispatch(this),this}activate(t,e,i){const{gl:n}=this;return n.activeTexture(n.TEXTURE0+t),this.bind(),e&&i&&e.uniform1i(i,t),this}generateMipmap(){const{gl:t}=this;return this.bind(),t.generateMipmap(t.TEXTURE_2D),this}setParams(t){return this.bind(),function(t,{wrapS:e,wrapT:i,wrapR:n,minFilter:s,magFilter:r}){e&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[e]),i&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[i]),n&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_R,t[n]),s&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[s]),r&&t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[r])}(this.gl,t),this.params=Object.assign(Object.assign({},this.params),t),this}set textureBaseLevel(t){const{gl:e}=this;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_BASE_LEVEL,t)}get textureBaseLevel(){const{gl:t}=this;return this.bind(),t.getTexParameter(t.TEXTURE_2D,t.TEXTURE_BASE_LEVEL)}set textureMaxLevel(t){const{gl:e}=this;this.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAX_LEVEL,t)}get textureMaxLevel(){const{gl:t}=this;return this.bind(),t.getTexParameter(t.TEXTURE_2D,t.TEXTURE_MAX_LEVEL)}getParameter(t){const{gl:e,glTexture:i}=this;return e.bindTexture(e.TEXTURE_2D,i),e.getTexParameter(e.TEXTURE_2D,e[t])}debug(t){var e;console.log(null!==(e=null!=t?t:this.name)&&void 0!==e?e:"TgdTexture2D","  ",this.width,"×",this.height);const i=["TEXTURE_MAG_FILTER","TEXTURE_MIN_FILTER","TEXTURE_WRAP_R","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_MAX_LEVEL","TEXTURE_MAX_LOD","TEXTURE_MIN_LOD","TEXTURE_BASE_LEVEL","TEXTURE_COMPARE_FUNC","TEXTURE_COMPARE_MODE","TEXTURE_IMMUTABLE_FORMAT","TEXTURE_IMMUTABLE_LEVELS"];for(const t of i){const e=this.getParameter(t);console.log(">",t,"=",e,"number"==typeof e?`(${n(e)})`:" ")}}}ae.counter=0;const he=[["RGB",new Set(["RGB","RGB8","RGB565","SRGB8","RGB8_SNORM","RGB565","R11F_G11F_B10F","RGB9_E5","RGB16F","R11F_G11F_B10F","RGB9_E5","RGB32F","RGB16F","R11F_G11F_B10F","RGB9_E5"])],["RGBA",new Set(["RGBA","RGBA8","RGB5_A1","RGBA4","SRGB8_ALPHA8","RGBA8_SNORM","RGBA4","RGB5_A1","RGB10_A2","RGB5_A1","RGBA16F","RGBA32F","RGBA16F"])],["RG",new Set(["RG8"])],["RED",new Set(["R8"])]];function ce(t){return(0,pt.sH)(this,void 0,void 0,(function*(){if(t instanceof File)return yield t.text();try{const e=yield fetch(t);return yield e.text()}catch(t){return console.error(t),null}}))}new f(.8,.6,.1,1),new f(.6,1,.9,1),new f(.9,.5,.1,1),new d(1,0,0),new d(0,1,0),new d(0,0,1),new d(-1,0,0),new d(0,-1,0),new d(0,0,-1),Math.E,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,new rt(1,0)},2772:(t,e,i)=>{i.d(e,{m:()=>o});var n,s=i(1858),r=function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)};n=new WeakMap;const o=new class{constructor(){n.set(this,null)}initialize(){return t=this,e=void 0,r=function*(){!function(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?s.call(t,i):s?s.value=i:e.set(t,i)}(this,n,yield(0,s.V_9)("assets/symbols/CPC6128.png"),"f")},new((i=void 0)||(i=Promise))((function(n,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function a(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((r=r.apply(t,e||[])).next())}));var t,e,i,r}get symbols(){if(!r(this,n,"f"))throw Error("[Assets] Symbols have not yet been loaded!");return r(this,n,"f")}}},4199:(t,e,i)=>{var n=i(4848),s=i(5968),r=i(5338),o=i(6540),a=i(9419);const h=o.lazy((()=>i.e(195).then(i.bind(i,4195)))),c=o.lazy((()=>Promise.all([i.e(185),i.e(774)]).then(i.bind(i,4336)))),u=o.lazy((()=>Promise.all([i.e(185),i.e(564)]).then(i.bind(i,1438)))),l=o.lazy((()=>Promise.all([i.e(597),i.e(185),i.e(979)]).then(i.bind(i,7979))));function d({lang:t}){const e=(0,a.s9)(),i=(0,n.jsx)("div",{children:"Loading..."}),s=h,r=c,o=u,d=l;return(0,n.jsxs)(f,{path:"/",Page:s,fallback:i,context:e,children:[(0,n.jsx)(f,{path:"/run",fallback:i,context:e,children:(0,n.jsx)(f,{path:"/run/[code]",Page:r,fallback:i,context:e})}),(0,n.jsx)(f,{path:"/test",Page:o,fallback:i,context:e}),(0,n.jsx)(f,{path:"/workbench",Page:d,fallback:i,context:e})]})}function f({path:t,fallback:e,children:i,Page:s,Layout:r,Template:h,context:c}){const u=c&&(0,a.Di)(c.path,a.bw[t]);if(!u)return null;if(0===u.distance){if(!s)return null;const t=h?(0,n.jsx)(h,{params:u.params,children:(0,n.jsx)(s,{params:u.params})}):(0,n.jsx)(s,{params:u.params});return r?(0,n.jsx)(r,{params:u.params,children:(0,n.jsx)(o.Suspense,{fallback:e,children:t})}):(0,n.jsx)(o.Suspense,{fallback:e,children:t})}return r?(0,n.jsx)(r,{params:u.params,children:i}):(0,n.jsx)(n.Fragment,{children:i})}var m=i(2772),g=i(5072),p=i.n(g),E=i(7825),A=i.n(E),b=i(7659),_=i.n(b),x=i(5056),y=i.n(x),v=i(540),R=i.n(v),T=i(1113),L=i.n(T),w=i(9165),C={};C.styleTagTransform=L(),C.setAttributes=y(),C.insert=_().bind(null,"head"),C.domAPI=A(),C.insertStyleElement=R(),p()(w.A,C),w.A&&w.A.locals&&w.A.locals;var S=i(6245),P={};P.styleTagTransform=L(),P.setAttributes=y(),P.insert=_().bind(null,"head"),P.domAPI=A(),P.insertStyleElement=R(),p()(S.A,P),S.A&&S.A.locals&&S.A.locals;var M=i(631),F={};F.styleTagTransform=L(),F.setAttributes=y(),F.insert=_().bind(null,"head"),F.domAPI=A(),F.insertStyleElement=R(),p()(M.A,F),M.A&&M.A.locals&&M.A.locals;!function(){var t,e,i,o;t=this,e=void 0,o=function*(){yield m.m.initialize(),new s.Sxu({colors:{neutral:["#333","#666"],primary:["#222","#555"]}}).apply();const t=document.getElementById("app");if(!t)throw Error('No element with id "app"!');(0,r.H)(t).render((0,n.jsx)(s.Znq,{children:(0,n.jsx)(d,{})})),function(){const t=document.getElementById("splash");t&&(t.classList.add("vanish"),window.setTimeout((()=>{const e=t.parentNode;e&&e.removeChild(t)}),900))}()},new((i=void 0)||(i=Promise))((function(n,s){function r(t){try{h(o.next(t))}catch(t){s(t)}}function a(t){try{h(o.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((o=o.apply(t,e||[])).next())}))}()},6245:(t,e,i)=>{i.d(e,{A:()=>a});var n=i(1601),s=i.n(n),r=i(6314),o=i.n(r)()(s());o.push([t.id,"pre {\n  background: #333;\n  color: #fff;\n}\n\npre span.Basik-COM {\n  opacity: 0.5;\n  font-style: italic;\n}\n\npre span.Basik-DEF,\npre span.Basik-RETURN,\npre span.Basik-IF,\npre span.Basik-ELIF,\npre span.Basik-ELSE,\npre span.Basik-WHILE,\npre span.Basik-FOR,\npre span.Basik-IN {\n  font-weight: bold;\n  color: #88f;\n}\n\npre span.Basik-FUNC,\npre span.Basik-PAR_OPEN,\npre span.Basik-PAR_CLOSE {\n  color: #0af;\n}\n\npre span.Basik-STR {\n  color: #0fa;\n}\n\npre span.Basik-VAR {\n  color: #ee0;\n}\n\npre span.Basik-GLOBAL_VAR {\n  color: #fc0;\n}\n\npre span.Basik-NUM {\n  color: #d77;\n}\n\npre span.Basik-HEX {\n  color: #c97;\n}\n",""]);const a=o},9165:(t,e,i)=>{i.d(e,{A:()=>a});var n=i(1601),s=i.n(n),r=i(6314),o=i.n(r)()(s());o.push([t.id,'body {\n    width: 100%;\n    height: 100%;\n    font-size: 1.2vmax;\n    overflow: hidden;\n    font-family: "Josefin Sans", josefin-sans, sans-serif;\n    margin: 0;\n    padding: 0;\n    background-color: #eee;\n    --custom-monitor-color: #008;\n}\n\n* {\n    box-sizing: border-box;\n}\n\nbody > * {\n    vertical-align: top;\n}\n\nbody * {\n    box-sizing: border-box;\n}\n\ncanvas {\n    display: inline-block;\n}\n\ndiv#app {\n    background-color: #000;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    padding: 0;\n    margin: 0;\n}\n',""]);const a=o},9419:(t,e,i)=>{i.d(e,{Di:()=>a,bw:()=>s,fA:()=>l,s9:()=>u});var n=i(6540);const s={"/":["/"],"/run":["/run"],"/run/[code]":["/run","[code]"],"/test":["/test"],"/workbench":["/workbench"]};function r(t,...e){var i;const n=function(t,e){const i=s[t];let n=0;return i.map((t=>"["===t.charAt(0)?e[n++]:t)).join("/")}(t,e);return n!==(null===(i=m().value)||void 0===i?void 0:i.path)&&(window.location.hash=n,!0)}function o(t){let e=null;for(const i of Object.values(s)){const n=a(t,i);if(n){if(0===n.distance)return n;(!e||n.distance<e.distance)&&(e=n)}}return e}function a(t,e){if(!e)return null;let i=t;const n={};for(let t=0;t<e.length;t++){if(i.length<1)return null;const s=e[t];if(s.startsWith("[")){const t=s.substring(1,s.length-1),[e,r]=h(i);n[t]=e,i=r}else{if(!i.startsWith(s))return null;i=i.substring(s.length+1)}}return{path:t,route:e.join("/"),params:n,distance:i.length}}function h(t){const e=t.indexOf("/");return e<0?[t,""]:[t.substring(0,e),t.substring(e+1)]}class c{constructor(t){this.security=t,this.listeners=new Set,this._value=null,this.handleHashChange=t=>{const e=this.extractHash(t.oldURL),i=this.extractHash(t.newURL),n=this.ensureAbsoluteHash(i,e);n!==i&&globalThis.history.replaceState({},"",`#${n}`),this.setHash(n)},this.nonEmpty=t=>"string"==typeof t&&t.trim().length>0;const e=this.extractHash(window.location.href);this.setHash(e).then((()=>window.addEventListener("hashchange",this.handleHashChange))).catch((t=>{console.error(`Unable to set hash to "${e}":`,t)}))}addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}get value(){return this._value}setHash(t){return e=this,i=void 0,s=function*(){var e;let i=o(t);if(i)for(const[e,n]of this.security){if(!i.route.startsWith(e))continue;const s=yield n(i.route,t);if(s&&s!==i.route){if(i=o(s),!i)break;return this._value=null,void r(i.path)}}(null===(e=this._value)||void 0===e?void 0:e.route)!==(null==i?void 0:i.route)&&(this._value=i,this.listeners.forEach((t=>t(i))))},new((n=void 0)||(n=Promise))((function(t,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}h((s=s.apply(e,i||[])).next())}));var e,i,n,s}extractHash(t){const e=new URL(t).hash;return e?e.startsWith("#")?e.substring(1):e:"/"}ensureAbsoluteHash(t,e){if(t.startsWith("/"))return t;let i=t;for(;i.startsWith("./");)i=i.substring(2);const n=e.split("/").filter(this.nonEmpty);for(const e of t.split("/"))".."===e?n.length>0&&n.pop():n.push(e);return`/${n.filter(this.nonEmpty).join("/")}`}}function u(){const[t,e]=n.useState(m().value);return n.useEffect((()=>{const t=t=>{e(t)};return m().addListener(t),()=>m().removeListener(t)}),[]),t}function l(t,e=""){var i;return null!==(i=function(...t){const e=u(),i={};if(e)for(const n of t){const t=e.params[n];"string"==typeof t&&(i[n]=t)}return i}(t)[t])&&void 0!==i?i:e}const d=[];let f=null;function m(){return f||(f=new c(d)),f}}},s={};function r(t){var e=s[t];if(void 0!==e)return e.exports;var i=s[t]={id:t,exports:{}};return n[t].call(i.exports,i,i.exports,r),i.exports}r.m=n,t=[],r.O=(e,i,n,s)=>{if(!i){var o=1/0;for(u=0;u<t.length;u++){for(var[i,n,s]=t[u],a=!0,h=0;h<i.length;h++)(!1&s||o>=s)&&Object.keys(r.O).every((t=>r.O[t](i[h])))?i.splice(h--,1):(a=!1,s<o&&(o=s));if(a){t.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}s=s||0;for(var u=t.length;u>0&&t[u-1][2]>s;u--)t[u]=t[u-1];t[u]=[i,n,s]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.f={},r.e=t=>Promise.all(Object.keys(r.f).reduce(((e,i)=>(r.f[i](t,e),e)),[])),r.u=t=>"scr/"+t+"."+{185:"f1419c79773cd156c7cd",195:"b1480dff1f962021648f",564:"bcf635408a4d6ff8305f",597:"f76799b98c1abb75e8cc",774:"e1f4c6871fca689ddb22",979:"f513a4997ca204f811b2"}[t]+".js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),e={},i="vintage-machine:",r.l=(t,n,s,o)=>{if(e[t])e[t].push(n);else{var a,h;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==t||l.getAttribute("data-webpack")==i+s){a=l;break}}a||(h=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",i+s),a.src=t),e[t]=[n];var d=(i,n)=>{a.onerror=a.onload=null,clearTimeout(f);var s=e[t];if(delete e[t],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((t=>t(n))),i)return i(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),h&&document.head.appendChild(a)}},r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t+"../"})(),(()=>{r.b=document.baseURI||self.location.href;var t={524:0};r.f.j=(e,i)=>{var n=r.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,s)=>n=t[e]=[i,s]));i.push(n[2]=s);var o=r.p+r.u(e),a=new Error;r.l(o,(i=>{if(r.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,n[1](a)}}),"chunk-"+e,e)}},r.O.j=e=>0===t[e];var e=(e,i)=>{var n,s,[o,a,h]=i,c=0;if(o.some((e=>0!==t[e]))){for(n in a)r.o(a,n)&&(r.m[n]=a[n]);if(h)var u=h(r)}for(e&&e(i);c<o.length;c++)s=o[c],r.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return r.O(u)},i=self.webpackChunkvintage_machine=self.webpackChunkvintage_machine||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),r.nc=void 0;var o=r.O(void 0,[387],(()=>r(4199)));o=r.O(o)})();