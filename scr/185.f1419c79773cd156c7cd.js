"use strict";(self.webpackChunkvintage_machine=self.webpackChunkvintage_machine||[]).push([[185],{2501:(t,e,s)=>{s.d(e,{R:()=>P});var n=s(5146),r=s(2197);function i(t){return(0,r.Xj)(t,{pos:"number",code:"string",msg:"string"})}function o(t,e){const s=[t,e.msg,""];console.log(`%c${e.msg}`,"background: #f00;color: #fff");const n=[];let r=0,i=0,o=1;const a=`${e.code}\n\n`;for(;i<a.length;)if("\n"===a.charAt(i++)){const t=a.slice(r,i).trimEnd();if(n.push([o++,t]),i>e.pos){for(const[t,e]of n.slice(-5))s.push(`${`${t}`.padStart(6," ")}:  ${e}`),console.log(`%c${`${t}`.padStart(6," ")}:  ${e}`,"font-family:monospace");throw console.log(`%c${" ".repeat(9+e.pos-r)}^`,"font-family:monospace"),s.push(`${" ".repeat(9+e.pos-r)}^`),new Error(s.join("\n"))}r=i}throw new Error(s.join("\n"))}const a={"==":(t,e)=>JSON.stringify(t)===JSON.stringify(e)?1:0,"<>":(t,e)=>JSON.stringify(t)!==JSON.stringify(e)?1:0,">":(t,e)=>(0,r.Et)(t)&&(0,r.Et)(e)?t>e?1:0:JSON.stringify(t)>JSON.stringify(e)?1:0,"<":(t,e)=>(0,r.Et)(t)&&(0,r.Et)(e)?t<e?1:0:JSON.stringify(t)<JSON.stringify(e)?1:0,">=":(t,e)=>(0,r.Et)(t)&&(0,r.Et)(e)?t>=e?1:0:JSON.stringify(t)>=JSON.stringify(e)?1:0,"<=":(t,e)=>(0,r.Et)(t)&&(0,r.Et)(e)?t<=e?1:0:JSON.stringify(t)<=JSON.stringify(e)?1:0,"+":(t,e)=>(0,r.Et)(t)&&(0,r.Et)(e)?t+e:Array.isArray(t)?Array.isArray(e)?[...t,...e]:[...t,e]:Array.isArray(e)?Array.isArray(t)?[...t,...e]:[t,...e]:`${t}${e}`,"-":l("-",((t,e)=>t-e)),"/":l("/",((t,e)=>t/e)),"^":l("^",((t,e)=>Math.pow(t,e))),"%":l("^",((t,e)=>t%e)),AND:l("AND",((t,e)=>t&e)),OR:l("OR",((t,e)=>t|e)),XOR:l("XOR",((t,e)=>t^e)),"*":(t,e)=>{if((0,r.Et)(t)&&(0,r.Et)(e))return t*e;if(Array.isArray(t)||Array.isArray(e))throw new Error("Il est impossible de multiplier des listes !");if((0,r.Kg)(t)&&(0,r.Kg)(e))throw new Error("Il est impossible de multiplier deux chaînes de caractères !");let s=(0,r.Kg)(t)?t:e,n=(0,r.Kg)(e)?t:e;if(0===n)return"";n<0&&(n=-n,s=s.split("").reverse().join(""));const i=Math.floor(n),o=n-i;return`${s.repeat(i)}${s.slice(0,Math.round(o*s.length))}`}};function l(t,e){return(s,n)=>{if(!(0,r.Et)(s)||!(0,r.Et)(n))throw new Error([`L'opérateur "${t}" ne fonctionne qu'avec des nombres.`,`Mais je l'ai trouvé entre ${JSON.stringify(s)} et ${JSON.stringify(n)}.`].join("\n"));return e(s,n)}}class c{constructor(){this.counter=0,this.labels=new Map,this.links=[]}reset(){this.labels.clear(),this.links.splice(0,this.links.length),this.counter=0}create(t=""){return`:${this.counter++}:${t}`}stick(t,e){this.labels.set(t,e)}link(t,e){this.links.push({cursor:t,label:e})}apply(t){for(const{cursor:e,label:s}of this.links){const n=this.labels.get(s);if(void 0===n)throw Error(`Label not found: ${s}`);t[e].val=n}}getLabelAtCursor(t){for(const[e,s]of this.labels.entries())if(s===t)return e;return""}getLinkAtCursor(t){for(const{label:e,cursor:s}of this.links)if(s===t)return e;return null}getLabelsMaxLength(){let t=0;for(const e of this.labels.keys())t=Math.max(t,e.length);return t}}var u=s(3185);function h(){const t=this.lexer.get("RETURN");return!!t&&(this.parseExpression()||this.lexer.fatal("Il faut une expression après un RETURN.",t),this.pushBytecode(this.$return),!0)}function p(){const{lexer:t}=this,e=t.get("FUNC");if(!e)return!1;const s=e.val.slice(0,-1).trim().toUpperCase();let n=0;for(;this.parseExpression()&&(n++,t.get("COMMA")););return t.expect("PAR_CLOSE",`Il manque une parenthèse fermante après les arguments de la procédure "${s}".`),this.pushBytecode(n,this.$makeArray,s),this.pushFunction(this.$procedure,e),!0}function d(){if(this.lexer.get("BRA_OPEN")){for(;this.parseInstruction(););return this.lexer.expect("BRA_CLOSE","Il manque une accolade fermante."),!0}const t=[this.parseProcedure,this.parseAffectation,this.parseIf,this.parseForIn,this.parseWhile,this.parseReturn,this.parseDef];return!!this.parseAny(...t)}function f(){const{lexer:t}=this;if(!t.get("IF"))return!1;this.parseExpression()||this.fatal("Après un IF il faut une expression.");const e=this.labelCreate("Else"),s=this.labelCreate("EndIf");for(this.labelPushItsValue(e),this.pushBytecode(this.$if),this.parseInstruction(),this.pushJump(s),this.labelStickHere(e);t.get("ELIF");){this.parseExpression()||this.fatal("Après un ELIF il faut une expression.");const t=this.labelCreate("ElseIf");this.labelPushItsValue(t),this.pushBytecode(this.$if),this.parseInstruction(),this.pushJump(s),this.labelStickHere(t)}return t.get("ELSE")&&this.parseInstruction(),this.labelStickHere(s),!0}function g(){const{lexer:t}=this;if(!t.get("WHILE"))return!1;const e=this.labelCreate("Begin"),s=this.labelCreate("End");return this.labelStickHere(e),this.parseExpression()||this.fatal("Après un WHILE il faut une expression."),this.pushJumpIfZero(s),this.parseInstruction(),this.pushJump(e),this.labelStickHere(s),!0}function m(){const{lexer:t}=this;if(!t.get("FOR"))return!1;const e=t.expect("VAR","Il me faut un nom de variable après le mot clef FOR.");this.pushBytecode(e.val),t.expect("IN","Après le nom de variable, il faut le mot clef IN.\nExemple: FOR $i IN $notes"),this.parseExpression()||this.fatal("Je m'attendais à une expression après un FOR ... IN."),this.pushBytecode(0);const s=this.labelCreate("begin"),n=this.labelCreate("end");return this.labelPushItsValue(n),this.labelStickHere(s),this.pushBytecode(this.$forIn),this.parseInstruction()||this.lexer.fatal("Après un FOR...IN, il me faut une instruction ou un bloc d'instructions."),this.pushJump(s),this.labelStickHere(n),!0}function y(){var t;const e=null!==(t=this.lexer.get("VAR"))&&void 0!==t?t:this.lexer.get("GLOBAL_VAR");if(e){const t=e.val;this.pushBytecode(t);const s=this.parseSlicerArguments();return this.lexer.expect("EQUAL",`Je m'attendais à voir le signe "=" pour l'affectation de la variable ${t} !`),"GLOBAL_VAR"===e.id&&this.lexer.fatal(["Il est interdit d'assigner des valeurs à une variable globale.","Est-ce que tu voulais écrire",`$${t.slice(1)} = ... ?`].join("\n"),e),this.parseExpression(),this.pushBytecode(s?this.$setElem:this.$setVar),!0}const s=this.lexer.get("DESTRUCT");if(!s)return!1;const n=s.val.trim().slice(2,-1).split(",").map((t=>`$${t.trim().toLowerCase()}`));return this.pushBytecode(n),this.lexer.expect("EQUAL",`Je m'attendais à voir le signe "=" pour l'affectation des variables ${n.join(", ")}.`),this.parseExpression(),this.pushBytecode(this.$setVars),!0}function v(){var t;const e=this.lexer.get("SIGN");if(this.parseAny(this.parseNumber,this.parseVar,this.parseHexa,this.parseString,this.parseExpressionBlock,this.parseFunction,this.parseList)){for("-"===(null!==(t=null==e?void 0:e.val)&&void 0!==t?t:"+")&&this.pushFunction(this.$neg,e);this.parseSlicer(););for(;this.parseBinaryOperator(););return!0}return!1}function E(){const{lexer:t}=this,e=t.get("FUNC");if(!e)return!1;const s=e.val.slice(0,-1).trim().toUpperCase();let n=0;for(;this.parseExpression()&&(n++,t.get("COMMA")););return t.expect("PAR_CLOSE",`Il manque une parenthèse fermante après les arguments de la fonction "${s}".`),this.pushBytecode(n,this.$makeArray,s),this.pushFunction(this.$function,e),!0}function b(){const{lexer:t}=this;return!!t.get("PAR_OPEN")&&(this.parseExpression()||t.fatal("Il manque une expression après la parenthèse ouvrante."),t.expect("PAR_CLOSE","Il manque une parenthèse fermante ici."),!0)}function x(){const{lexer:t}=this,e=t.get("BINOP","SIGN");if(!e)return!1;const s=e.val;return this.parseExpression()||t.fatal(`Je m'attendais à une expression après l'opérateur "${t.token.val}" !`),this.pushBytecode(this.makeBinOp(s)),!0}function w(){const{lexer:t}=this;if(!t.get("DEF"))return!1;const e=this.labelCreate("BeginFunc"),s=this.labelCreate("EndFunc"),n=t.get("FUNC");if(!n)return t.fatal("Après DEF il faut mettre un nom de fonction avec ses arguments.\nPar exemple :\nDEF FACTORIELLE($nombre) ...\nDEF COMMENCER()"),!1;const r=n.val.slice(0,-1).trim().toUpperCase();let i=0;for(;;){const e=t.get("VAR");if(!e)break;if(this.pushBytecode(e.val),i++,!t.get("COMMA"))break}return t.expect("PAR_CLOSE",`Lors de la définition de la fonction "${r}", ses arguments doivent tous êtres des variables.`),this.pushBytecode(i,this.$makeArray,r),this.labelPushItsValue(e),this.pushBytecode(this.$def),this.pushJump(s),this.labelStickHere(e),this.parseInstruction(),this.pushBytecode(0,this.$return),this.labelStickHere(s),!0}function I(){const t=this.lexer.get("NUM");return!!t&&(this.pushBytecode(Number(t.val)),!0)}function A(){const t=this.lexer.get("STR");return!!t&&(this.pushBytecode(t.val.slice(1,-1)),!0)}function S(){const t=this.lexer.get("HEX");return!!t&&(this.pushBytecode(Number(`0x${t.val.trim().slice(1)}`)),!0)}function C(){var t;const e=null!==(t=this.lexer.get("VAR"))&&void 0!==t?t:this.lexer.get("GLOBAL_VAR");return!!e&&(this.pushBytecode(e.val),this.pushFunction(this.$getVar,e),!0)}function R(){const{lexer:t}=this;if(!t.get("SQR_OPEN"))return!1;let e=0;for(;this.parseExpression()&&(e++,t.get("COMMA")););return t.expect("SQR_CLOSE","Il manque un crochet fermant à la fin de la liste."),this.pushBytecode(e,this.$makeArray),!0}function T(){return!!k.call(this)&&(this.pushBytecode(this.$slice),!0)}function k(){const{lexer:t}=this;if(!t.get("SQR_OPEN"))return!1;let e=0;for(;this.parseExpression()&&(e++,t.get("COMMA")););return t.expect("SQR_CLOSE","Il manque un crochet fermant à la fin de la liste."),(e<0||e>2)&&t.fatal(`L'opérateur slice attend zéro, un ou deux argument, pas ${e}.`),this.pushBytecode(e,this.$makeArray),!0}var O=s(1858),N=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{l(n.next(t))}catch(t){i(t)}}function a(t){try{l(n.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};class ${constructor(t){this.kernel=t,this.labels=new c,this.bytecode=[],this.stack=[],this.callStack=[],this.functionsDefinitions=new Map,this.lexer=new n.F(""),this.cursor=0,this.code="",this.parseAffectation=y.bind(this),this.parseBinaryOperator=x.bind(this),this.parseInstruction=d.bind(this),this.parseDef=w.bind(this),this.parseExpression=v.bind(this),this.parseExpressionBlock=b.bind(this),this.parseForIn=m.bind(this),this.parseFunction=E.bind(this),this.parseIf=f.bind(this),this.parseProcedure=p.bind(this),this.parseList=R.bind(this),this.parseReturn=h.bind(this),this.parseWhile=g.bind(this),this.parseNumber=I.bind(this),this.parseSlicer=T.bind(this),this.parseSlicerArguments=k.bind(this),this.parseString=A.bind(this),this.parseHexa=S.bind(this),this.parseVar=C.bind(this),this.$def=_("DEF",(()=>{const t=this.popNum(),e=this.popStr(),s=this.popArr();(0,r.j)(s,["array","string"],`${e}()`),this.functionsDefinitions.set(e,{cursor:t,args:s})})),this.$return=_("RETURN",(()=>{const t=this.callStack.pop();(0,r.Et)(t)||this.fatal("Call stack is empty!"),this.cursor=t,this.kernel.subroutineExit()})),this.$jump=_("JMP",(()=>{this.cursor=this.popNum()})),this.$jumpIfZero=_("JMP",(()=>{const t=this.popNum();0===this.pop()&&(this.cursor=t)})),this.$setVar=_("setVar(name, value)",(()=>{const t=this.pop(),e=this.popStr();this.kernel.setVar(e,t)})),this.$setElem=_("setVar(name, slicer, value)",(()=>{const t=this.pop(),e=this.popArr(),s=this.popStr(),n=this.kernel.getVar(s);if((0,r.Et)(n))throw new Error(`La variable ${s} est un nombre (${n}).\nOn ne peut donc pas lui assigner d'élément.`);if(e.length<2){const[i]=e;let o=(0,r.Et)(i)?Math.floor(i):n.length;if(o<0&&(o+=n.length),o=(0,O.O6b)(o,0,n.length),Array.isArray(n))return void(n[o]=t);this.kernel.setVar(s,n.slice(0,o)+L(t)+n.slice(o+1))}else{let[i,o]=e.map((t=>Math.round((0,r.GB)(t,0)))).map((t=>t<0?t+n.length:t)).map((t=>(0,O.O6b)(t,0,n.length-1)));if(i>o){const t=i;i=o,o=t}if(Array.isArray(n)){const e=n.slice(0,i),r=n.slice(o+1),a=Array.isArray(t)?[...e,...t,...r]:[...e,t,...r];this.kernel.setVar(s,a)}else this.kernel.setVar(s,n.slice(0,i)+L(t)+n.slice(o+1))}})),this.$setVars=_("setVar(name, value)",(()=>{const t=this.pop();Array.isArray(t)||this.lexer.fatal(`Je ne peux desctructurer que des listes.\nMais j'ai reçu ${JSON.stringify(t)}.`);const e=this.popArr();for(let s=0;s<e.length;s++){const n=e[s];(0,r.Kg)(n)&&this.kernel.setVar(n,t[s])}})),this.$getVar=_("getVar(name)",(()=>{var t;const e=this.popStr();this.stack.push(null!==(t=this.kernel.getVar(e))&&void 0!==t?t:0)})),this.$neg=_("neg(...)",(()=>{var t=this.popNum();this.stack.push(-t)})),this.$makeArray=_("makeArray(count, ...)",(()=>{const t=this.popNum(),e=this.stack.splice(this.stack.length-t,t);this.stack.push(e)})),this.$slice=_("slice[...]",(()=>{const[t,e]=this.popArr();(0,r.Et)(t)||this.lexer.fatal(`Le premier argument d'un operateur slice doit ētre un nombre et pas ${JSON.stringify(t)}.`),(0,r.Et)(e)||void 0===e||this.lexer.fatal(`Le deuxieme argument d'un operateur slice, s'il est défini, doit ētre un nombre et pas ${JSON.stringify(e)}.`);const s=this.pop();(0,r.Kg)(s)||Array.isArray(s)?void 0===e?(0,r.Kg)(s)?this.stack.push(s.slice(t,t+1)):t<0?this.stack.push(s[s.length+t]):this.stack.push(s[t]):-1===e?this.stack.push(s.slice(t)):this.stack.push(s.slice(t,e+1)):this.stack.push(s)})),this.$function=()=>N(this,void 0,void 0,(function*(){const{kernel:t}=this,e=this.popStr(),s=this.popArr();if(t.hasFunction(e)){const n=yield t.executeFunction(e,s);return void this.stack.push(n)}const n=this.functionsDefinitions.get(e);if(!n)throw new Error(`La fonction "${e.toUpperCase()}" n'existe pas.\nLes fonctions disponibles sont: ${[Array.from(this.functionsDefinitions.keys()).map((t=>{var e;return`${t}(${null===(e=this.functionsDefinitions.get(t))||void 0===e?void 0:e.args.join(", ")})`})),...this.kernel.functionsNames].join(", ")}.`);if(s.length!==n.args.length)throw new Error(`La fonction ${e}(${n.args.join(", ")}) attend ${n.args.length} argument${n.args.length>1?"s":""}, pas ${s.length}.`);this.kernel.subroutineEnter(n.args,s,null),this.callStack.push(this.cursor),this.cursor=n.cursor})),this.$procedure=()=>N(this,void 0,void 0,(function*(){const t=this.popStr(),e=this.popArr();if(!(yield this.kernel.executeProcedure(t,e))){const s=this.functionsDefinitions.get(t);if(!s)throw new Error(`La procédure "${t.toUpperCase()}" n'existe pas.\nLes procédures disponibles sont: ${[Array.from(this.functionsDefinitions.keys()).map((t=>{var e;return`${t}(${null===(e=this.functionsDefinitions.get(t))||void 0===e?void 0:e.args.join(", ")})`})),...this.kernel.proceduresNames].join(", ")}.`);if(e.length!==s.args.length)throw new Error(`La fonction ${t}(${s.args.join(", ")}) attend ${s.args.length} argument${s.args.length>1?"s":""}, pas ${e.length}.`);this.kernel.subroutineEnter(s.args,e,(()=>this.stack.pop())),this.callStack.push(this.cursor),this.cursor=s.cursor}})),this.$if=_("IF ... ELSE",(()=>{const t=this.popNum();0===this.pop()&&(this.cursor=t)})),this.$forIn=_("FOR ... IN",(()=>{const[t,e,s,n]=this.stack.slice(-4),i=(0,r.Kg)(e)?e.split(""):e;if(!Array.isArray(i))throw new Error(["Après le IN, il me faut une liste ou une chaine.",`Mais j'ai reçu ça : ${JSON.stringify(i)}.`].join("\n"));if(!(0,r.Kg)(t))throw new Error("Internal error! VarName must be a number.");if(!(0,r.Et)(s))throw new Error("Internal error! Index must be a number.");if(!(0,r.Et)(n))throw new Error("Internal error! JumpEnd must be a number.");if(s>=i.length)return this.stack.splice(-4,4),void(this.cursor=n);this.kernel.setVar(t,i[s]),this.stack[this.stack.length-2]=s+1}))}execute(t){return N(this,void 0,void 0,(function*(){try{this.code=`${t}\n`,this.compile(),this.link()}catch(t){console.error(t),console.log("Byte code:",this.bytecode),o("Erreur de compilation !",i(t)?t:{code:this.code,pos:this.bytecode[this.cursor].pos,msg:`${t}`})}try{this.stack.splice(0,this.stack.length);const{bytecode:t,stack:e}=this;for(this.cursor=0,u.E.state.running.value=!0;this.cursor<t.length&&u.E.state.running.value;){const s=t[this.cursor++].val;"function"==typeof s?yield s():e.push(s)}this.kernel.debugVariables()}catch(t){console.error(t),console.log("Cursor:",this.cursor),console.log("Byte code:",this.bytecode),console.log("Stack:",this.stack),o("Erreur d'execution !",i(t)?t:{code:this.code,pos:this.bytecode[this.cursor-1].pos,msg:`${t}`})}finally{this.kernel.paint(),u.E.state.running.value=!1,this.kernel.music.stop(),this.kernel.cursor.hide(),this.kernel.onKeyPressed=null}}))}compile(){this.labels.reset(),this.bytecode.splice(0,this.bytecode.length);const t=new n.F(this.code);for(console.log("Tokens:",t.all()),t.next(),this.lexer=t;t.hasMoreCode();)if(!this.parseInstruction()){if("EOF"===t.token.id)break;t.fatal("J'attendais une instruction ici. Je suis perdu...")}this.pushBytecode("<<EOF>>"),console.log("Compiled!",this.bytecode)}link(){this.labels.apply(this.bytecode),this.debugBytecode()}fatal(t){const e=this.bytecode[this.cursor];throw e&&console.error(t,e),new Error(t)}pushBytecode(...t){for(const e of t)this.bytecode.push({pos:this.lexer.token.pos,val:e})}pushFunction(t,e){this.bytecode.push({pos:(null!=e?e:this.lexer.token).pos,val:t})}pushJump(t){this.labelPushItsValue(t),this.pushBytecode(this.$jump)}pushJumpIfZero(t){this.labelPushItsValue(t),this.pushBytecode(this.$jumpIfZero)}labelPushItsValue(t){this.pushBytecode(0),this.labels.link(this.bytecode.length-1,t)}labelStickHere(t){return this.labels.stick(t,this.bytecode.length)}labelCreate(t=""){return this.labels.create(t)}parseAny(...t){for(const e of t)if(e())return!0;return!1}pop(){const t=this.stack.pop();return null!=t?t:0}popStr(){const t=this.stack.pop();return(0,r.Kg)(t)?t:JSON.stringify(t)}popNum(){const t=this.stack.pop();if((0,r.Et)(t))return t;throw new Error(`J'attendais un nombre ici, mais j'ai reçu : ${JSON.stringify(t)}`)}popArr(){const t=this.stack.pop();return(0,r.Kg)(t)?t.split(""):Array.isArray(t)?t:(console.error("We were expecting an array, but got:",t),[])}makeBinOp(t){return _(t,(()=>{const e=this.pop(),s=this.pop(),n=a[t.toUpperCase()];n||this.lexer.fatal(`Unimplemented binary operator: "${t}"!`);const r=n(s,e);this.stack.push(r)}))}debugBytecode(){const t=this.labels.getLabelsMaxLength(),e=this.bytecode.map((({val:t},e)=>{if((0,r.Tn)(t))return`CALL ${t.name}`;const s=this.labels.getLinkAtCursor(e);return s?`${JSON.stringify(t)}  <-- ${s}`:`PUSH ${JSON.stringify(t)}`})).map(((e,s)=>`${`${s}`.padStart(6," ")}. ${this.labels.getLabelAtCursor(s).padEnd(t)} ${e}`));console.info(e.join("\n"))}}function _(t,e){return{[t]:()=>new Promise(((t,s)=>{try{e()}catch(t){s(t)}t()}))}[t]}function L(t){return(0,r.Kg)(t)?t:JSON.stringify(t)}function P(t){return new $(t)}},3052:(t,e,s)=>{s.d(e,{M:()=>Nt});var n=s(1858);class r{constructor(t,e){this.gl=t,this.screenWidthInverse=2/e.screenWidth,this.screenHeightInverse=2/e.screenHeight,this.texture=e.symbols;const s=new n.a6X(t,{vert:"// attPosition.x is +1 or -1\n// attPosition.y is +1 or -1\nattribute vec2 attPos;\n// UV coordinates are either 0 or 1.\nattribute vec2 attUV;\n\n// Double of the inverse of screen width/height in pixels.\nuniform vec2 uniScreenSizeInverse;\n// Screen coordinates of the center, in pixels.\n// The center of the screen is at (0,0).\nuniform vec2 uniCenter;\n// Size of the symbol in pixels divided by 256;\nuniform vec2 uniSymbolSize;\n// Position of the top left corner of the symbol,\n// expressed in pixels divided by 256.\nuniform vec2 uniSymbolCorner;\n// Scale of a symbol.\nuniform float uniScale;\n\nvarying vec2 varUV;\n\nvoid main() {\n    vec2 center = uniCenter * uniScreenSizeInverse;\n    vec2 point = 128.0 * uniSymbolSize * attPos;   // Later, we will add rotation and scale.\n    gl_Position = vec4(center + point * uniScale * uniScreenSizeInverse, 0.0, 1.0);\n    varUV = uniSymbolCorner + uniSymbolSize * attUV;\n}\n",frag:"precision mediump float;\n\n// The symbols' page.\nuniform sampler2D texSymbols;\nuniform float uniColor;\n\n// Coords of the current pixel. (0,0) is le left bottom one and (1,1) is the upper right one.\nvarying vec2 varUV;\n\nvoid main() {\n  float alpha = texture2D( texSymbols, varUV ).a;\n  if (alpha < 0.5) discard;\n  \n  gl_FragColor = vec4( vec3(uniColor), 1.0);\n//   if (varUV.x < 32.0 / 256.0) {\n//     gl_FragColor = vec4(0, 1, 0, 1);\n//   } else {\n//     gl_FragColor = vec4(1, 0, 0, 1);\n//   }\n}\n"});this.prg=s;const r=new n.I9j({attPos:"vec2",attUV:"vec2"});r.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),r.set("attUV",new Float32Array([0,1,0,0,1,1,1,0]));const i=new n.ZV_(t,s,[r]);this.vao=i}delete(){this.texture.delete(),this.prg.delete(),this.vao.delete()}paint({screenX:t,screenY:e,symbolX:s,symbolY:n,width:r=16,height:i=16,colorIndex:o,scale:a=1}){const{gl:l,prg:c,vao:u,texture:h,screenWidthInverse:p,screenHeightInverse:d}=this;c.use(),h.activate(0,c,"texSymbols"),c.uniform1f("uniScale",a),c.uniform1f("uniColor",o/255),c.uniform2f("uniScreenSizeInverse",p,d),c.uniform2f("uniCenter",t,e),c.uniform2f("uniSymbolCorner",s/256,n/256),c.uniform2f("uniSymbolSize",r/256,i/256),u.bind(),l.drawArrays(l.TRIANGLE_STRIP,0,4),u.unbind()}}class i extends n.tbm{constructor(t,e,s){super(),this.context=t,this.textureRead=e,this.action=s,this.scrollX=0,this.scrollY=0;const r=new n.dLJ({varying:{varUV:"vec2"},attributes:{attPos:"vec2",attUV:"vec2"},mainCode:["varUV = attUV;","gl_Position = vec4(attPos, 0.0, 1.0);"]}).code,i=new n.NI6({varying:{varUV:"vec2"},uniforms:{uniTexture:"sampler2D",uniScroll:"vec2"},outputs:{FragColor:"vec4"},mainCode:["float colorIndex = texture(uniTexture, varUV + uniScroll).r;","FragColor = vec4(colorIndex, 0.0, 0.0, 1.0);"]}).code,o=new n.a6X(t.gl,{vert:r,frag:i});this.prg=o;const a=new n.I9j({attPos:"vec2",attUV:"vec2"});a.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),a.set("attUV",new Float32Array([0,1,0,0,1,1,1,0]));const l=new n.ZV_(t.gl,o,[a]);this.vao=l}delete(){this.prg.delete(),this.vao.delete()}paint(){const{context:t,prg:e,vao:s,textureRead:n,scrollX:r,scrollY:i}=this,{gl:o}=t;e.use(),n.activate(0,e,"uniTexture"),e.uniform2f("uniScroll",-r/320,-i/240),s.bind(),o.drawArrays(o.TRIANGLE_STRIP,0,4),s.unbind(),this.action()}}class o extends n.tbm{constructor(t,e,s,r){super(),this.scrollX=0,this.scrollY=0,this.surface=new i(t,e,r),this.framebuffer=new n.K7(t,{textureColor0:s,children:[this.surface]})}delete(){this.surface.delete(),this.framebuffer.delete()}paint(t,e){this.surface.scrollX=.5*this.scrollX,this.surface.scrollY=.5*this.scrollY,this.framebuffer.paint(t,e)}}const a={replace:{blend:n.aMr.off},alpha:{blend:n.aMr.alpha},add:{blend:n.aMr.add}};class l{constructor(t){this.context=t,this.mode="alpha",this.action=c,this.currentFramebufferIndex=0,this.applyAction=()=>{this.action()};const e=new n.HTX(t),s=new n.HTX(t);this.textures=[e,s];for(const t of this.textures)t.setParams({magFilter:"NEAREST",minFilter:"NEAREST",wrapS:"REPEAT",wrapT:"REPEAT"});const r=this.applyAction;this.framebuffers=[new o(t,s,e,r),new o(t,e,s,r)]}get blend(){return a[this.mode]}get texture(){return this.textures[this.currentFramebufferIndex]}swap(){this.currentFramebufferIndex=1-this.currentFramebufferIndex}delete(){for(const t of this.textures)t.delete();for(const t of this.framebuffers)t.delete()}paint(t=c){this.swap(),this.action=t,this.framebuffers[this.currentFramebufferIndex].paint(0,0)}scroll(t,e){this.swap(),this.action=c;const s=this.framebuffers[this.currentFramebufferIndex];s.scrollX=t,s.scrollY=e,s.paint(0,0),s.scrollX=0,s.scrollY=0}}const c=()=>{};class u{constructor(t,e){this.context=t,this.texturePalette=e,e.setParams({magFilter:"NEAREST",minFilter:"NEAREST"});const s=new n.dLJ({varying:{varUV:"vec2"},attributes:{attPos:"vec2",attUV:"vec2"},mainCode:["varUV = attUV;","gl_Position = vec4(attPos, 0.0, 1.0);"]}).code,r=new n.NI6({varying:{varUV:"vec2"},uniforms:{uniTexture:"sampler2D",uniPalette:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["vec4 texel = texture(uniTexture, varUV);","float colorIndex = texel.r;","if (colorIndex == 0.0) discard;","float u = colorIndex;","FragColor = texture(uniPalette, vec2(u, 0.5));","if (colorIndex == 0.0) FragColor.a = 0.0;"]}).code,i=new n.a6X(t.gl,{vert:s,frag:r});this.prg=i;const o=new n.I9j({attPos:"vec2",attUV:"vec2"});o.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),o.set("attUV",new Float32Array([0,0,0,1,1,0,1,1]));const a=new n.ZV_(t.gl,i,[o]);this.vao=a}delete(){this.prg.delete(),this.vao.delete()}paint(t){const{context:e,prg:s,vao:r,texturePalette:i}=this,{gl:o}=e;s.use(),t.texture.activate(0,s,"uniTexture"),i.activate(1,s,"uniPalette"),n.Ipk.do(Object.assign({gl:o},t.blend),(()=>{r.bind(),o.drawArrays(o.TRIANGLE_STRIP,0,4),r.unbind()}))}}class h{constructor(t){this.texture=t,this.canvas=document.createElement("canvas"),this.canvas.width=256,this.canvas.height=1;const e=this.canvas.getContext("2d");if(!e)throw new Error("Unable to get 2D context for palette canvas!");this.imageData=e.getImageData(0,0,256,1),this.reset()}set(t,e,s,n,r=15){const{data:i}=this.imageData;let o=4*t;i[o++]=17*e,i[o++]=17*s,i[o++]=17*n,i[o]=17*r}get(t){const{data:e}=this.imageData;let s=4*t;return[Math.round(e[s++]/17),Math.round(e[s++]/17),Math.round(e[s++]/17),Math.round(e[s]/17)]}updateCanvas(){const{canvas:t}=this,e=t.getContext("2d");if(!e)throw new Error("Unable to get 2D context for palette canvas!");e.putImageData(this.imageData,0,0);const[s,n,r,i]=this.get(0);document.body.style.setProperty("--custom-monitor-color",`rgba(${17*s}, ${17*n}, ${17*r}, ${i/15})`),this.texture.loadBitmap(t)}reset(){const{data:t}=this.imageData;for(let e=0;e<t.length;e++)t[e]=0;const e=15;this.set(0,0,0,8),this.set(1,0,0,0),this.set(2,0,0,e),this.set(3,8,0,0),this.set(4,8,0,8),this.set(5,8,0,e),this.set(6,e,0,0),this.set(7,e,0,8),this.set(8,e,0,e),this.set(9,0,8,0),this.set(10,0,8,8),this.set(11,0,8,e),this.set(12,8,8,0),this.set(13,8,8,8),this.set(14,8,8,e),this.set(15,e,8,0),this.set(16,e,8,8),this.set(17,e,8,e),this.set(18,0,e,0),this.set(19,0,e,8),this.set(20,0,e,e),this.set(21,8,e,0),this.set(22,8,e,8),this.set(23,8,e,e),this.set(24,e,e,0),this.set(25,e,e,8),this.set(26,e,e,e);let s=28;for(let t=1;t<8;t++)for(let e=1;e<27;e++){const[n,r,i]=this.get(e).map((e=>0===e?0:8===e?e-t:e-2*t));this.set(s++,n,r,i)}for(let t=0;t<16;t++)this.set(240+t,t,t,t);this.updateCanvas()}}var p=s(7882),d=s(2197);function f(t=1,e=999){return s=>{if((s.length<t||s.length>e)&&t===e){if(0===t)throw new Error("Cette function n'attend aucun argument.");if(1===t)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${t} et ${e} arguments.`)}for(const t of s)if("number"!=typeof t)throw new Error(["Tous les arguments de cette fonction doivent être des nombres.",`Mais on a reçu : (${s.map(y).join(", ")}).`].join("\n"))}}function g(t=1,e=999){return s=>{if((s.length<t||s.length>e)&&t===e){if(0===t)throw new Error("Cette function n'attend aucun argument.");if(1===t)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${t} et ${e} arguments.`)}for(const t of s)if("string"!=typeof t)throw new Error(["Tous les arguments de cette fonction doivent être des textes.",`Mais on a reçu : (${s.map(y).join(", ")}).`].join("\n"))}}function m(t=0,e=999){return s=>{if((s.length<t||s.length>e)&&t===e){if(0===t)throw new Error("Cette function n'attend aucun argument.");if(1===t)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${t} et ${e} arguments.`)}}}function y(t){const e=(0,p.P)();if(Array.isArray(t))return e.typeArray;switch(typeof t){case"number":return e.typeNumber;case"string":return e.typeString;default:return e.typeUnknown}}function v(t,e,s){return n=>{try{return null==e||e(n),s(n)}catch(e){throw new Error(`Erreur de l'instruction "${t.toUpperCase()}": ${e}`)}}}const E=t=>v("BREAKPOINT",f(0,0),(()=>{console.log("Breakpoint!");for(const e of t.variables.keys())console.log(e,":=",t.variables.get(e));if(t.variables!==t.globalVariables){console.log("Global variables:");for(const e of t.globalVariables.keys())console.log(e,":=",t.globalVariables.get(e))}})),b=t=>v("cls",f(0,1),(([e])=>{t.paintFB((()=>{if((0,d.Et)(e))return void t.painterRect.paint(0,0,t.WIDTH,t.HEIGHT,(0,n.P_T)(Math.round(e),0,255),0);const{gl:s}=t;s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT)})),t.x=t.TEXT_ORIGIN_X,t.y=t.TEXT_ORIGIN_Y,t.paint()})),x=t=>v("color",f(1,1),(([e])=>{t.colorIndex=e})),w=t=>v("disk",f(1,5),(([e,s,n,r,i])=>{t.paintFB((()=>{t.painterDisk.paint(t.screenSpaceX(t.x),t.screenSpaceY(t.y),t.screenSpaceX(e),t.screenSpaceY(null!=s?s:e),t.colorIndex,null!=n?n:0,null!=r?r:360,null!=i?i:0)}))})),I=t=>v("draw",m(1),(e=>{const s=e.map((t=>(0,d.Kg)(t)?t:JSON.stringify(t))).join(" "),n=function(t){const e=[];let s=0;const n=e=>{e.lastIndex=-1;const n=e.exec(t.slice(s));if(!n)return null;const[r]=n;return s+=r.length,r.trim()};for(;s<t.length;)if(n(R))e.push(["("]);else if(n(T))e.push([")"]);else{const r=n(C);if(!r)throw new Error(`Je m'attendais à voir une commande ou une parenthèse, mais pas "${t.slice(s,s+5)}..." :\n\n${A(t,s)}`);const i=[];for(;;){const t=n(S);if(!t)break;i.push(Number(t))}e.push([r,...i])}return e}(s.split(/[,; \n\r\t]+/).join(" ")),r=[];t.paintFB((()=>{for(const[e,...i]of n)switch(e){case"(":r.push([t.x,t.y]);break;case")":{const e=r.pop();if(!e)break;const[s,n]=e;t.x=s,t.y=n;break}case"M":{const[e,s]=i;t.x=e,t.y=s;break}case"m":{const[e,s]=i;t.x+=e,t.y+=s;break}case"C":{const[e]=i;t.colorIndex=null!=e?e:t.colorIndex;break}case"D":{const[e,s,n,r,o]=i;t.painterDisk.paint(t.screenSpaceX(t.x),t.screenSpaceY(t.y),t.screenSpaceX(e),t.screenSpaceY(null!=s?s:e),t.colorIndex,null!=n?n:0,null!=r?r:360,null!=o?o:0);break}case"R":{const[e,s,n]=i;t.painterRect.paint(t.screenSpaceX(t.x),t.screenSpaceY(t.y),e,null!=s?s:e,t.colorIndex,null!=n?n:0);break}case"T":t.painterTri.paint(i,t.colorIndex,t.x,t.y,"TRIANGLES");break;default:{const t=s.indexOf(e);throw new Error(`Je ne reconnais pas la commande "${e}".\nN'oublie pas que la différence entre majuscules et minuscules est importante ici.\n${A(s,t)}`)}}}))}));function A(t,e){const s=Math.max(0,e-20),n=Math.min(t.length,e+20);return`${s>0?"...":"   "}${t.slice(s,n)}${n<t.length?"...":"   "}\n   ${" ".repeat(e-s)}^`}const S=/^[ \n\r\t]*^[-+]?([0-9]+(\.[0-9]+)?|\.[0-9]+)([Ee][+-]?[0-9]+)?[ \n\r\t,]*/g,C=/^[ \n\r\t]*[a-zA-Z]+[ \n\r\t]*/g,R=/^[ \n\r\t]*\([ \n\r\t]*/g,T=/^[ \n\r\t]*\)[ \n\r\t]*/g;var k=s(3185);const O=t=>v("EXIT",f(0,0),(()=>{t.paint(),k.E.stop()})),N=t=>v("INK",f(4,5),(([e,s,n,r,i])=>{t.palette.set(e,s,n,r,i),t.palette.updateCanvas(),t.paint()})),$=t=>v("label",m(1,2),(([e,s=1])=>{if(!(0,d.Et)(s))throw new Error("Si tu spécifie un deuxième argument pour LABEL(), il faut que ce soit un nombre.");const{x:n,y:r}=t,i=(0,d.Kg)(e)?e:JSON.stringify(e);let o=t.x-s*(i.length/2)*t.CHAR_SIZE;const a=t.y-s*t.CHAR_SIZE/2;for(const e of i.split(""))t.x=o+s*t.CHAR_SIZE/2,t.y=a+s*t.CHAR_SIZE/2,t.print(e,s),o+=t.CHAR_SIZE*s;t.x=n,t.y=r})),_=t=>v("layer",f(1,1),(([e])=>{t.currentLayerIndex=e})),L=t=>v("locate",f(2,2),(([e,s])=>{const r=(0,n.P_T)(Math.floor(e),0,t.TEXT_COLS-1),i=(0,n.P_T)(Math.floor(s),0,t.TEXT_ROWS-1);t.x=t.TEXT_ORIGIN_X+r*t.CHAR_SIZE,t.y=t.TEXT_ORIGIN_Y+i*t.CHAR_SIZE})),P=t=>v("MODE",g(1,1),(([e])=>{const s=["add","alpha","replace"];if(e=e.toLowerCase(),!s.includes(e))throw new Error([`Le mode "${e}" est inconnu.`,`Les modes disponibles sont : ${s.join(", ")}.`].join("\n"));t.layer.mode=e})),M=t=>v("move",f(2,2),(([e,s])=>{t.x=e,t.y=s})),F=t=>v("move",f(2,2),(([e,s])=>{t.x+=e,t.y+=s})),D=t=>v("pause",f(0,1),(([e])=>new Promise((s=>{const n=Math.max(0,(0,d.GB)(e,0));n>0?(t.paint(),globalThis.setTimeout(s,1e3*n)):globalThis.requestAnimationFrame((()=>{t.paint(),globalThis.setTimeout(s)}))})))),H=t=>v("PLAY",(t=>{if(t.length<1||t.length>2)throw new Error("Cette function attend entre 1 et 2 arguments.");const[e,s]=t;if(!(0,d.Xj)(e,["|","string",["array","string"]]))throw new Error("Le premier argument est la partition. J'attends un texte ou une liste de textes ici.");if(1!==t.length&&!(0,d.Et)(s))throw new Error("Le second argument est le tempo et il me faut un nombre ici.")}),(([e,s])=>{t.music.play(e,s)}));function V(t,e){const s=e.map((t=>(0,d.Kg)(t)?t:JSON.stringify(t))).join("");t.print(s)}const U=t=>v("print",m(),(e=>{V(t,e)})),B=t=>v("println",m(),(e=>{V(t,e),t.x=t.TEXT_ORIGIN_X,t.y+=t.CHAR_SIZE})),X=t=>v("rect",f(1,3),(([e,s,n])=>{t.paintFB((()=>{t.painterRect.paint(t.screenSpaceX(t.x),t.screenSpaceY(t.y),e,null!=s?s:e,t.colorIndex,null!=n?n:0)}))})),K=t=>v("reset",f(0,0),(()=>{t.reset()})),J=t=>v("sound",f(1,2),(([e,s=.1])=>{t.sound(e,s,"sine")})),j=t=>v("STOP",g(0,0),(([e])=>{t.music.stop()})),Y=t=>v("scrollX",f(2,2),(([e,s])=>{t.scroll(e,s)})),G=t=>v("tri",(t=>{if(1!==t.length)throw new Error("Cette fonction attend un et un seul argument.");const[e]=t;if(!(0,d.Xj)(e,["array","number"]))throw new Error("L'argument de cette fonction devrait être une liste de nombres")}),(([e])=>{if(1&e.length)throw new Error("La liste des coordonnées doit avoir un nombre pair d'éléments ([x, y, x, y, ...]).");t.paintFB((()=>{t.painterTri.paint(e,t.colorIndex,t.x,t.y,"TRIANGLES")}))}));const z=t=>v("wait",g(0,0),(()=>{return e=void 0,s=void 0,r=function*(){yield t.waitKey()},new((n=void 0)||(n=Promise))((function(t,i){function o(t){try{l(r.next(t))}catch(t){i(t)}}function a(t){try{l(r.throw(t))}catch(t){i(t)}}function l(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(o,a)}l((r=r.apply(e,s||[])).next())}));var e,s,n,r})),Z=t=>v("SEED",m(1,1),(([e])=>{if((0,d.Et)(e))t.random.seed=e;else{let s=(0,d.Kg)(e)?e:JSON.stringify(e),n=s.length;for(const t of s.split(""))n+=.01*t.charCodeAt(0);t.random.seed=n}}));function W(t,e,s){return n=>{try{return null==e||e(n),s(n)}catch(e){throw new Error(`Erreur de la fonction "${t.toUpperCase()}": ${e}`)}}}const q=t=>W("RANDOM",f(0,2),(e=>{if(0===e.length)return t.random.value;const[s,n]=e;return(0,d.Et)(n)?s===n?s:Math.min(s,n)+Math.floor(t.random.value*(Math.abs(n-s)+1)):Math.floor(t.random.value*s)})),Q=t=>W("RANDOMF",f(0,2),(e=>{if(0===e.length)return t.random.value;const[s,n]=e;return(0,d.Et)(n)?s===n?s:Math.min(s,n)+t.random.value*Math.abs(n-s):t.random.value*s}));var tt=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{l(n.next(t))}catch(t){i(t)}}function a(t){try{l(n.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};const et=t=>W("ASK",m(0),(e=>tt(void 0,void 0,void 0,(function*(){return yield it(e,t)})))),st=t=>W("ASK",m(0),(e=>tt(void 0,void 0,void 0,(function*(){return rt(yield it(e,t))})))),nt=t=>W("ASK",m(0),(e=>tt(void 0,void 0,void 0,(function*(){return Math.round(rt(yield it(e,t)))}))));function rt(t){const e=parseFloat(t);return Number.isNaN(e)?0:e}function it(t,e){return new Promise((s=>{const n=t.map((t=>(0,d.Kg)(t)?t:JSON.stringify(t))).join("");e.print(n),e.paint(),e.cursor.show();let r="";e.onKeyPressed=t=>(console.log("🚀 [ask] key =",t),1===t.length?(r+=t,e.cursor.hide(),e.print(t),void e.cursor.show()):"Enter"===t?(e.onKeyPressed=null,e.cursor.hide(),e.x=e.TEXT_ORIGIN_X,e.y+=e.CHAR_SIZE,e.scrollUpIfTextOverflows(),void s(r)):("Backspace"===t&&r.length>0&&(e.cursor.hide(),e.x-=e.CHAR_SIZE,e.x<-e.WIDTH/2&&(e.x+=e.WIDTH,e.y-=e.CHAR_SIZE),e.cursor.show(),r=r.slice(0,-1)),void console.log("🚀 [ask] key =",t)))}))}function ot(t){return e=>{if(e.length<2||e.length>3)throw new Error(`Cette fonction attends deux ou trois arguments : ${t}($texte, $taille) ou ${t}($texte, $taille, $remplissage).`);const[,s,n]=e;if(!(0,d.Et)(s))throw new Error(`La taille doit être un nombre :  ${t}($texte, $taille).`);if(void 0!==n&&!(0,d.Kg)(n))throw new Error(`Le remplissage doit être une chaîne :  ${t}($texte, $taille, remplissage).`)}}function at(t){return(0,d.Kg)(t)?t:(0,d.Et)(t)&&Math.abs(t)<1e-9?"0":JSON.stringify(t)}const lt=t=>W("INK",f(1,1),(([e])=>{const s=(0,n.P_T)(Math.round(e),0,255);return t.palette.get(s)})),ct=t=>W("MOUSEX",f(0,0),(()=>t.mouseX)),ut=t=>W("MOUSEY",f(0,0),(()=>t.mouseY)),ht=t=>W("PLAY",(t=>{if(t.length<1||t.length>2)throw new Error("Cette function attend entre 1 et 2 arguments.");const[e,s]=t;if(!(0,d.Xj)(e,["|","string",["array","string"]]))throw new Error("Le premier argument est la partition. J'attends un texte ou une liste de textes ici.");if(1!==t.length&&!(0,d.Et)(s))throw new Error("Le second argument est le tempo et il me faut un nombre ici.")}),(([e,s])=>t.music.play(e,s))),pt=t=>W("INPUTDIR",f(0,0),(()=>t.inputDir())),dt=t=>W("wait",g(0,0),(()=>t.waitKey())),ft=t=>W("key",g(1),(e=>t.isKeyPressed(e)?1:0)),gt=t=>W("PICK",(t=>{if(1!==t.length)throw new Error("Cette fonction attend un et un seul argument.");const[e]=t;if(!(0,d.Xj)(e,["|","string",["array","unknown"]]))throw new Error("L'unique argument de cette fonction devrait être une liste ou un texte")}),(([e])=>{const s=Math.floor(t.random.value*e.length);return(0,d.Kg)(e)?e.charAt(s):e[s]})),mt=t=>W("SEED",m(0,0),(()=>t.random.seed)),yt=Math.PI/180;class vt{constructor(t){this.context=t,this.STEPS=128;const e=new n.dLJ({uniforms:{uniStartAngle:"float",uniCenter:"vec2",uniRadius:"vec2",uniRotation:"mat2",uniStepsInRadians:"float"},mainCode:["if (gl_VertexID == 0) gl_Position = vec4(uniCenter, 0.0, 1.0);","else {","  float angle = uniStepsInRadians * float(gl_VertexID) + uniStartAngle;","  vec2 pos = vec2(","    cos(angle), sin(angle)","  ) * uniRadius;","  gl_Position = vec4(uniCenter + uniRotation * pos, 0.0, 1.0);","}"]}).code,s=new n.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,r=new n.a6X(t.gl,{vert:e,frag:s});this.prg=r}delete(){this.prg.delete()}paint(t,e,s,r,i,o,a,l){const{context:c,prg:u}=this,{gl:h}=c,p=(0,n.HPH)(o),d=Math.cos(p),f=Math.sin(p),g=new n.MRb(d,f,-f,d),m=2*Math.max(320*Math.abs(s),240*Math.abs(r));u.use(),u.uniform1f("uniStartAngle",(0,n.HPH)(l)),u.uniform2f("uniCenter",t,e),u.uniform2f("uniRadius",s,r),u.uniform1f("uniStepsInRadians",2*Math.PI/m),u.uniformMatrix2fv("uniRotation",g),u.uniform1f("uniColor",i/255);const y=a/360;h.drawArrays(h.TRIANGLE_FAN,0,1+Math.round((m+1)*y))}}class Et{constructor(t){this.context=t;const e=new n.dLJ({uniforms:{uniCenter:"vec2",uniRadius:"vec2",uniRotation:"mat2",uniScreenSize:"vec2"},attributes:{attPos:"vec2"},mainCode:["vec2 pos = (uniRotation * (attPos * uniRadius)) * uniScreenSize;","gl_Position = vec4(uniCenter + pos, 0.0, 1.0);"]}).code,s=new n.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,r=new n.a6X(t.gl,{vert:e,frag:s});this.prg=r;const i=new n.I9j({attPos:"vec2"});i.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1]));const o=new n.ZV_(t.gl,r,[i]);this.vao=o}delete(){this.prg.delete(),this.vao.delete()}paint(t,e,s,r,i,o){const{context:a,prg:l,vao:c}=this,{gl:u}=a;l.use();const h=(0,n.HPH)(o),p=Math.cos(h),d=Math.sin(h),f=new n.MRb(p,d,-d,p);l.uniformMatrix2fv("uniRotation",f),l.uniform2f("uniCenter",t,e),l.uniform2f("uniRadius",s/2,r/2),l.uniform2f("uniScreenSize",2/a.width,2/a.height),l.uniform1f("uniColor",i/255),c.bind(),u.drawArrays(u.TRIANGLE_STRIP,0,4),c.unbind()}}class bt{constructor(){this.frequencies={},this.notes=[],this.indexes=[],this.playing=!1,this.next=t=>{var e;if(!window.AudioContext||!this.playing||!k.E.state.running.value)return;const s=this.notes[t],n=s[this.indexes[t]%s.length];if(!n)return;this.indexes[t]++;const r=n.duration;setTimeout((()=>this.next(t)),1e3*r);const i=Math.min(.1,r/10),o=new window.AudioContext,a=o.createOscillator(),l=o.createGain();a.type="sine",a.frequency.setValueAtTime(null!==(e=this.frequencies[n.note])&&void 0!==e?e:0,o.currentTime),a.connect(l),l.connect(o.destination),l.gain.exponentialRampToValueAtTime(1e-6,o.currentTime),l.gain.exponentialRampToValueAtTime(n.volume,o.currentTime+i),l.gain.exponentialRampToValueAtTime(n.volume,o.currentTime+r-i),l.gain.exponentialRampToValueAtTime(1e-6,o.currentTime+r),a.start(),a.stop(o.currentTime+r)};for(let t=0;t<10;t++)for(const e of Object.keys(St)){const s=St[e],n=`${e}${t}`;this.frequencies[n]=s*Math.pow(2,t-5)}}play(t,e=120){const s=Array.isArray(t)?t:[t];let n=0;this.notes=[],this.indexes=[];for(const t of s){const s=xt(t,e);this.notes.push(s),this.playing=!0,this.indexes.push(0),n=Math.max(n,s.reduce(((t,e)=>t+e.duration),0))}for(let t=0;t<this.indexes.length;t++)setTimeout((()=>this.next(t)));return n}stop(){this.playing=!1}}function xt(t,e){const s=[],n=240/e;let r=n/4,i=0,o=.5;for(;i<t.length;){At.lastIndex=-1;const e=At.exec(t.slice(i));if(e){o=Number(e[0].slice(1))/10,i+=e[0].length;continue}It.lastIndex=-1;const a=It.exec(t.slice(i));if(a){r=n/Number(a[0].slice(1)),i+=a[0].length;continue}wt.lastIndex=-1;const l=wt.exec(t.slice(i));l?(i+=l[0].length,s.push({note:l[0],volume:o,duration:r})):i++}return s}const wt=/^(-|[A-G][b#]?[0-9])/g,It=/^:[1-9][0-9]*/g,At=/^@[1-9]/g,St={Cb:493.88,C:523.25,"C#":554.37,Db:554.37,D:587.33,"D#":622.25,Eb:622.25,E:659.26,"E#":698.46,Fb:659.26,F:698.46,"F#":739.99,Gb:739.99,G:783.99,"G#":830.61,Ab:830.6,A:880,"A#":932.32,Bb:932.32,B:987.76,"B#":1046.5};class Ct{constructor(t){this.kernel=t,this.timeout=0,this.isOn=!1,this.on=()=>{globalThis.clearTimeout(this.timeout),this.isOn=!0,this.kernel.printChar(143),this.kernel.paint(),this.timeout=globalThis.setTimeout(this.off,500)},this.off=()=>{globalThis.clearTimeout(this.timeout),this.isOn=!1;const t=this.kernel.colorIndex;this.kernel.colorIndex=0,this.kernel.printChar(143),this.kernel.paint(),this.kernel.colorIndex=t,this.timeout=globalThis.setTimeout(this.on,500)}}show(){globalThis.clearTimeout(this.timeout),this.on()}hide(){globalThis.clearTimeout(this.timeout),this.isOn&&(this.off(),globalThis.clearTimeout(this.timeout))}}class Rt{constructor(t){this.context=t;const e=new n.dLJ({uniforms:{uniOrigin:"vec2",uniScreenSize:"vec2"},attributes:{attPos:"vec2"},mainCode:["vec2 pos = (attPos + uniOrigin) * uniScreenSize;","gl_Position = vec4(pos, 0.0, 1.0);"]}).code,s=new n.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,r=new n.a6X(t.gl,{vert:e,frag:s});this.prg=r;const i=new n.I9j({attPos:"vec2"},{usage:"DYNAMIC_DRAW"});this.dataset=i,i.set("attPos",new Float32Array([0,60,50,-30,-50,-30]));const o=new n.ZV_(t.gl,r,[i]);this.vao=o}delete(){this.prg.delete(),this.vao.delete()}paint(t,e,s,n,r){const{context:i,prg:o,vao:a,dataset:l}=this,{gl:c}=i;o.use(),o.uniform2f("uniOrigin",s,n),o.uniform2f("uniScreenSize",2/i.width,2/i.height),o.uniform1f("uniColor",e/255),a.bind(),l.set("attPos",new Float32Array(t)),a.updateDataset(l),c.drawArrays(c[r],0,t.length/2),a.unbind()}}class Tt{constructor(){this._seed=Math.random(),this.increment=1}get seed(){return this._seed}set seed(t){this._seed=t,this.increment=1}get value(){this.increment+=.73554992839;const t=43758.5453*Math.sin(12.9898*this._seed+78.233*this.increment);return t-Math.floor(t)}}var kt=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{l(n.next(t))}catch(t){i(t)}}function a(t){try{l(n.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};const Ot=()=>{};class Nt extends n.tbm{constructor(t,e){super(),this.canvas=t,this._onKeyPressed=null,this.id="Kernel#"+Nt.ID++,this.LAYERS_COUNT=3,this.WIDTH=640,this.HEIGHT=480,this.CHAR_SIZE=16,this.TEXT_COLS=Math.floor(this.WIDTH/this.CHAR_SIZE),this.TEXT_ROWS=Math.floor(this.HEIGHT/this.CHAR_SIZE),this.TEXT_ORIGIN_X=(this.CHAR_SIZE-this.WIDTH)/2,this.TEXT_ORIGIN_Y=(this.CHAR_SIZE-this.HEIGHT)/2,this.music=new bt,this.random=new Tt,this.x=(this.CHAR_SIZE-this.WIDTH)/2,this.y=(this.CHAR_SIZE-this.HEIGHT)/2,this.colorIndex=24,this.variablesStack=[new Map],this.subroutineCleanupFunctions=[],this.layers=[],this._currentLayerindex=1,this._mouseX=0,this._mouseY=0,this.handleKeyDown=t=>{const{onKeyPressed:e}=this;e&&(t.stopPropagation(),t.preventDefault(),e(t.key))},this.handleMouseMove=t=>{this._mouseX=t.current.x*this.WIDTH/2,this._mouseY=-t.current.y*this.HEIGHT/2},t.width=this.WIDTH,t.height=this.HEIGHT,t.style.aspectRatio=`${this.WIDTH}/${this.HEIGHT}`;const s=new n.tfp(t,{alpha:!0,antialias:!1,preserveDrawingBuffer:!0,onResize(t,e,s){}});this.context=s,this.painterDisk=new vt(s),this.painterRect=new Et(s),this.painterTri=new Rt(s),this.texturePalette=new n.HTX(s),this.palette=new h(this.texturePalette),this.colorizer=new u(s,this.texturePalette),this.textureSymbols=new n.HTX(s).setParams({magFilter:"LINEAR",minFilter:"LINEAR",wrapS:"MIRRORED_REPEAT",wrapT:"MIRRORED_REPEAT"}).loadBitmap(e);for(let t=0;t<this.LAYERS_COUNT;t++)this.layers.push(new l(s));var i;s.add(this),s.paint(),this.painterSymbols=new r(s.gl,{symbols:this.textureSymbols,screenWidth:this.WIDTH,screenHeight:this.HEIGHT}),this.procedures={BREAKPOINT:E(i=this),CLS:b(i),COLOR:x(i),DISK:w(i),DRAW:I(i),EXIT:O(i),INK:N(i),LABEL:$(i),LAYER:_(i),LOCATE:L(i),MODE:P(i),MOVE:M(i),MOVER:F(i),PAUSE:D(i),PLAY:H(i),PRINT:U(i),PRINTLN:B(i),RECT:X(i),RESET:K(i),SCROLL:Y(i),SEED:Z(i),SOUND:J(i),STOP:j(i),TRI:G(i),WAIT:z(i)},this.functions=(t=>({ABS:W("ABS",f(1,1),(([t])=>Math.abs(t))),ASC:W("ASC",g(1,1),(([t])=>t.charCodeAt(0))),ASK:et(t),ASKINT:nt(t),ASKNUM:st(t),CHR:W("CHR",f(1),(t=>t.map((t=>String.fromCharCode(t))).join(""))),CLAMP:W("CLAMP",f(3,3),(([t,e,s])=>(0,n.O6b)(t,e,s))),COLOR:W("COLOR",f(0,0),(()=>t.colorIndex)),COS:W("COS",f(1,1),(([t])=>Math.cos(t*yt))),FLOOR:W("FLOOR",f(1,1),(([t])=>Math.floor(Number(t)))),FRACT:W("FRACT",f(1,1),(([t])=>Math.abs(t-Math.floor(Number(t))))),HEX:W("HEX",f(1,1),(([t])=>t.toString(16).toUpperCase())),HOUR:W("HOUR",m(0,0),(()=>(new Date).getHours())),INK:lt(t),INPUTDIR:pt(t),INT:W("INT",m(1,1),(([t])=>Array.isArray(t)?t.length:Math.round(Number(t)))),KEY:ft(t),LAYER:W("LAYER",f(0,0),(()=>t.currentLayerIndex)),LEN:W("LEN",m(1,1),(t=>{let[e]=t;return(0,d.Et)(e)?0===e?1:Math.max(0,Math.ceil(Math.log10(Math.abs(e)+1e-14))):e.length})),LIST:W("LIST",(t=>{const[e]=t;if(2!==t.length||"number"!=typeof e)throw new Error("Cette fonction attends deux arguments: le nombre d'éléments et la valeur initiale de ces éléments.")}),(([t,e])=>new Array(t).fill(e))),LOWERCASE:W("LOWERCASE",g(1),(t=>t.join("").toLowerCase())),MIN:W("MIN",f(1),(([t,...e])=>e.reduce(((t,e)=>Math.min(t,e)),t))),MINUTE:W("MINUTE",m(0,0),(()=>(new Date).getMinutes())),MAX:W("MAX",f(1),(([t,...e])=>e.reduce(((t,e)=>Math.max(t,e)),t))),MODE:W("MODE",f(0,0),(()=>t.layer.mode)),MOUSEX:ct(t),MOUSEY:ut(t),NOT:W("NOT",f(1,1),(([t])=>0===t?1:0)),PADL:W("PADL",ot("PADL"),(t=>{const[e,s,n=" "]=t;return at(e).slice(0,s).padEnd(s,n.charAt(0))})),PADR:W("PADR",ot("PADR"),(t=>{const[e,s,n=" "]=t;return at(e).slice(0,s).padStart(s,n.charAt(0))})),PICK:gt(t),PLAY:ht(t),RANDOM:q(t),RANDOMF:Q(t),RANGE:W("RANGE",f(1,3),(t=>{let[e,s,n]=t;(0,d.Et)(s)||(s=e-1,e=0),n=(0,d.Et)(n)?Math.abs(n):1;const r=Math.floor(Math.abs(s-e)/n)+1;if(1===r)return[e];const i=e<s?n:-n,o=[];for(let t=0;t<r;t++)o.push(e+i*t);return o})),SECOND:W("SECOND",m(0,0),(()=>(new Date).getSeconds())),SEED:mt(t),SIN:W("SIN",f(1,1),(([t])=>Math.sin(t*yt))),TIME:W("TIME",f(0,0),(()=>Date.now())),UPPERCASE:W("UPPERCASE",g(1),(t=>t.join("").toUpperCase())),WAIT:dt(t)}))(this),this.reset(),s.inputs.pointer.eventMove.addListener(this.handleMouseMove),this.cursor=new Ct(this)}get onKeyPressed(){return this._onKeyPressed}set onKeyPressed(t){this._onKeyPressed&&globalThis.document.removeEventListener("keydown",this.handleKeyDown,!0),this._onKeyPressed=t,t&&globalThis.addEventListener("keydown",this.handleKeyDown,!0)}get mouseX(){return this._mouseX}get mouseY(){return this._mouseY}inputDir(){const{context:t}=this;let e=0,s=0;return t.inputs.keyboard.isDown("ArrowUp")?s=-1:t.inputs.keyboard.isDown("ArrowDown")&&(s=1),t.inputs.keyboard.isDown("ArrowLeft")?e=-1:t.inputs.keyboard.isDown("ArrowRight")&&(e=1),[e,s]}isKeyPressed(t){for(const e of t)if(!this.context.inputs.keyboard.isDown(e))return!1;return!0}waitKey(){return kt(this,void 0,void 0,(function*(){return this.paint(),new Promise((t=>{const{keyboard:e}=this.context.inputs,s=n=>{n.preventDefault(),n.stopPropagation(),e.eventKeyPress.removeListener(s),t(n.key)};e.eventKeyPress.addListener(s)}))}))}get allVarNames(){return Array.from(this.variables.keys())}get proceduresNames(){return Object.keys(this.procedures).sort()}get functionsNames(){return Object.keys(this.functions).sort()}hasFunction(t){return void 0!==this.functions[t.trim().toUpperCase()]}reset(){return kt(this,void 0,void 0,(function*(){this.music.stop(),this.variables.clear(),this.globalVariables.clear(),this.palette.reset(),this.colorIndex=24;for(let t=0;t<this.LAYERS_COUNT;t++)this.paintFB((()=>{const{gl:e}=this;this.currentLayerIndex=t,e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}));this.currentLayerIndex=0,this.x=this.TEXT_ORIGIN_X,this.y=this.TEXT_ORIGIN_Y,this.paint()}))}fullscreenRequest(){const{canvas:t}=this;(0,n.iJ5)(t.parentElement)}fullscreenExit(){(0,n.jtz)()}sound(t,e,s="sine"){if(!globalThis.AudioContext)return;const n=new globalThis.AudioContext,r=n.createOscillator(),i=n.createGain();i.connect(n.destination),r.connect(i),r.type=s,r.frequency.value=t,i.gain.exponentialRampToValueAtTime(1e-5,n.currentTime+e),r.start(),r.stop(n.currentTime+e)}get gl(){return this.context.gl}screenSpaceX(t){return 2*t/this.WIDTH}screenSpaceY(t){return 2*t/this.HEIGHT}executeProcedure(t,e){return kt(this,void 0,void 0,(function*(){try{const s=this.procedures[t];return!!s&&(yield s(e),!0)}catch(e){const s=e instanceof Error?e.message:JSON.stringify(e);throw new Error(`Erreur de l'instruction ${t.toUpperCase()} :\n${s}`)}}))}executeFunction(t,e){try{const s=this.functions[t];if(!s)throw new Error(`La fonction "${t.toUpperCase()}" n'existe pas.\nLes fonctions disponibles sont: ${Object.keys(this.functions).sort().join(", ")}.`);return s(e)}catch(e){const s=e instanceof Error?e.message:JSON.stringify(e);throw new Error(`Erreur de la fonction ${t.toUpperCase()} :\n${s}`)}}get currentLayerIndex(){return this._currentLayerindex}set currentLayerIndex(t){t=(0,n.P_T)(Math.round(t),0,this.LAYERS_COUNT-1),this._currentLayerindex=t}get layer(){return this.layers[this.currentLayerIndex]}delete(){for(const t of this.layers)t.delete();this.painterTri.delete(),this.painterDisk.delete(),this.painterRect.delete(),this.painterSymbols.delete(),this.textureSymbols.delete(),this.music.stop()}paint(){try{const{context:t,colorizer:e}=this,{gl:s}=t;s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT);for(const t of this.layers)e.paint(t)}catch(t){console.error("Error while painting:",t)}}paintFB(t=Ot){this.layer.paint(t)}scroll(t,e){this.layer.scroll(t,e)}scrollUpIfTextOverflows(t=1){for(;this.y>this.HEIGHT/2;){const e=this.CHAR_SIZE*t;this.y-=e,this.scroll(0,-e),this.paintFB((()=>{this.painterRect.paint(0,this.screenSpaceY((this.HEIGHT-this.CHAR_SIZE)/2),this.WIDTH,this.CHAR_SIZE,0,0)}))}}print(t,e=1){this.paintFB((()=>{for(const s of t.split("")){const t=255&s.charCodeAt(0),n=15&t,r=t-n>>4;this.painterSymbols.paint({screenX:this.x,screenY:this.y,symbolX:n*this.CHAR_SIZE,symbolY:r*this.CHAR_SIZE,colorIndex:this.colorIndex,scale:e}),this.x+=this.CHAR_SIZE*e,this.x>=this.WIDTH/2&&(this.x=this.TEXT_ORIGIN_X,this.y+=this.CHAR_SIZE*e),this.scrollUpIfTextOverflows(e)}}))}printChar(t,e=1){this.paintFB((()=>{const s=255&t,n=15&s,r=s-n>>4;this.painterSymbols.paint({screenX:this.x,screenY:this.y,symbolX:n*this.CHAR_SIZE,symbolY:r*this.CHAR_SIZE,colorIndex:this.colorIndex,scale:e})}))}getVar(t){var e;const s="@"===t.trim().charAt(0)?this.globalVariables:this.variables;if(t=$t(t),!s.has(t)){const e=[`La variable $${t.toLocaleLowerCase()} n'existe pas.`],n=Array.from(s.keys()).map((t=>`$${t.toLocaleLowerCase()}`));throw 0===n.length?e.push("Aucune variable n'a encore été créée."):1===n.length?e.push(`La seule variable existante maintenant est ${n[0]}.`):e.push(`Les variables disponibles sont : ${n.join("\n")}`),this.variables!==this.globalVariables&&e.push("N'oublie pas que les fonctions ont leurs propres variables."),this.globalVariables.has(t)&&e.push(`Si tu veux lire la variable globale $${t.toLowerCase()},`,`tu peux utiliser la syntaxe @${t.toLowerCase()}.`),new Error(e.join("\n"))}return null!==(e=s.get(t))&&void 0!==e?e:0}setVar(t,e){this.variables.set($t(t),e)}debugVariables(){for(const t of this.variables.keys())console.log(t,"=",this.getVar(t))}subroutineEnter(t,e,s){var n;this.subroutineCleanupFunctions.push(s);const r=new Map;this.variablesStack.push(r);for(let s=0;s<t.length;s++)this.setVar(t[s],null!==(n=e[s])&&void 0!==n?n:0)}subroutineExit(){this.variablesStack.pop();const t=this.subroutineCleanupFunctions.pop();null==t||t()}test(){this.paintFB((()=>{this.painterSymbols.paint({colorIndex:4,screenX:0,screenY:0,symbolX:0,symbolY:0,width:512,height:512})}))}get variables(){const t=this.variablesStack.at(-1);if(!t)throw Error("Nothing left on the variables stack!");return t}get globalVariables(){return this.variablesStack[0]}}function $t(t){return(t.startsWith("$")||t.startsWith("@")?t.slice(1):t).toUpperCase()}Nt.ID=0},3185:(t,e,s)=>{s.d(e,{E:()=>u});var n=s(3052),r=s(2772),i=s(8347),o=s(2197);const a={lang:new i.A("fr",{storage:{id:"TLK-74/lang",guard:o.Kg},transform:t=>t.slice(0,2).toLocaleLowerCase()}),error:new i.A(null),ready:new i.A(!1),running:new i.A(!1),focusOnManual:new i.A(!0,{storage:{id:"TLK-74/focusOnManual",guard:o.Lm}}),code:new i.A(["REM Ceci est un commentaire",'PRINT("Bonjour le monde !")'].join("\n"),{storage:{id:"TLK-74/Basik/current",guard:o.Kg}}),manualPageId:new i.A("index",{storage:{id:"TLK-74/Manual/current",guard:o.Kg}})};var l=s(2501),c=function(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{l(n.next(t))}catch(t){i(t)}}function a(t){try{l(n.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};const u=new class{constructor(){this.state=a,this.canvas=null,this.kernel=null,this.options=null}setCanvas(t){var e;u.state.ready.value=null!==t,t!==this.canvas&&(null===(e=this.kernel)||void 0===e||e.delete(),this.canvas=t,t&&(this.kernel=new n.M(t,r.m.symbols)),this.options&&this.run(this.options))}run(){return c(this,arguments,void 0,(function*(t={}){const{kernel:e,canvas:s}=this;if(!s||!e)return void(this.options=t);this.options=null;const{fullscreen:n=!1,code:r}=t;try{n&&e.fullscreenRequest(),u.state.error.value=null,u.state.running.value=!0;const t=(0,l.R)(e);yield t.execute(null!=r?r:this.state.code.value)}catch(t){console.error(t);const e=(0,o.Kg)(t)?t:t instanceof Error?t.message:JSON.stringify(t);u.state.error.value=e}finally{this.stop(),n&&e.fullscreenExit()}}))}stop(){u.state.running.value=!1}share(){return c(this,void 0,void 0,(function*(){const{href:t}=globalThis.location,e=t.lastIndexOf("#"),s=`${e>0?t.slice(0,e):t}#/run/${n=u.state.code.value,btoa(n)}`;var n;navigator.share?navigator.share({title:"TLK-74",text:"Mon programme",url:s}):globalThis.open(s,"_blank_")}))}}},5146:(t,e,s)=>{s.d(e,{F:()=>i});const n={SPC:/^[ \t]+/g,COM:/^REM(?![a-z0-9])[^\n\r]*[\n\r]+/gi,EOL:/^[\n\r]+/g,VAR:/^\$[a-z0-9_]+/gi,GLOBAL_VAR:/^@[a-z0-9_]+/gi,DESTRUCT:/^\$\[\s*[a-z0-9_]+\s*(,\s*[a-z0-9_]+\s*)*\]/gi,HEX:/^#[0-9a-f]+/gi,NUM:/^([0-9]+(\.[0-9]+)?|\.[0-9]+)([Ee][+-]?[0-9]+)?/g,STR:/^"(\\"|[^"])*"/g,SIGN:/^[+-]/gi,BINOP:/^(and|or|xor|>=|<=|<>|\^|==|[%*/<>])/gi,EQUAL:/^=/g,PAR_OPEN:/^\(/g,PAR_CLOSE:/^\)/g,BRA_OPEN:/^\{/g,BRA_CLOSE:/^\}/g,SQR_OPEN:/^\[/g,SQR_CLOSE:/^\]/g,COMMA:/^,/g,DEF:/^def(?![a-z0-9])/i,RETURN:/^return(?![a-z0-9])/i,WHILE:/^while(?![a-z0-9])/i,FOR:/^for(?![a-z0-9])/i,IN:/^in(?![a-z0-9])/i,IF:/^if(?![a-z0-9])/i,ELIF:/^elif(?![a-z0-9])/i,ELSE:/^else(?![a-z0-9])/i,FUNC:/^[a-z_][a-z_0-9]*\(/i,INST:/^[a-z_][a-z_0-9]*/gi,EOF:/^<<EOF>>/},r=["SPC","COM","EOL"];class i{constructor(t){this._code=t,this._cursor=0,this._token={id:"EOF",val:"",pos:1e100}}get token(){return this._token}get tokenID(){return this.token.id}get tokenCode(){return this._code.slice(this.token.pos)}all(){const t=this._cursor,e=[];for(this._cursor=0;this.hasMoreCode();)this.next(),e.push(structuredClone(this._token));return this._cursor=t,e}highlight(){const t=[];let e=0;for(;e<this._code.length;){const s=this._code.slice(e);let r=null;for(const[t,i]of Object.entries(n)){i.lastIndex=-1;const n=i.exec(s);if(n){r={id:t,val:n[0],pos:e};break}}if(r){e+=r.val.length;let s=r.val.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");switch(r.id){case"VAR":s=s.toLowerCase();break;case"COM":s=s.slice(0,3).toUpperCase()+s.slice(3);break;case"HEX":case"FUNC":case"DEF":case"RETURN":case"FOR":case"IN":case"IF":case"ELSE":case"WHILE":s=s.toUpperCase()}t.push(`<span class="Basik-${r.id}">${s}</span>`)}else e+=1,t.push(s.charAt(0))}return t.join("")}hasMoreCode(){return this._cursor<this._code.length-1&&"EOF"!==this.token.id}fatal(t,e){var s,n={pos:null!==(s=null==e?void 0:e.pos)&&void 0!==s?s:this._cursor,code:this._code,msg:t};throw console.error("Error:",n),console.error("Token:",null!=e?e:this.token),n}next(){let t=this._code.slice(this._cursor);if(0===t.trimEnd().length)return this._token={id:"EOF",pos:this._cursor,val:""},void(this._cursor+=t.length+1);for(;;){let e=null;for(const s of Object.keys(n)){const r=s,i=n[r];if(!i)continue;i.lastIndex=0;const o=i.exec(t);if(o){e={id:r,val:o[0],pos:this._cursor};break}}if(e||this.fatal(`Je suis tombé sur un caractère qui n'a rien à faire là : "${t.charAt(0)}".`),this._cursor+=e.val.length,!r.includes(e.id))return void(this._token=e);t=this._code.slice(this._cursor)}}is(...t){return t.includes(this._token.id)}get(...t){if(!t.includes(this._token.id))return;const e=structuredClone(this._token);return this.next(),e}expect(t,e){(Array.isArray(t)?t:[t]).includes(this._token.id)||this.fatal(e);const s=structuredClone(this._token);return this.next(),s}}},7882:(t,e,s)=>{s.d(e,{P:()=>o});var n=s(3185);const r={confirmCopyCode:"Es-tu sūr de vouloir remplacer to programme courant avec celui-ci ?",confirmCopyCodeYes:"Oui !",confirmCopyCodeNo:"Laisse tomber",dblClickOnCode:"Double clique pour utiliser ce code",nextChapter:"Chapitre suivant :",prevChapter:"Chapitre précédent :",typeArray:"liste",typeNumber:"nombre",typeString:"texte",typeUnknown:"type inconnu"},i={confirmCopyCode:"Are you sure you want to replace your current program with this one?",confirmCopyCodeYes:"Sure!",confirmCopyCodeNo:"No, drop it",dblClickOnCode:"Double click to use this code",nextChapter:"Next chapter:",prevChapter:"Previous chapter:",typeArray:"list",typeNumber:"number",typeString:"text",typeUnknown:"unknown type"};function o(){return"en"===n.E.state.lang.value?i:r}}}]);