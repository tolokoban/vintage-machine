"use strict";(self.webpackChunkvintage_machine=self.webpackChunkvintage_machine||[]).push([[185],{3185:(e,t,n)=>{n.d(t,{E:()=>u});var s=n(4707),r=n(2772),i=n(8347),o=n(2197);const a={lang:new i.A("fr",{storage:{id:"TLK-74/lang",guard:o.Kg},transform:e=>e.slice(0,2).toLocaleLowerCase()}),error:new i.A(null),ready:new i.A(!1),running:new i.A(!1),focusOnManual:new i.A(!0,{storage:{id:"TLK-74/focusOnManual",guard:o.Lm}}),code:new i.A(["REM Ceci est un commentaire",'PRINT("Bonjour le monde !")'].join("\n"),{storage:{id:"TLK-74/Basik/current",guard:o.Kg}}),manualPageId:new i.A("index",{storage:{id:"TLK-74/Manual/current",guard:o.Kg}})};var c=n(6190),l=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const u=new class{constructor(){this.state=a,this.canvas=null,this.kernel=null}setCanvas(e){var t;console.log("üöÄ [workbench] canvas =",e),u.state.ready.value=null!==e,e!==this.canvas&&(null===(t=this.kernel)||void 0===t||t.delete(),this.canvas=e,e&&(this.kernel=new s.M(e,r.m.symbols)))}run(){return l(this,arguments,void 0,(function*({fullscreen:e=!1,code:t}={}){const{kernel:n}=this;if(n)try{e&&n.fullscreenRequest(),u.state.error.value=null,u.state.running.value=!0;const s=(0,c.R)(n);yield s.execute(null!=t?t:this.state.code.value)}catch(e){console.error(e);const t=(0,o.Kg)(e)?e:e instanceof Error?e.message:JSON.stringify(e);u.state.error.value=t}finally{this.stop(),e&&n.fullscreenExit()}}))}stop(){u.state.running.value=!1}share(){return l(this,void 0,void 0,(function*(){const{href:e}=globalThis.location,t=e.lastIndexOf("#"),n=`${t>0?e.slice(0,t):e}#/run/${s=u.state.code.value,btoa(s)}`;var s;navigator.share?navigator.share({title:"TLK-74",text:"Mon programme",url:n}):globalThis.open(n,"_blank_")}))}}},4707:(e,t,n)=>{n.d(t,{M:()=>me});var s=n(1858);class r{constructor(e,t){this.gl=e,this.screenWidthInverse=2/t.screenWidth,this.screenHeightInverse=2/t.screenHeight,this.texture=t.symbols;const n=new s.a6X(e,{vert:"// attPosition.x is +1 or -1\n// attPosition.y is +1 or -1\nattribute vec2 attPos;\n// UV coordinates are either 0 or 1.\nattribute vec2 attUV;\n\n// Double of the inverse of screen width/height in pixels.\nuniform vec2 uniScreenSizeInverse;\n// Screen coordinates of the center, in pixels.\n// The center of the screen is at (0,0).\nuniform vec2 uniCenter;\n// Size of the symbol in pixels divided by 256;\nuniform vec2 uniSymbolSize;\n// Position of the top left corner of the symbol,\n// expressed in pixels divided by 256.\nuniform vec2 uniSymbolCorner;\n// Scale of a symbol.\nuniform float uniScale;\n\nvarying vec2 varUV;\n\nvoid main() {\n    vec2 center = uniCenter * uniScreenSizeInverse;\n    vec2 point = 128.0 * uniSymbolSize * attPos;   // Later, we will add rotation and scale.\n    gl_Position = vec4(center + point * uniScale * uniScreenSizeInverse, 0.0, 1.0);\n    varUV = uniSymbolCorner + uniSymbolSize * attUV;\n}\n",frag:"precision mediump float;\n\n// The symbols' page.\nuniform sampler2D texSymbols;\nuniform float uniColor;\n\n// Coords of the current pixel. (0,0) is le left bottom one and (1,1) is the upper right one.\nvarying vec2 varUV;\n\nvoid main() {\n  float alpha = texture2D( texSymbols, varUV ).a;\n  if (alpha < 0.5) discard;\n  \n  gl_FragColor = vec4( vec3(uniColor), 1.0);\n//   if (varUV.x < 32.0 / 256.0) {\n//     gl_FragColor = vec4(0, 1, 0, 1);\n//   } else {\n//     gl_FragColor = vec4(1, 0, 0, 1);\n//   }\n}\n"});this.prg=n;const r=new s.I9j({attPos:"vec2",attUV:"vec2"});r.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),r.set("attUV",new Float32Array([0,1,0,0,1,1,1,0]));const i=new s.ZV_(e,n,[r]);this.vao=i}delete(){this.texture.delete(),this.prg.delete(),this.vao.delete()}paint({screenX:e,screenY:t,symbolX:n,symbolY:s,width:r=16,height:i=16,colorIndex:o,scale:a=1}){const{gl:c,prg:l,vao:u,texture:h,screenWidthInverse:p,screenHeightInverse:d}=this;l.use(),h.activate(0,l,"texSymbols"),l.uniform1f("uniScale",a),l.uniform1f("uniColor",o/255),l.uniform2f("uniScreenSizeInverse",p,d),l.uniform2f("uniCenter",e,t),l.uniform2f("uniSymbolCorner",n/256,s/256),l.uniform2f("uniSymbolSize",r/256,i/256),u.bind(),c.drawArrays(c.TRIANGLE_STRIP,0,4),u.unbind()}}class i extends s.tbm{constructor(e,t,n){super(),this.context=e,this.textureRead=t,this.action=n;const r=new s.dLJ({varying:{varUV:"vec2"},attributes:{attPos:"vec2",attUV:"vec2"},mainCode:["varUV = attUV;","gl_Position = vec4(attPos, 0.0, 1.0);"]}).code,i=new s.NI6({varying:{varUV:"vec2"},uniforms:{uniTexture:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["float colorIndex = texture(uniTexture, varUV).r;","FragColor = vec4(colorIndex, 0.0, 0.0, 1.0);"]}).code,o=new s.a6X(e.gl,{vert:r,frag:i});this.prg=o;const a=new s.I9j({attPos:"vec2",attUV:"vec2"});a.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),a.set("attUV",new Float32Array([0,1,0,0,1,1,1,0]));const c=new s.ZV_(e.gl,o,[a]);this.vao=c}delete(){this.prg.delete(),this.vao.delete()}paint(){const{context:e,prg:t,vao:n,textureRead:s}=this,{gl:r}=e;t.use(),s.activate(0,t,"uniTexture"),n.bind(),r.drawArrays(r.TRIANGLE_STRIP,0,4),n.unbind(),this.action()}}class o extends s.tbm{constructor(e,t,n,r){super(),this.surface=new i(e,t,r),this.framebuffer=new s.K7(e,{textureColor0:n,children:[this.surface]})}delete(){this.surface.delete(),this.framebuffer.delete()}paint(e,t){this.framebuffer.paint(e,t)}}const a={replace:{blend:s.aMr.off},alpha:{blend:s.aMr.alpha},add:{blend:s.aMr.add}};class c{constructor(e){this.context=e,this.mode="alpha",this.action=l,this.currentFramebufferIndex=0,this.applyAction=()=>{this.action()};const t=new s.HTX(e),n=new s.HTX(e);this.textures=[t,n];for(const e of this.textures)e.setParams({magFilter:"NEAREST",minFilter:"NEAREST",wrapS:"REPEAT",wrapT:"REPEAT"});const r=this.applyAction;this.framebuffers=[new o(e,n,t,r),new o(e,t,n,r)]}get blend(){return a[this.mode]}get texture(){return this.textures[this.currentFramebufferIndex]}swap(){this.currentFramebufferIndex=1-this.currentFramebufferIndex}delete(){for(const e of this.textures)e.delete();for(const e of this.framebuffers)e.delete()}paint(e=l){this.swap(),this.action=e,this.framebuffers[this.currentFramebufferIndex].paint(0,0)}}const l=()=>{};class u{constructor(e,t){this.context=e,this.texturePalette=t,t.setParams({magFilter:"NEAREST",minFilter:"NEAREST"});const n=new s.dLJ({varying:{varUV:"vec2"},attributes:{attPos:"vec2",attUV:"vec2"},mainCode:["varUV = attUV;","gl_Position = vec4(attPos, 0.0, 1.0);"]}).code,r=new s.NI6({varying:{varUV:"vec2"},uniforms:{uniTexture:"sampler2D",uniPalette:"sampler2D"},outputs:{FragColor:"vec4"},mainCode:["vec4 texel = texture(uniTexture, varUV);","float colorIndex = texel.r;","if (colorIndex == 0.0) discard;","float u = colorIndex;","FragColor = texture(uniPalette, vec2(u, 0.5));","if (colorIndex == 0.0) FragColor.a = 0.0;"]}).code,i=new s.a6X(e.gl,{vert:n,frag:r});this.prg=i;const o=new s.I9j({attPos:"vec2",attUV:"vec2"});o.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1])),o.set("attUV",new Float32Array([0,0,0,1,1,0,1,1]));const a=new s.ZV_(e.gl,i,[o]);this.vao=a}delete(){this.prg.delete(),this.vao.delete()}paint(e){const{context:t,prg:n,vao:r,texturePalette:i}=this,{gl:o}=t;n.use(),e.texture.activate(0,n,"uniTexture"),i.activate(1,n,"uniPalette"),s.Ipk.do(Object.assign({gl:o},e.blend),(()=>{r.bind(),o.drawArrays(o.TRIANGLE_STRIP,0,4),r.unbind()}))}}class h{constructor(e){this.texture=e,this.canvas=document.createElement("canvas"),this.canvas.width=256,this.canvas.height=1;const t=this.canvas.getContext("2d");if(!t)throw new Error("Unable to get 2D context for palette canvas!");this.imageData=t.getImageData(0,0,256,1),this.reset()}set(e,t,n,s,r=15){const{data:i}=this.imageData;let o=4*e;i[o++]=17*t,i[o++]=17*n,i[o++]=17*s,i[o]=17*r}get(e){const{data:t}=this.imageData;let n=4*e;return[Math.round(t[n++]/17),Math.round(t[n++]/17),Math.round(t[n++]/17),Math.round(t[n]/17)]}updateCanvas(){const{canvas:e}=this,t=e.getContext("2d");if(!t)throw new Error("Unable to get 2D context for palette canvas!");t.putImageData(this.imageData,0,0);const[n,s,r,i]=this.get(0);document.body.style.setProperty("--custom-monitor-color",`rgba(${17*n}, ${17*s}, ${17*r}, ${i/15})`),this.texture.loadBitmap(e)}reset(){const{data:e}=this.imageData;for(let t=0;t<e.length;t++)e[t]=0;const t=15;this.set(0,0,0,8),this.set(1,0,0,0),this.set(2,0,0,t),this.set(3,8,0,0),this.set(4,8,0,8),this.set(5,8,0,t),this.set(6,t,0,0),this.set(7,t,0,8),this.set(8,t,0,t),this.set(9,0,8,0),this.set(10,0,8,8),this.set(11,0,8,t),this.set(12,8,8,0),this.set(13,8,8,8),this.set(14,8,8,t),this.set(15,t,8,0),this.set(16,t,8,8),this.set(17,t,8,t),this.set(18,0,t,0),this.set(19,0,t,8),this.set(20,0,t,t),this.set(21,8,t,0),this.set(22,8,t,8),this.set(23,8,t,t),this.set(24,t,t,0),this.set(25,t,t,8),this.set(26,t,t,t);let n=28;for(let e=1;e<8;e++)for(let t=1;t<27;t++){const[s,r,i]=this.get(t).map((t=>0===t?0:8===t?t-e:t-2*e));this.set(n++,s,r,i)}for(let e=0;e<16;e++)this.set(240+e,e,e,e);this.updateCanvas()}}var p=n(2197);function d(e,t,n){return s=>{try{return null==t||t(s),n(s)}catch(t){throw new Error(`Erreur de l'instruction "${e.toUpperCase()}": ${t}`)}}}var f=n(7882);function g(e=1,t=999){return n=>{if((n.length<e||n.length>t)&&e===t){if(0===e)throw new Error("Cette function n'attend aucun argument.");if(1===e)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${e} et ${t} arguments.`)}for(const e of n)if("number"!=typeof e)throw new Error(["Tous les arguments de cette fonction doivent √™tre des nombres.",`Mais on a re√ßu : (${n.map(y).join(", ")}).`].join("\n"))}}function m(e=1,t=999){return n=>{if((n.length<e||n.length>t)&&e===t){if(0===e)throw new Error("Cette function n'attend aucun argument.");if(1===e)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${e} et ${t} arguments.`)}for(const e of n)if("string"!=typeof e)throw new Error(["Tous les arguments de cette fonction doivent √™tre des textes.",`Mais on a re√ßu : (${n.map(y).join(", ")}).`].join("\n"))}}function E(e=0,t=999){return n=>{if((n.length<e||n.length>t)&&e===t){if(0===e)throw new Error("Cette function n'attend aucun argument.");if(1===e)throw new Error("Cette function attend un et un seul argument.");throw new Error(`Cette function attend entre ${e} et ${t} arguments.`)}}}function y(e){const t=(0,f.P)();if(Array.isArray(e))return t.typeArray;switch(typeof e){case"number":return t.typeNumber;case"string":return t.typeString;default:return t.typeUnknown}}const b=e=>d("cls",g(0,1),(([t])=>{e.paintFB((()=>{if((0,p.Et)(t))return void e.painterRect.paint(0,0,e.WIDTH,e.HEIGHT,(0,s.P_T)(Math.round(t),0,255),0);const{gl:n}=e;n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)})),e.x=e.TEXT_ORIGIN_X,e.y=e.TEXT_ORIGIN_Y,e.paint()})),v=e=>d("color",g(1,1),(([t])=>{e.colorIndex=t})),x=e=>d("disk",g(1,5),(([t,n,s,r,i])=>{e.paintFB((()=>{e.painterDisk.paint(e.screenSpaceX(e.x),e.screenSpaceY(e.y),e.screenSpaceX(t),e.screenSpaceY(null!=n?n:t),e.colorIndex,null!=s?s:0,null!=r?r:360,null!=i?i:0)}))})),I=e=>d("draw",E(1),(t=>{const n=t.map((e=>(0,p.Kg)(e)?e:JSON.stringify(e))).join(" "),s=function(e){const t=[];let n=0;const s=t=>{t.lastIndex=-1;const s=t.exec(e.slice(n));if(!s)return null;const[r]=s;return n+=r.length,r.trim()};for(;n<e.length;)if(s(w))t.push(["("]);else if(s(R))t.push([")"]);else{const r=s(C);if(!r)throw new Error(`Je m'attendais √† voir une commande ou une parenth√®se, mais pas "${e.slice(n,n+5)}..." :\n\n${A(e,n)}`);const i=[];for(;;){const e=s(S);if(!e)break;i.push(Number(e))}t.push([r,...i])}return t}(n.split(/[,; \n\r\t]+/).join(" ")),r=[];e.paintFB((()=>{for(const[t,...i]of s)switch(t){case"(":r.push([e.x,e.y]);break;case")":{const t=r.pop();if(!t)break;const[n,s]=t;e.x=n,e.y=s;break}case"M":{const[t,n]=i;e.x=t,e.y=n;break}case"m":{const[t,n]=i;e.x+=t,e.y+=n;break}case"C":{const[t]=i;e.colorIndex=null!=t?t:e.colorIndex;break}case"D":{const[t,n,s,r,o]=i;e.painterDisk.paint(e.screenSpaceX(e.x),e.screenSpaceY(e.y),e.screenSpaceX(t),e.screenSpaceY(null!=n?n:t),e.colorIndex,null!=s?s:0,null!=r?r:360,null!=o?o:0);break}case"R":{const[t,n,s]=i;e.painterRect.paint(e.screenSpaceX(e.x),e.screenSpaceY(e.y),t,null!=n?n:t,e.colorIndex,null!=s?s:0);break}default:{const e=n.indexOf(t);throw new Error(`Je ne reconnais pas la commande "${t}".\nN'oublie pas que la diff√©rence entre majuscules et minuscules est importante ici.\n${A(n,e)}`)}}}))}));function A(e,t){const n=Math.max(0,t-20),s=Math.min(e.length,t+20);return`${n>0?"...":"   "}${e.slice(n,s)}${s<e.length?"...":"   "}\n   ${" ".repeat(t-n)}^`}const S=/^[ \n\r\t]*^[-+]?([0-9]+(\.[0-9]+)?|\.[0-9]+)([Ee][+-]?[0-9]+)?[ \n\r\t,]*/g,C=/^[ \n\r\t]*[a-zA-Z]+[ \n\r\t]*/g,w=/^[ \n\r\t]*\([ \n\r\t]*/g,R=/^[ \n\r\t]*\)[ \n\r\t]*/g;var N=n(3185);const T=e=>d("EXIT",g(0,0),(()=>{e.paint(),N.E.stop()})),$=e=>d("INK",g(4,5),(([t,n,s,r,i])=>{e.palette.set(t,n,s,r,i),e.palette.updateCanvas(),e.paint()})),O=e=>d("label",E(1,2),(([t,n=1])=>{if(!(0,p.Et)(n))throw new Error("Si tu sp√©cifie un deuxi√®me argument pour LABEL(), il faut que ce soit un nombre.");const{x:s,y:r}=e,i=(0,p.Kg)(t)?t:JSON.stringify(t);let o=e.x-n*(i.length/2)*e.CHAR_SIZE;const a=e.y-n*e.CHAR_SIZE/2;for(const t of i.split(""))e.x=o+e.CHAR_SIZE/2,e.y=a+e.CHAR_SIZE/2,e.print(t,n),o+=e.CHAR_SIZE*n;e.x=s,e.y=r})),L=e=>d("layer",g(1,1),(([t])=>{e.currentLayerIndex=t})),k=e=>d("locate",g(2,2),(([t,n])=>{const r=(0,s.P_T)(Math.floor(t),0,e.TEXT_COLS-1),i=(0,s.P_T)(Math.floor(n),0,e.TEXT_ROWS-1);e.x=e.TEXT_ORIGIN_X+r*e.CHAR_SIZE,e.y=e.TEXT_ORIGIN_Y+i*e.CHAR_SIZE})),_=e=>d("MODE",m(1,1),(([t])=>{const n=["add","alpha","replace"];if(t=t.toLowerCase(),!n.includes(t))throw new Error([`Le mode "${t}" est inconnu.`,`Les modes disponibles sont : ${n.join(", ")}.`].join("\n"));e.layer.mode=t})),M=e=>d("move",g(2,2),(([t,n])=>{e.x=t,e.y=n})),P=e=>d("move",g(2,2),(([t,n])=>{e.x+=t,e.y+=n})),F=e=>d("pause",g(0,1),(([t])=>new Promise((n=>{const s=Math.max(0,(0,p.GB)(t,0));s>0?(e.paint(),globalThis.setTimeout(n,1e3*s)):globalThis.requestAnimationFrame((()=>{e.paint(),globalThis.setTimeout(n)}))})))),B=e=>d("PLAY",(e=>{if(e.length<1||e.length>2)throw new Error("Cette function attend entre 1 et 2 arguments.");const[t,n]=e;if(!(0,p.Xj)(t,["|","string",["array","string"]]))throw new Error("Le premier argument est la partition. J'attends un texte ou une liste de textes ici.");if(1!==e.length&&!(0,p.Et)(n))throw new Error("Le second argument est le tempo et il me faut un nombre ici.")}),(([t,n])=>{e.music.play(t,n)}));function H(e,t){const n=t.map((e=>(0,p.Kg)(e)?e:JSON.stringify(e))).join("");e.print(n)}const D=e=>d("print",E(),(t=>{H(e,t)})),V=e=>d("println",E(),(t=>{H(e,t),e.x=e.TEXT_ORIGIN_X,e.y+=e.CHAR_SIZE})),U=e=>d("rect",g(1,3),(([t,n,s])=>{e.paintFB((()=>{e.painterRect.paint(e.screenSpaceX(e.x),e.screenSpaceY(e.y),t,null!=n?n:t,e.colorIndex,null!=s?s:0)}))})),X=e=>d("reset",g(0,0),(()=>{e.reset()})),j=e=>d("sound",g(1,2),(([t,n=.1])=>{e.sound(t,n,"sine")})),J=e=>d("STOP",m(0,0),(([t])=>{e.music.stop()}));function K(e,t,n){return s=>{try{return null==t||t(s),n(s)}catch(t){throw new Error(`Erreur de la fonction "${e.toUpperCase()}": ${t}`)}}}var G=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const Y=e=>K("ASK",E(0),(t=>G(void 0,void 0,void 0,(function*(){return yield q(t,e)})))),z=e=>K("ASK",E(0),(t=>G(void 0,void 0,void 0,(function*(){return Z(yield q(t,e))})))),W=e=>K("ASK",E(0),(t=>G(void 0,void 0,void 0,(function*(){return Math.round(Z(yield q(t,e)))}))));function Z(e){const t=parseFloat(e);return Number.isNaN(t)?0:t}function q(e,t){return new Promise((n=>{const s=e.map((e=>(0,p.Kg)(e)?e:JSON.stringify(e))).join("");t.print(s),t.paint();let r=!0;const i=()=>{t.printChar(143),t.paint()},o=()=>{const e=t.colorIndex;t.colorIndex=0,t.printChar(143),t.colorIndex=e,t.paint()},a=globalThis.setInterval((()=>{r?i():o(),r=!r}),500);let c="";i();const l=e=>{if(!(e.ctrlKey||e.altKey||e.metaKey))try{const{key:s}=e;if(1===s.length)return c+=s,o(),void t.print(s);if("Enter"===s)return globalThis.document.removeEventListener("keydown",l),o(),t.x=t.TEXT_ORIGIN_X,t.y+=t.CHAR_SIZE,globalThis.clearInterval(a),void n(c)}finally{t.paint()}};globalThis.document.addEventListener("keydown",l)}))}function Q(e){return t=>{if(t.length<2||t.length>3)throw new Error(`Cette fonction attends deux ou trois arguments : ${e}($texte, $taille) ou ${e}($texte, $taille, $remplissage).`);const[,n,s]=t;if(!(0,p.Et)(n))throw new Error(`La taille doit √™tre un nombre :  ${e}($texte, $taille).`);if(void 0!==s&&!(0,p.Kg)(s))throw new Error(`Le remplissage doit √™tre une cha√Æne :  ${e}($texte, $taille, remplissage).`)}}function ee(e){return(0,p.Kg)(e)?e:(0,p.Et)(e)&&Math.abs(e)<1e-9?"0":JSON.stringify(e)}const te=e=>K("INK",g(1,1),(([t])=>{const n=(0,s.P_T)(Math.round(t),0,255);return e.palette.get(n)})),ne=e=>K("MOUSEX",g(0,0),(()=>e.mouseX)),se=e=>K("MOUSEY",g(0,0),(()=>e.mouseY)),re=e=>K("PLAY",(e=>{if(e.length<1||e.length>2)throw new Error("Cette function attend entre 1 et 2 arguments.");const[t,n]=e;if(!(0,p.Xj)(t,["|","string",["array","string"]]))throw new Error("Le premier argument est la partition. J'attends un texte ou une liste de textes ici.");if(1!==e.length&&!(0,p.Et)(n))throw new Error("Le second argument est le tempo et il me faut un nombre ici.")}),(([t,n])=>e.music.play(t,n))),ie=Math.PI/180;class oe{constructor(e){this.context=e,this.STEPS=128;const t=new s.dLJ({uniforms:{uniStartAngle:"float",uniCenter:"vec2",uniRadius:"vec2",uniRotation:"mat2",uniStepsInRadians:"float"},mainCode:["if (gl_VertexID == 0) gl_Position = vec4(uniCenter, 0.0, 1.0);","else {","  float angle = uniStepsInRadians * float(gl_VertexID) + uniStartAngle;","  vec2 pos = vec2(","    cos(angle), sin(angle)","  ) * uniRadius;","  gl_Position = vec4(uniCenter + uniRotation * pos, 0.0, 1.0);","}"]}).code,n=new s.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,r=new s.a6X(e.gl,{vert:t,frag:n});this.prg=r}delete(){this.prg.delete()}paint(e,t,n,r,i,o,a,c){const{context:l,prg:u}=this,{gl:h}=l,p=(0,s.HPH)(o),d=Math.cos(p),f=Math.sin(p),g=new s.MRb(d,f,-f,d),m=2*Math.max(320*Math.abs(n),240*Math.abs(r));u.use(),u.uniform1f("uniStartAngle",(0,s.HPH)(c)),u.uniform2f("uniCenter",e,t),u.uniform2f("uniRadius",n,r),u.uniform1f("uniStepsInRadians",2*Math.PI/m),u.uniformMatrix2fv("uniRotation",g),u.uniform1f("uniColor",i/255);const E=a/360;h.drawArrays(h.TRIANGLE_FAN,0,1+Math.round((m+1)*E))}}class ae{constructor(e){this.context=e;const t=new s.dLJ({uniforms:{uniCenter:"vec2",uniRadius:"vec2",uniRotation:"mat2",uniScreenSize:"vec2"},attributes:{attPos:"vec2"},mainCode:["vec2 pos = (uniRotation * (attPos * uniRadius)) * uniScreenSize;","gl_Position = vec4(uniCenter + pos, 0.0, 1.0);"]}).code,n=new s.NI6({uniforms:{uniColor:"float"},outputs:{FragColor:"vec4"},mainCode:["FragColor = vec4(uniColor, 0.0, 0.0, 1.0);"]}).code,r=new s.a6X(e.gl,{vert:t,frag:n});this.prg=r;const i=new s.I9j({attPos:"vec2"});i.set("attPos",new Float32Array([-1,1,-1,-1,1,1,1,-1]));const o=new s.ZV_(e.gl,r,[i]);this.vao=o}delete(){this.prg.delete(),this.vao.delete()}paint(e,t,n,r,i,o){const{context:a,prg:c,vao:l}=this,{gl:u}=a;c.use();const h=(0,s.HPH)(o),p=Math.cos(h),d=Math.sin(h),f=new s.MRb(p,d,-d,p);console.log("üöÄ [rect] centerX, centerY, width, height =",e,t,n,r),c.uniformMatrix2fv("uniRotation",f),c.uniform2f("uniCenter",e,t),c.uniform2f("uniRadius",n/2,r/2),c.uniform2f("uniScreenSize",2/a.width,2/a.height),c.uniform1f("uniColor",i/255),l.bind(),u.drawArrays(u.TRIANGLE_STRIP,0,4),l.unbind()}}class ce{constructor(){this.frequencies={},this.notes=[],this.indexes=[],this.playing=!1,this.next=e=>{var t;if(!window.AudioContext||!this.playing||!N.E.state.running.value)return;const n=this.notes[e],s=n[this.indexes[e]%n.length];if(!s)return;this.indexes[e]++;const r=s.duration;setTimeout((()=>this.next(e)),1e3*r);const i=Math.min(.1,r/10),o=new window.AudioContext,a=o.createOscillator(),c=o.createGain();a.type="sine",a.frequency.setValueAtTime(null!==(t=this.frequencies[s.note])&&void 0!==t?t:0,o.currentTime),a.connect(c),c.connect(o.destination),c.gain.exponentialRampToValueAtTime(1e-6,o.currentTime),c.gain.exponentialRampToValueAtTime(s.volume,o.currentTime+i),c.gain.exponentialRampToValueAtTime(s.volume,o.currentTime+r-i),c.gain.exponentialRampToValueAtTime(1e-6,o.currentTime+r),a.start(),a.stop(o.currentTime+r)};for(let e=0;e<10;e++)for(const t of Object.keys(de)){const n=de[t],s=`${t}${e}`;this.frequencies[s]=n*Math.pow(2,e-5)}}play(e,t=120){const n=Array.isArray(e)?e:[e];let s=0;this.notes=[],this.indexes=[];for(const e of n){const n=le(e,t);this.notes.push(n),this.playing=!0,this.indexes.push(0),s=Math.max(s,n.reduce(((e,t)=>e+t.duration),0))}for(let e=0;e<this.indexes.length;e++)setTimeout((()=>this.next(e)));return s}stop(){this.playing=!1}}function le(e,t){const n=[],s=240/t;let r=s/4,i=0,o=.5;for(;i<e.length;){pe.lastIndex=-1;const t=pe.exec(e.slice(i));if(t){o=Number(t[0].slice(1))/10,i+=t[0].length;continue}he.lastIndex=-1;const a=he.exec(e.slice(i));if(a){r=s/Number(a[0].slice(1)),i+=a[0].length;continue}ue.lastIndex=-1;const c=ue.exec(e.slice(i));c?(i+=c[0].length,n.push({note:c[0],volume:o,duration:r})):i++}return n}const ue=/^(-|[A-G][b#]?[0-9])/g,he=/^:[1-9][0-9]*/g,pe=/^@[1-9]/g,de={Cb:493.88,C:523.25,"C#":554.37,Db:554.37,D:587.33,"D#":622.25,Eb:622.25,E:659.26,"E#":698.46,Fb:659.26,F:698.46,"F#":739.99,Gb:739.99,G:783.99,"G#":830.61,Ab:830.6,A:880,"A#":932.32,Bb:932.32,B:987.76,"B#":1046.5};var fe=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};const ge=()=>{};class me extends s.tbm{constructor(e,t){super(),this.canvas=e,this.id="Kernel#"+me.ID++,this.LAYERS_COUNT=3,this.WIDTH=640,this.HEIGHT=480,this.CHAR_SIZE=16,this.TEXT_COLS=Math.floor(this.WIDTH/this.CHAR_SIZE),this.TEXT_ROWS=Math.floor(this.HEIGHT/this.CHAR_SIZE),this.TEXT_ORIGIN_X=(this.CHAR_SIZE-this.WIDTH)/2,this.TEXT_ORIGIN_Y=(this.CHAR_SIZE-this.HEIGHT)/2,this.music=new ce,this.x=(this.CHAR_SIZE-this.WIDTH)/2,this.y=(this.CHAR_SIZE-this.HEIGHT)/2,this.colorIndex=24,this.variablesStack=[new Map],this.subroutineCleanupFunctions=[],this.layers=[],this._currentLayerindex=1,this._mouseX=0,this._mouseY=0,this.handleMouseMove=e=>{this._mouseX=e.current.x*this.WIDTH/2,this._mouseY=-e.current.y*this.HEIGHT/2},e.width=this.WIDTH,e.height=this.HEIGHT,e.style.aspectRatio=`${this.WIDTH}/${this.HEIGHT}`;const n=new s.tfp(e,{alpha:!0,antialias:!1,preserveDrawingBuffer:!0,onResize(e,t,n){}});this.context=n,this.painterDisk=new oe(n),this.painterRect=new ae(n),this.texturePalette=new s.HTX(n),this.palette=new h(this.texturePalette),this.colorizer=new u(n,this.texturePalette),this.textureSymbols=new s.HTX(n).setParams({magFilter:"LINEAR",minFilter:"LINEAR",wrapS:"MIRRORED_REPEAT",wrapT:"MIRRORED_REPEAT"}).loadBitmap(t);for(let e=0;e<this.LAYERS_COUNT;e++)this.layers.push(new c(n));var i;n.add(this),n.paint(),this.painterSymbols=new r(n.gl,{symbols:this.textureSymbols,screenWidth:this.WIDTH,screenHeight:this.HEIGHT}),this.procedures={CLS:b(i=this),COLOR:v(i),DISK:x(i),DRAW:I(i),EXIT:T(i),INK:$(i),LABEL:O(i),LAYER:L(i),LOCATE:k(i),MODE:_(i),MOVE:M(i),MOVER:P(i),PAUSE:F(i),PLAY:B(i),PRINT:D(i),PRINTLN:V(i),RECT:U(i),RESET:X(i),SOUND:j(i),STOP:J(i)},this.functions=(e=>({ABS:K("ABS",g(1,1),(([e])=>Math.abs(e))),ASC:K("ASC",m(1,1),(([e])=>e.charCodeAt(0))),ASK:Y(e),ASKINT:W(e),ASKNUM:z(e),CHR:K("CHR",g(1),(e=>e.map((e=>String.fromCharCode(e))).join(""))),CLAMP:K("CLAMP",g(3,3),(([e,t,n])=>(0,s.O6b)(e,t,n))),COLOR:K("COLOR",g(0,0),(()=>e.colorIndex)),COS:K("COS",g(1,1),(([e])=>Math.cos(e*ie))),HEX:K("HEX",g(1,1),(([e])=>e.toString(16).toUpperCase())),HOUR:K("HOUR",E(0,0),(()=>(new Date).getHours())),INK:te(e),INT:K("INT",E(1,1),(([e])=>Array.isArray(e)?e.length:Math.round(Number(e)))),LAYER:K("LAYER",g(0,0),(()=>e.currentLayerIndex)),LEN:K("LEN",E(1,1),(e=>{let[t]=e;return(0,p.Et)(t)?0===t?1:Math.max(0,Math.ceil(Math.log10(Math.abs(t)+1e-14))):t.length})),LIST:K("LIST",(e=>{const[t]=e;if(2!==e.length||"number"!=typeof t)throw new Error("Cette fonction attends deux arguments: le nombre d'√©l√©ments et la valeur initiale de ces √©l√©ments.")}),(([e,t])=>new Array(e).fill(t))),LOWERCASE:K("LOWERCASE",m(1),(e=>e.join("").toLowerCase())),MIN:K("MIN",g(1),(([e,...t])=>t.reduce(((e,t)=>Math.min(e,t)),e))),MINUTE:K("MINUTE",E(0,0),(()=>(new Date).getMinutes())),MAX:K("MAX",g(1),(([e,...t])=>t.reduce(((e,t)=>Math.max(e,t)),e))),MODE:K("MODE",g(0,0),(()=>e.layer.mode)),MOUSEX:ne(e),MOUSEY:se(e),NOT:K("NOT",g(1,1),(([e])=>0===e?1:0)),PADL:K("PADL",Q("PADL"),(e=>{const[t,n,s=" "]=e;return ee(t).slice(0,n).padEnd(n,s.charAt(0))})),PADR:K("PADR",Q("PADR"),(e=>{const[t,n,s=" "]=e;return ee(t).slice(0,n).padStart(n,s.charAt(0))})),PLAY:re(e),RANDOM:K("RANDOM",g(0,2),(e=>{if(0===e.length)return Math.random();const[t,n]=e;return(0,p.Et)(n)?t===n?t:Math.min(t,n)+Math.floor(Math.random()*(Math.abs(n-t)+1)):Math.floor(Math.random()*t)})),RANDOMF:K("RANDOMF",g(0,2),(e=>{if(0===e.length)return Math.random();const[t,n]=e;return(0,p.Et)(n)?t===n?t:Math.min(t,n)+Math.random()*(Math.abs(n-t)+1):Math.random()*t})),RANGE:K("RANGE",g(1,3),(e=>{let[t,n,s]=e;(0,p.Et)(n)||(n=t-1,t=0),s=(0,p.Et)(s)?Math.abs(s):1;const r=Math.floor(Math.abs(n-t)/s)+1;if(1===r)return[t];const i=t<n?s:-s,o=[];for(let e=0;e<r;e++)o.push(t+i*e);return o})),SECOND:K("SECOND",E(0,0),(()=>(new Date).getSeconds())),SIN:K("SIN",g(1,1),(([e])=>Math.sin(e*ie))),TIME:K("TIME",g(0,0),(()=>Date.now())),UPPERCASE:K("UPPERCASE",m(1),(e=>e.join("").toUpperCase()))}))(this),this.reset(),n.inputs.pointer.eventMove.addListener(this.handleMouseMove)}get mouseX(){return this._mouseX}get mouseY(){return this._mouseY}get allVarNames(){return Array.from(this.variables.keys())}get proceduresNames(){return Object.keys(this.procedures).sort()}get functionsNames(){return Object.keys(this.functions).sort()}hasFunction(e){return void 0!==this.functions[e.trim().toUpperCase()]}reset(){return fe(this,void 0,void 0,(function*(){this.music.stop(),this.variables.clear(),this.palette.reset(),this.colorIndex=24;for(let e=0;e<this.LAYERS_COUNT;e++)this.paintFB((()=>{const{gl:t}=this;this.currentLayerIndex=e,t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}));this.currentLayerIndex=0,this.x=this.TEXT_ORIGIN_X,this.y=this.TEXT_ORIGIN_Y,this.paint()}))}fullscreenRequest(){const{canvas:e}=this;(0,s.iJ5)(e.parentElement)}fullscreenExit(){(0,s.jtz)()}sound(e,t,n="sine"){if(!globalThis.AudioContext)return;const s=new globalThis.AudioContext,r=s.createOscillator(),i=s.createGain();i.connect(s.destination),r.connect(i),r.type=n,r.frequency.value=e,i.gain.exponentialRampToValueAtTime(1e-5,s.currentTime+t),r.start(),r.stop(s.currentTime+t)}get gl(){return this.context.gl}screenSpaceX(e){return 2*e/this.WIDTH}screenSpaceY(e){return 2*e/this.HEIGHT}executeProcedure(e,t){return fe(this,void 0,void 0,(function*(){try{const n=this.procedures[e];return!!n&&(yield n(t),!0)}catch(t){const n=t instanceof Error?t.message:JSON.stringify(t);throw new Error(`Erreur de l'instruction ${e.toUpperCase()} :\n${n}`)}}))}executeFunction(e,t){try{const n=this.functions[e];if(!n)throw new Error(`La fonction "${e.toUpperCase()}" n'existe pas.\nLes fonctions disponibles sont: ${Object.keys(this.functions).sort().join(", ")}.`);return n(t)}catch(t){const n=t instanceof Error?t.message:JSON.stringify(t);throw new Error(`Erreur de la fonction ${e.toUpperCase()} :\n${n}`)}}get currentLayerIndex(){return this._currentLayerindex}set currentLayerIndex(e){e=(0,s.P_T)(Math.round(e),0,this.LAYERS_COUNT-1),this._currentLayerindex=e}get layer(){return this.layers[this.currentLayerIndex]}delete(){for(const e of this.layers)e.delete();this.painterDisk.delete(),this.painterSymbols.delete(),this.textureSymbols.delete(),this.music.stop()}paint(){try{const{context:e,colorizer:t}=this,{gl:n}=e;n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT);for(const e of this.layers)t.paint(e)}catch(e){console.error("Error while painting:",e)}}paintFB(e=ge){this.layer.paint(e)}print(e,t=1){this.paintFB((()=>{for(const n of e.split("")){const e=255&n.charCodeAt(0),s=15&e,r=e-s>>4;this.painterSymbols.paint({screenX:this.x,screenY:this.y,symbolX:s*this.CHAR_SIZE,symbolY:r*this.CHAR_SIZE,colorIndex:this.colorIndex,scale:t}),this.x+=this.CHAR_SIZE*t,this.x>=this.WIDTH/2&&(this.x=this.TEXT_ORIGIN_X,this.y+=this.CHAR_SIZE*t)}}))}printChar(e,t=1){this.paintFB((()=>{const n=255&e,s=15&n,r=n-s>>4;this.painterSymbols.paint({screenX:this.x,screenY:this.y,symbolX:s*this.CHAR_SIZE,symbolY:r*this.CHAR_SIZE,colorIndex:this.colorIndex,scale:t})}))}getVar(e){var t;const n="@"===e.trim().charAt(0)?this.globalVariables:this.variables;if(e=Ee(e),!n.has(e)){const t=[`La variable $${e.toLocaleLowerCase()} n'existe pas.`],s=Array.from(n.keys()).map((e=>`$${e.toLocaleLowerCase()}`));throw 0===s.length?t.push("Aucune variable n'a encore √©t√© cr√©√©e."):1===s.length?t.push(`La seule variable existante maintenant est ${s[0]}.`):t.push(`Les variables disponibles sont : ${s.join("\n")}`),this.variables!==this.globalVariables&&t.push("N'oublie pas que les fonctions ont leurs propres variables."),this.globalVariables.has(e)&&t.push(`Si tu veux lire la variable globale $${e.toLowerCase()},`,`tu peux utiliser la syntaxe @${e.toLowerCase()}.`),new Error(t.join("\n"))}return null!==(t=n.get(e))&&void 0!==t?t:0}setVar(e,t){this.variables.set(Ee(e),t)}debugVariables(){for(const e of this.variables.keys())console.log(e,"=",this.getVar(e))}subroutineEnter(e,t,n){var s;this.subroutineCleanupFunctions.push(n);const r=new Map;this.variablesStack.push(r);for(let n=0;n<e.length;n++)this.setVar(e[n],null!==(s=t[n])&&void 0!==s?s:0)}subroutineExit(){this.variablesStack.pop();const e=this.subroutineCleanupFunctions.pop();null==e||e()}test(){this.paintFB((()=>{this.painterSymbols.paint({colorIndex:4,screenX:0,screenY:0,symbolX:0,symbolY:0,width:512,height:512})}))}get variables(){const e=this.variablesStack.at(-1);if(!e)throw Error("Nothing left on the variables stack!");return e}get globalVariables(){return this.variablesStack[0]}}function Ee(e){return(e.startsWith("$")||e.startsWith("@")?e.slice(1):e).toUpperCase()}me.ID=0},5146:(e,t,n)=>{n.d(t,{F:()=>i});const s={SPC:/^[ \t]+/g,COM:/^(REM )[^\n\r]*[\n\r]+/gi,EOL:/^[\n\r]+/g,VAR:/^\$[a-z0-9_]+/gi,GLOBAL_VAR:/^@[a-z0-9_]+/gi,DESTRUCT:/^\$\[\s*[a-z0-9_]+\s*(,\s*[a-z0-9_]+\s*)*\]/gi,HEX:/^#[0-9a-f]+/gi,NUM:/^([0-9]+(\.[0-9]+)?|\.[0-9]+)([Ee][+-]?[0-9]+)?/g,STR:/^"(\\"|[^"])*"/g,SIGN:/^[+-]/gi,BINOP:/^(and|or|xor|>=|<=|<>|\^|==|[%*/<>])/gi,EQUAL:/^=/g,PAR_OPEN:/^\(/g,PAR_CLOSE:/^\)/g,BRA_OPEN:/^\{/g,BRA_CLOSE:/^\}/g,SQR_OPEN:/^\[/g,SQR_CLOSE:/^\]/g,COMMA:/^,/g,DEF:/^def(?![a-z0-9])/i,RETURN:/^return(?![a-z0-9])/i,WHILE:/^while(?![a-z0-9])/i,FOR:/^for(?![a-z0-9])/i,IN:/^in(?![a-z0-9])/i,IF:/^if(?![a-z0-9])/i,ELSE:/^else(?![a-z0-9])/i,FUNC:/^[a-z_][a-z_0-9]*\(/i,INST:/^[a-z_][a-z_0-9]*/gi,EOF:/^<<EOF>>/},r=["SPC","COM","EOL"];class i{constructor(e){this._code=e,this._cursor=0,this._token={id:"EOF",val:"",pos:1e100}}get token(){return this._token}get tokenID(){return this.token.id}get tokenCode(){return this._code.slice(this.token.pos)}all(){const e=this._cursor,t=[];for(this._cursor=0;this.hasMoreCode();)this.next(),t.push(structuredClone(this._token));return this._cursor=e,t}highlight(){const e=[];let t=0;for(;t<this._code.length;){const n=this._code.slice(t);let r=null;for(const[e,i]of Object.entries(s)){i.lastIndex=-1;const s=i.exec(n);if(s){r={id:e,val:s[0],pos:t};break}}if(r){t+=r.val.length;let n=r.val.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");switch(r.id){case"VAR":n=n.toLowerCase();break;case"COM":n=n.slice(0,3).toUpperCase()+n.slice(3);break;case"HEX":case"FUNC":case"DEF":case"RETURN":case"FOR":case"IN":case"IF":case"ELSE":case"WHILE":n=n.toUpperCase()}e.push(`<span class="Basik-${r.id}">${n}</span>`)}else t+=1,e.push(n.charAt(0))}return e.join("")}hasMoreCode(){return this._cursor<this._code.length-1}fatal(e,t){var n,s={pos:null!==(n=null==t?void 0:t.pos)&&void 0!==n?n:this._cursor,code:this._code,msg:e};throw console.error(s,null!=t?t:this.token),s}next(){let e=this._code.slice(this._cursor);if(0===e.trimEnd().length)return this._token={id:"EOF",pos:this._cursor,val:""},void(this._cursor+=e.length+1);for(;;){let t=null;for(const n of Object.keys(s)){const r=n,i=s[r];if(!i)continue;i.lastIndex=0;const o=i.exec(e);if(o){t={id:r,val:o[0],pos:this._cursor};break}}if(t||this.fatal(`Je suis tomb√© sur un caract√®re qui n'a rien √† faire l√† : "${e.charAt(0)}".`),this._cursor+=t.val.length,!r.includes(t.id))return void(this._token=t);e=this._code.slice(this._cursor)}}is(...e){return e.includes(this._token.id)}get(...e){if(!e.includes(this._token.id))return;const t=structuredClone(this._token);return this.next(),t}expect(e,t){(Array.isArray(e)?e:[e]).includes(this._token.id)||this.fatal(t);const n=structuredClone(this._token);return this.next(),n}}},6190:(e,t,n)=>{n.d(t,{R:()=>M});var s=n(5146),r=n(2197);function i(e){return(0,r.Xj)(e,{pos:"number",code:"string",msg:"string"})}function o(e,t){const n=[e,t.msg,""];console.log(`%c${t.msg}`,"background: #f00;color: #fff");const s=[];let r=0,i=0,o=1;const a=`${t.code}\n\n`;for(;i<a.length;)if("\n"===a.charAt(i++)){const e=a.slice(r,i).trimEnd();if(s.push([o++,e]),i>t.pos){for(const[e,t]of s.slice(-5))n.push(`${`${e}`.padStart(6," ")}:  ${t}`),console.log(`%c${`${e}`.padStart(6," ")}:  ${t}`,"font-family:monospace");throw console.log(`%c${" ".repeat(9+t.pos-r)}^`,"font-family:monospace"),n.push(`${" ".repeat(9+t.pos-r)}^`),new Error(n.join("\n"))}r=i}throw new Error(n.join("\n"))}const a={"==":(e,t)=>JSON.stringify(e)===JSON.stringify(t)?1:0,"<>":(e,t)=>JSON.stringify(e)!==JSON.stringify(t)?1:0,">":(e,t)=>(0,r.Et)(e)&&(0,r.Et)(t)?e>t?1:0:JSON.stringify(e)>JSON.stringify(t)?1:0,"<":(e,t)=>(0,r.Et)(e)&&(0,r.Et)(t)?e<t?1:0:JSON.stringify(e)<JSON.stringify(t)?1:0,">=":(e,t)=>(0,r.Et)(e)&&(0,r.Et)(t)?e>=t?1:0:JSON.stringify(e)>=JSON.stringify(t)?1:0,"<=":(e,t)=>(0,r.Et)(e)&&(0,r.Et)(t)?e<=t?1:0:JSON.stringify(e)<=JSON.stringify(t)?1:0,"+":(e,t)=>(0,r.Et)(e)&&(0,r.Et)(t)?e+t:Array.isArray(e)?Array.isArray(t)?[...e,...t]:[...e,t]:Array.isArray(t)?Array.isArray(e)?[...e,...t]:[e,...t]:`${e}${t}`,"-":c("-",((e,t)=>e-t)),"/":c("/",((e,t)=>e/t)),"^":c("^",((e,t)=>Math.pow(e,t))),"%":c("^",((e,t)=>e%t)),AND:c("^",((e,t)=>e&t)),OR:c("^",((e,t)=>e|t)),XOR:c("^",((e,t)=>e^t)),"*":(e,t)=>{if((0,r.Et)(e)&&(0,r.Et)(t))return e*t;if(Array.isArray(e)||Array.isArray(t))throw new Error("Il est impossible de multiplier des listes !");if((0,r.Kg)(e)&&(0,r.Kg)(t))throw new Error("Il est impossible de multiplier deux cha√Ænes de caract√®res !");let n=(0,r.Kg)(e)?e:t,s=(0,r.Kg)(t)?e:t;if(0===s)return"";s<0&&(s=-s,n=n.split("").reverse().join(""));const i=Math.floor(s),o=s-i;return`${n.repeat(i)}${n.slice(0,Math.round(o*n.length))}`}};function c(e,t){return(n,s)=>{if(!(0,r.Et)(n)||!(0,r.Et)(s))throw new Error(`L'op√©rateur "${e}" ne fonctionne qu'avec des nombres.`);return t(n,s)}}class l{constructor(){this.counter=0,this.labels=new Map,this.links=[]}reset(){this.labels.clear(),this.links.splice(0,this.links.length),this.counter=0}create(e=""){return`:${this.counter++}:${e}`}stick(e,t){this.labels.set(e,t)}link(e,t){this.links.push({cursor:e,label:t})}apply(e){for(const{cursor:t,label:n}of this.links){const s=this.labels.get(n);if(void 0===s)throw Error(`Label not found: ${n}`);e[t].val=s}}getLabelAtCursor(e){for(const[t,n]of this.labels.entries())if(n===e)return t;return""}getLinkAtCursor(e){for(const{label:t,cursor:n}of this.links)if(n===e)return t;return null}getLabelsMaxLength(){let e=0;for(const t of this.labels.keys())e=Math.max(e,t.length);return e}}var u=n(3185);function h(){const e=this.lexer.get("RETURN");return!!e&&(this.parseExpression()||this.lexer.fatal("Il faut une expression apr√®s un RETURN.",e),this.pushBytecode(this.$return),!0)}function p(){const{lexer:e}=this,t=e.get("FUNC");if(!t)return!1;const n=t.val.slice(0,-1).trim().toUpperCase();let s=0;for(;this.parseExpression()&&(s++,e.get("COMMA")););return e.expect("PAR_CLOSE",`Il manque une parenth√®se fermante apr√®s les arguments de la proc√©dure "${n}".`),this.pushBytecode(s,this.$makeArray,n),this.pushFunction(this.$procedure,t),!0}function d(){const e=[this.parseInstruction,this.parseAffectation,this.parseIf,this.parseForIn,this.parseWhile,this.parseReturn,this.parseDef];if(!this.parseAny(...e))return!1;for(;this.parseAny(...e););return!0}function f(){const{lexer:e}=this;if(!e.get("IF"))return!1;this.parseExpression()||this.fatal("Apr√®s un IF il faut une expression.");const t=this.labelCreate("Else"),n=this.labelCreate("EndIf");return this.labelPushItsValue(t),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour d√©finir un bloc, comme dans cet exemple :","IF $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.pushBytecode(this.$if),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante √† la fin d'un bloc, comme dans cet exemple :","IF $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.pushJump(n),this.labelStickHere(t),e.get("ELSE")&&(e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour d√©finir un bloc, comme dans cet exemple :","ELSE {",'  PRINTLN("Perdu")',"}"].join("\n")),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante √† la fin d'un bloc, comme dans cet exemple :","ELSE {",'  PRINTLN("Perdu")',"}"].join("\n"))),this.labelStickHere(n),!0}function g(){const{lexer:e}=this;if(!e.get("WHILE"))return!1;const t=this.labelCreate("Begin"),n=this.labelCreate("End");return this.labelStickHere(t),this.parseExpression()||this.fatal("Apr√®s un WHILE il faut une expression."),this.pushJumpIfZero(n),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour d√©finir un bloc, comme dans cet exemple :","WHILE $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante √† la fin d'un bloc, comme dans cet exemple :","WHILE $condition {",'  PRINTLN("Perdu")',"}"].join("\n")),this.pushJump(t),this.labelStickHere(n),!0}function m(){const{lexer:e}=this;if(!e.get("FOR"))return!1;const t=e.expect("VAR","Il me faut un nom de variable apr√®s le mot clef FOR.");this.pushBytecode(t.val),e.expect("IN","Apr√®s le nom de variable, il faut le mot clef IN.\nExemple: FOR $i IN $notes"),this.parseExpression()||this.fatal("Je m'attendais √† une expression apr√®s un FOR ... IN."),this.pushBytecode(0);const n=this.labelCreate(),s=this.labelCreate();return this.labelPushItsValue(s),this.labelStickHere(n),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour d√©finir un bloc, comme dans cet exemple :","FOR $i IN RANGE(9) {","  PRINTLN($i)","}"].join("\n")),this.pushBytecode(this.$forIn),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante √† la fin d'un bloc, comme dans cet exemple :","FOR $i IN RANGE(9) {","  PRINTLN($i)","}"].join("\n")),this.pushJump(n),this.labelStickHere(s),!0}function E(){var e;const t=null!==(e=this.lexer.get("VAR"))&&void 0!==e?e:this.lexer.get("GLOBAL_VAR");if(t){const e=t.val;this.pushBytecode(e);const n=this.parseSlicerArguments();return this.lexer.expect("EQUAL",`Je m'attendais √† voir le signe "=" pour l'affectation de la variable ${e} !`),"GLOBAL_VAR"===t.id&&this.lexer.fatal(["Il est interdit d'assigner des valeurs √† une variable globale.","Est-ce que tu voulais √©crire",`$${e.slice(1)} = ... ?`].join("\n"),t),this.parseExpression(),this.pushBytecode(n?this.$setElem:this.$setVar),!0}const n=this.lexer.get("DESTRUCT");if(!n)return!1;const s=n.val.trim().slice(2,-1).split(",").map((e=>`$${e.trim().toLowerCase()}`));return this.pushBytecode(s),this.lexer.expect("EQUAL",`Je m'attendais √† voir le signe "=" pour l'affectation des variables ${s.join(", ")}.`),this.parseExpression(),this.pushBytecode(this.$setVars),!0}function y(){var e;const t=this.lexer.get("SIGN");if(this.parseAny(this.parseNumber,this.parseVar,this.parseHexa,this.parseString,this.parseExpressionBlock,this.parseFunction,this.parseList)){for("-"===(null!==(e=null==t?void 0:t.val)&&void 0!==e?e:"+")&&this.pushFunction(this.$neg,t);this.parseSlicer(););for(;this.parseBinaryOperator(););return!0}return!1}function b(){const{lexer:e}=this,t=e.get("FUNC");if(!t)return!1;const n=t.val.slice(0,-1).trim().toUpperCase();let s=0;for(;this.parseExpression()&&(s++,e.get("COMMA")););return e.expect("PAR_CLOSE",`Il manque une parenth√®se fermante apr√®s les arguments de la fonction "${n}".`),this.pushBytecode(s,this.$makeArray,n),this.pushFunction(this.$function,t),!0}function v(){const{lexer:e}=this;return!!e.get("PAR_OPEN")&&(this.parseExpression()||e.fatal("Il manque une expression apr√®s la parenth√®se ouvrante."),e.expect("PAR_CLOSE","Il manque une parenth√®se fermante ici."),!0)}function x(){const{lexer:e}=this,t=e.get("BINOP","SIGN");if(!t)return!1;const n=t.val;return this.parseExpression()||e.fatal(`Je m'attendais √† une expression apr√®s l'op√©rateur "${e.token.val}" !`),this.pushBytecode(this.makeBinOp(n)),!0}function I(){const{lexer:e}=this;if(!e.get("DEF"))return!1;const t=this.labelCreate("BeginFunc"),n=this.labelCreate("EndFunc"),s=e.get("FUNC");if(!s)return e.fatal("Apr√®s DEF il faut mettre un nom de fonction avec ses arguments.\nPar exemple :\nDEF FACTORIELLE($nombre) ...\nDEF COMMENCER()"),!1;const r=s.val.slice(0,-1).trim().toUpperCase();let i=0;for(;;){const t=e.get("VAR");if(!t)break;if(this.pushBytecode(t.val),i++,!e.get("COMMA"))break}return e.expect("PAR_CLOSE",`Lors de la d√©finition de la fonction "${r}", ses arguments doivent tous √™tres des variables.`),this.pushBytecode(i,this.$makeArray,r),this.labelPushItsValue(t),this.pushBytecode(this.$def),this.pushJump(n),e.expect("BRA_OPEN",["Il faut une accolade ouvrante pour d√©finir un bloc, comme dans cet exemple :","DEF DESSINER() {","  DISK(200)","}"].join("\n")),this.labelStickHere(t),this.parseBloc(),e.expect("BRA_CLOSE",["Il faut une accolade fermante √† la fin d'un bloc, comme dans cet exemple :","DEF DESSINER() {","  DISK(200)","}"].join("\n")),this.pushBytecode(0,this.$return),this.labelStickHere(n),!0}function A(){const e=this.lexer.get("NUM");return!!e&&(this.pushBytecode(Number(e.val)),!0)}function S(){const e=this.lexer.get("STR");return!!e&&(this.pushBytecode(e.val.slice(1,-1)),!0)}function C(){const e=this.lexer.get("HEX");return!!e&&(this.pushBytecode(Number(`0x${e.val.trim().slice(1)}`)),!0)}function w(){var e;const t=null!==(e=this.lexer.get("VAR"))&&void 0!==e?e:this.lexer.get("GLOBAL_VAR");return!!t&&(this.pushBytecode(t.val),this.pushFunction(this.$getVar,t),!0)}function R(){const{lexer:e}=this;if(!e.get("SQR_OPEN"))return!1;let t=0;for(;this.parseExpression()&&(t++,e.get("COMMA")););return e.expect("SQR_CLOSE","Il manque un crochet fermant √† la fin de la liste."),this.pushBytecode(t,this.$makeArray),!0}function N(){return!!T.call(this)&&(this.pushBytecode(this.$slice),!0)}function T(){const{lexer:e}=this;if(!e.get("SQR_OPEN"))return!1;let t=0;for(;this.parseExpression()&&(t++,e.get("COMMA")););return e.expect("SQR_CLOSE","Il manque un crochet fermant √† la fin de la liste."),(t<0||t>2)&&e.fatal(`L'op√©rateur slice attend z√©ro, un ou deux argument, pas ${t}.`),this.pushBytecode(t,this.$makeArray),!0}var $=n(1858),O=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))};class L{constructor(e){this.kernel=e,this.labels=new l,this.bytecode=[],this.stack=[],this.callStack=[],this.functionsDefinitions=new Map,this.lexer=new s.F(""),this.cursor=0,this.code="",this.parseAffectation=E.bind(this),this.parseBinaryOperator=x.bind(this),this.parseBloc=d.bind(this),this.parseDef=I.bind(this),this.parseExpression=y.bind(this),this.parseExpressionBlock=v.bind(this),this.parseForIn=m.bind(this),this.parseFunction=b.bind(this),this.parseIf=f.bind(this),this.parseInstruction=p.bind(this),this.parseList=R.bind(this),this.parseReturn=h.bind(this),this.parseWhile=g.bind(this),this.parseNumber=A.bind(this),this.parseSlicer=N.bind(this),this.parseSlicerArguments=T.bind(this),this.parseString=S.bind(this),this.parseHexa=C.bind(this),this.parseVar=w.bind(this),this.$def=k("DEF",(()=>{const e=this.popNum(),t=this.popStr(),n=this.popArr();(0,r.j)(n,["array","string"],`${t}()`),this.functionsDefinitions.set(t,{cursor:e,args:n})})),this.$return=k("RETURN",(()=>{const e=this.callStack.pop();(0,r.Et)(e)||this.fatal("Call stack is empty!"),this.cursor=e,this.kernel.subroutineExit()})),this.$jump=k("JMP",(()=>{this.cursor=this.popNum()})),this.$jumpIfZero=k("JMP",(()=>{const e=this.popNum();0===this.pop()&&(this.cursor=e)})),this.$setVar=k("setVar(name, value)",(()=>{const e=this.pop(),t=this.popStr();this.kernel.setVar(t,e)})),this.$setElem=k("setVar(name, slicer, value)",(()=>{const e=this.pop(),t=this.popArr(),n=this.popStr(),s=this.kernel.getVar(n);if((0,r.Et)(s))throw new Error(`La variable ${n} est un nombre (${s}).\nOn ne peut donc pas lui assigner d'√©l√©ment.`);if(t.length<2){const[i]=t;let o=(0,r.Et)(i)?Math.floor(i):s.length;if(o<0&&(o+=s.length),o=(0,$.O6b)(o,0,s.length),Array.isArray(s))return void(s[o]=e);this.kernel.setVar(n,s.slice(0,o)+_(e)+s.slice(o+1))}else{let[i,o]=t.map((e=>Math.round((0,r.GB)(e,0)))).map((e=>e<0?e+s.length:e)).map((e=>(0,$.O6b)(e,0,s.length-1)));if(i>o){const e=i;i=o,o=e}if(Array.isArray(s)){const t=s.slice(0,i),r=s.slice(o+1),a=Array.isArray(e)?[...t,...e,...r]:[...t,e,...r];this.kernel.setVar(n,a)}else this.kernel.setVar(n,s.slice(0,i)+_(e)+s.slice(o+1))}})),this.$setVars=k("setVar(name, value)",(()=>{const e=this.pop();Array.isArray(e)||this.lexer.fatal(`Je ne peux desctructurer que des listes.\nMais j'ai re√ßu ${JSON.stringify(e)}.`);const t=this.popArr();for(let n=0;n<t.length;n++){const s=t[n];(0,r.Kg)(s)&&this.kernel.setVar(s,e[n])}})),this.$getVar=k("getVar(name)",(()=>{var e;const t=this.popStr();this.stack.push(null!==(e=this.kernel.getVar(t))&&void 0!==e?e:0)})),this.$neg=k("neg(...)",(()=>{var e=this.popNum();this.stack.push(-e)})),this.$makeArray=k("makeArray(count, ...)",(()=>{const e=this.popNum(),t=this.stack.splice(this.stack.length-e,e);this.stack.push(t)})),this.$slice=k("slice[...]",(()=>{const[e,t]=this.popArr();(0,r.Et)(e)||this.lexer.fatal(`Le premier argument d'un operateur slice doit ƒìtre un nombre et pas ${JSON.stringify(e)}.`),(0,r.Et)(t)||void 0===t||this.lexer.fatal(`Le deuxieme argument d'un operateur slice, s'il est d√©fini, doit ƒìtre un nombre et pas ${JSON.stringify(t)}.`);const n=this.pop();(0,r.Kg)(n)||Array.isArray(n)?void 0===t?(0,r.Kg)(n)?this.stack.push(n.slice(e,e+1)):e<0?this.stack.push(n[n.length+e]):this.stack.push(n[e]):-1===t?this.stack.push(n.slice(e)):this.stack.push(n.slice(e,t+1)):this.stack.push(n)})),this.$function=()=>O(this,void 0,void 0,(function*(){const{kernel:e}=this,t=this.popStr(),n=this.popArr();if(e.hasFunction(t)){const s=yield e.executeFunction(t,n);return void this.stack.push(s)}const s=this.functionsDefinitions.get(t);if(!s)throw new Error(`La fonction "${t.toUpperCase()}" n'existe pas.\nLes fonctions disponibles sont: ${[Array.from(this.functionsDefinitions.keys()).map((e=>{var t;return`${e}(${null===(t=this.functionsDefinitions.get(e))||void 0===t?void 0:t.args.join(", ")})`})),...this.kernel.functionsNames].join(", ")}.`);if(n.length!==s.args.length)throw new Error(`La fonction ${t}(${s.args.join(", ")}) attend ${s.args.length} argument${s.args.length>1?"s":""}, pas ${n.length}.`);this.kernel.subroutineEnter(s.args,n,null),this.callStack.push(this.cursor),this.cursor=s.cursor})),this.$procedure=()=>O(this,void 0,void 0,(function*(){const e=this.popStr(),t=this.popArr();if(!(yield this.kernel.executeProcedure(e,t))){const n=this.functionsDefinitions.get(e);if(!n)throw new Error(`La proc√©dure "${e.toUpperCase()}" n'existe pas.\nLes proc√©dures disponibles sont: ${[Array.from(this.functionsDefinitions.keys()).map((e=>{var t;return`${e}(${null===(t=this.functionsDefinitions.get(e))||void 0===t?void 0:t.args.join(", ")})`})),...this.kernel.proceduresNames].join(", ")}.`);if(t.length!==n.args.length)throw new Error(`La fonction ${e}(${n.args.join(", ")}) attend ${n.args.length} argument${n.args.length>1?"s":""}, pas ${t.length}.`);this.kernel.subroutineEnter(n.args,t,(()=>this.stack.pop())),this.callStack.push(this.cursor),this.cursor=n.cursor}})),this.$if=k("IF ... ELSE",(()=>{const e=this.popNum();0===this.pop()&&(this.cursor=e)})),this.$forIn=k("FOR ... IN",(()=>{const[e,t,n,s]=this.stack.slice(-4),i=(0,r.Kg)(t)?t.split(""):t;if(!Array.isArray(i))throw new Error(["Apr√®s le IN, il me faut une liste ou une chaine.",`Mais j'ai re√ßu √ßa : ${JSON.stringify(i)}.`].join("\n"));if(!(0,r.Kg)(e))throw new Error("Internal error! VarName must be a number.");if(!(0,r.Et)(n))throw new Error("Internal error! Index must be a number.");if(!(0,r.Et)(s))throw new Error("Internal error! JumpOut must be a number.");if(n>=i.length)return this.stack.splice(-4,4),void(this.cursor=s);this.kernel.setVar(e,i[n]),this.stack[this.stack.length-2]=n+1}))}execute(e){return O(this,void 0,void 0,(function*(){try{this.code=e,console.log(e),this.compile(),this.link()}catch(e){console.error(e),console.log("Byte code:",this.bytecode),o("Erreur de compilation !",i(e)?e:{code:this.code,pos:this.bytecode[this.cursor].pos,msg:`${e}`})}try{this.stack.splice(0,this.stack.length);const{bytecode:e,stack:t}=this;for(this.cursor=0,u.E.state.running.value=!0;this.cursor<e.length&&u.E.state.running.value;){const n=e[this.cursor++].val;"function"==typeof n?yield n():t.push(n)}this.kernel.debugVariables()}catch(e){console.error(e),console.log("Cursor:",this.cursor),console.log("Byte code:",this.bytecode),console.log("Stack:",this.stack),o("Erreur d'execution !",i(e)?e:{code:this.code,pos:this.bytecode[this.cursor-1].pos,msg:`${e}`})}finally{this.kernel.paint(),u.E.state.running.value=!1,this.kernel.music.stop()}}))}compile(){this.labels.reset(),this.bytecode.splice(0,this.bytecode.length);const e=new s.F(this.code);for(console.log("Tokens:",e.all()),e.next(),this.lexer=e;e.hasMoreCode();)this.parseBloc()||e.fatal("Caract√®re inattendu ! Je suis perdu...");this.pushBytecode("<<EOF>>"),console.log("Compiled!",this.bytecode)}link(){this.labels.apply(this.bytecode),this.debugBytecode()}fatal(e){const t=this.bytecode[this.cursor];throw t&&console.error(e,t),new Error(e)}pushBytecode(...e){for(const t of e)this.bytecode.push({pos:this.lexer.token.pos,val:t})}pushFunction(e,t){this.bytecode.push({pos:(null!=t?t:this.lexer.token).pos,val:e})}pushJump(e){this.labelPushItsValue(e),this.pushBytecode(this.$jump)}pushJumpIfZero(e){this.labelPushItsValue(e),this.pushBytecode(this.$jumpIfZero)}labelPushItsValue(e){this.pushBytecode(0),this.labels.link(this.bytecode.length-1,e)}labelStickHere(e){return this.labels.stick(e,this.bytecode.length)}labelCreate(e=""){return this.labels.create(e)}parseAny(...e){for(const t of e)if(t())return!0;return!1}pop(){const e=this.stack.pop();return null!=e?e:0}popStr(){const e=this.stack.pop();return(0,r.Kg)(e)?e:JSON.stringify(e)}popNum(){const e=this.stack.pop();if((0,r.Et)(e))return e;throw new Error(`J'attendais un nombre ici, mais j'ai re√ßu : ${JSON.stringify(e)}`)}popArr(){const e=this.stack.pop();return(0,r.Kg)(e)?e.split(""):Array.isArray(e)?e:(console.error("We were expecting an array, but got:",e),[])}makeBinOp(e){return k(e,(()=>{const t=this.pop(),n=this.pop(),s=a[e.toUpperCase()];s||this.lexer.fatal(`Unimplemented binary operator: "${e}"!`);const r=s(n,t);this.stack.push(r)}))}debugBytecode(){const e=this.labels.getLabelsMaxLength(),t=this.bytecode.map((({val:e},t)=>{if((0,r.Tn)(e))return`CALL ${e.name}`;const n=this.labels.getLinkAtCursor(t);return n?`LINK ${n}  ->  ${JSON.stringify(e)}`:`PUSH ${JSON.stringify(e)}`})).map(((t,n)=>`${`${n}`.padStart(6," ")}. ${this.labels.getLabelAtCursor(n).padEnd(e)} ${t}`));console.info(t.join("\n"))}}function k(e,t){return{[e]:()=>new Promise(((e,n)=>{try{t()}catch(e){n(e)}e()}))}[e]}function _(e){return(0,r.Kg)(e)?e:JSON.stringify(e)}function M(e){return new L(e)}},7882:(e,t,n)=>{n.d(t,{P:()=>o});var s=n(3185);const r={confirmCopyCode:"Es-tu s≈´r de vouloir remplacer to programme courant avec celui-ci ?",confirmCopyCodeYes:"Oui !",confirmCopyCodeNo:"Laisse tomber",dblClickOnCode:"Double clique pour utiliser ce code",nextChapter:"Chapitre suivant :",prevChapter:"Chapitre pr√©c√©dent :",typeArray:"liste",typeNumber:"nombre",typeString:"texte",typeUnknown:"type inconnu"},i={confirmCopyCode:"Are you sure you want to replace your current program with this one?",confirmCopyCodeYes:"Sure!",confirmCopyCodeNo:"No, drop it",dblClickOnCode:"Double click to use this code",nextChapter:"Next chapter:",prevChapter:"Previous chapter:",typeArray:"list",typeNumber:"number",typeString:"text",typeUnknown:"unknown type"};function o(){return"en"===s.E.state.lang.value?i:r}}}]);