require("kernel",function(r,t,n){function i(r,t){r.width=f,r.height=_;var n=new u(r,{alpha:!0,antialias:!1,preserveDrawingBuffer:!0}),e=n.gl;this._gl=e,this._renderer=n,o.call(this);var a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,8,1,0,e.RGBA,e.UNSIGNED_BYTE,this._pencils),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this._texPencils=a;var E=e.createTexture();e.bindTexture(e.TEXTURE_2D,E),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,256,256,0,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this._texSymbols=E,this._prgTri=new u.Program(e,{vert:s.vert,frag:s.frag}),this._prgDisk=new u.Program(e,{vert:s.vertDisk,frag:s.fragDisk}),this._prgSprite=new u.Program(e,{vert:s.vertSprite,frag:s.fragSprite}),this._arrVertices=new l,this._bufVertexAttribs=e.createBuffer();var c=this;this.stop=n.stop.bind(n),this.start=n.start.bind(n),n.start(function(r){e.colorMask(!0,!0,!0,!0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,f,_),"function"==typeof c._render&&c._render(r,c)}),this._render=function(r,t){},Object.defineProperty(i.prototype,"render",{get:function(){return this._render},set:function(r){this._render=r},configurable:!0,enumerable:!0})}function e(r){var t=this._gl,n=this._prgTri;n.use(),t.bindBuffer(t.ARRAY_BUFFER,this._bufVertexAttribs);var i=this._arrVertices.array;t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW);var e=i.BYTES_PER_ELEMENT,o=6*e,a=t.getAttribLocation(n.program,"attPosition");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,o,0);var s=t.getAttribLocation(n.program,"attColor");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,4,t.FLOAT,!1,o,2*e),t.drawArrays(r,0,this._arrVertices.length/6),this.clearPoints()}function o(){this._pencils=new Uint8Array([0,0,0,0,255,255,255,255,255,0,0,255,0,255,0,255,0,0,255,255,0,255,255,255,255,0,255,255,255,255,0,255])}var a=function(){function t(){return i(n,arguments)}var n={en:{},fr:{}},i=r("$").intl;return t.all=n,t}(),s={vert:"attribute vec2 attPosition;\r\nattribute vec4 attColor;\r\n\r\nconst float W = 2.0 / 640.0;\r\nconst float H = 2.0 / 480.0;\r\n\r\nvarying vec4 varColor;\r\n\r\nvoid main() {\r\n  varColor = attColor;\r\n  gl_Position = vec4( attPosition.x * W - 1.0, attPosition.y * H - 1.0, 0.0, 1.0 );\r\n}\r\n",frag:"precision mediump float;\r\n\r\nvarying vec4 varColor;\r\n\r\nvoid main() {\r\n  gl_FragColor = varColor;\r\n}\r\n",vertSprite:"// attPosition.x is +1 or -1\r\n// attPosition.y is +1 or -1\r\nattribute vec2 attPosition;\r\n\r\n// In Tlk-space: 640x480.\r\nuniform float uniDstW;\r\nuniform float uniDstH;\r\nuniform float uniCenterX;\r\nuniform float uniCenterY;\r\n\r\n\r\nconst float W = 2.0 / 640.0;\r\nconst float H = 2.0 / 480.0;\r\n\r\n\r\nvarying vec2 varUV;\r\n\r\n\r\nvoid main() {\r\n  float cx = uniCenterX * W - 1.0;\r\n  float cy = uniCenterY * H - 1.0;\r\n  float x = attPosition.x * uniDstW * W;\r\n  float y = attPosition.y * uniDstH * H;\r\n\r\n  gl_Position = vec4( cx + x, cy + y, 0.0, 1.0 );\r\n  varUV = vec2( attPosition.x + .5, attPosition.y + .5 );\r\n}\r\n",fragSprite:"precision mediump float;\r\n\r\n// The symbols' page.\r\nuniform sampler2D texSymbols;\r\n// The pencils used.\r\nuniform sampler2D texPencils;\r\n\r\n// Coords of the current pixel. (0,0) is le left bottom one and (1,1) is the upper right one.\r\nvarying vec2 varUV;\r\n\r\n// In pixels of the symbols' page.\r\nuniform float uniSrcX;\r\nuniform float uniSrcY;\r\nuniform float uniSrcW;\r\nuniform float uniSrcH;\r\n\r\nconst float UNIT = 1.0 / 256.0;\r\n\r\nvoid main() {\r\n  float x = ( varUV.x * uniSrcW + uniSrcX ) / 256.0;\r\n  float y = ( (1.0 - varUV.y) * uniSrcH + uniSrcY ) / 256.0;\r\n  float color = texture2D( texSymbols, vec2( x, y ) ).r;\r\n  // color is between 0 and 7 * UNIT.\r\n  // The palette index is coded on the RED composant of texPencils.\r\n  gl_FragColor = texture2D( texPencils, vec2(color * 32.0, .5) );\r\n}\r\n",vertDisk:"uniform float uniX;\r\nuniform float uniY;\r\nuniform float uniW;\r\nuniform float uniH;\r\n\r\nattribute vec2 attPosition;\r\n\r\nconst float W = 2.0 / 640.0;\r\nconst float H = 2.0 / 480.0;\r\n\r\nvarying vec2 varPosition;\r\n\r\nvoid main() {\r\n  varPosition = attPosition;\r\n  float x = (uniX + attPosition.x * uniW) * W - 1.0;\r\n  float y = (uniY + attPosition.y * uniH) * H - 1.0;\r\n  gl_Position = vec4( x, y, 0.0, 1.0 );\r\n}\r\n",fragDisk:"precision mediump float;\r\n\r\nuniform float uniR;\r\nuniform float uniG;\r\nuniform float uniB;\r\nuniform float uniA;\r\nvarying vec2 varPosition;\r\n\r\nvoid main() {\r\n  float radius = varPosition.x * varPosition.x + varPosition.y * varPosition.y;\r\n  if (radius > 1.0) gl_FragColor = vec4(0.0,0.0,0.0,0.0);\r\n  else gl_FragColor = vec4(uniR, uniG, uniB, uniA);\r\n}\r\n"},u=r("tfw.webgl"),l=(r("keyboard"),r("vertex-buffer")),f=640,_=480;t.exports=i,i.prototype.clearPoints=function(){this._arrVertices.reset()},i.prototype.point=function(r,t,n){n=this.expandColor(n),this._arrVertices.push(r,t,n[0],n[1],n[2],n[3])},i.prototype.expandColor=function(r){var t=17*(15&r);r>>=4;var n=17*(15&r);r>>=4;var i=17*(15&r);return r>>=4,[i/255,n/255,t/255,(255-17*r)/255]},i.prototype.triangles=function(){e.call(this,this._gl.TRIANGLES)},i.prototype.triStrip=function(){e.call(this,this._gl.TRIANGLE_STRIP)},i.prototype.triFan=function(){e.call(this,this._gl.TRIANGLE_FAN)};var E=new Float32Array([-.5,-.5,.5,-.5,-.5,.5,.5,.5]);i.prototype.sprite=function(r,t,n,i,e,o,a,s,u,l){void 0===s&&(s=1),void 0===u&&(u=1),void 0===l&&(l=0),void 0===o&&(o=16),void 0===a&&(a=16);var f=this._gl,_=this._prgSprite;_.use(),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA),_.$uniCenterX=i,_.$uniCenterY=e,_.$uniDstW=o,_.$uniDstH=a,_.$uniSrcX=t,_.$uniSrcY=n,_.$uniSrcW=o,_.$uniSrcH=a,_.$texSymbols=0,f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,this._texSymbols),_.$texPencils=1,f.activeTexture(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,this._texPencils),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,8,1,0,f.RGBA,f.UNSIGNED_BYTE,this._pencils),f.bindBuffer(f.ARRAY_BUFFER,this._bufVertexAttribs);var c=E;f.bufferData(f.ARRAY_BUFFER,c,f.STATIC_DRAW);var T=c.BYTES_PER_ELEMENT,v=2*T,A=f.getAttribLocation(_.program,"attPosition");f.enableVertexAttribArray(A),f.vertexAttribPointer(A,2,f.FLOAT,!1,v,0),f.drawArrays(f.TRIANGLE_STRIP,0,4)};var c=new Float32Array([-1,-1,1,-1,-1,1,1,1]);i.prototype.disk=function(r,t,n,i,e,o,a,s,u){var l=this._gl,f=this._prgDisk;f.use(),l.enable(l.BLEND),l.blendFunc(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA),f.$uniX=r,f.$uniY=t,f.$uniW=n,f.$uniH=i,f.$uniR=o,f.$uniG=a,f.$uniB=s,f.$uniA=u,l.bindBuffer(l.ARRAY_BUFFER,this._bufVertexAttribs);var _=c;l.bufferData(l.ARRAY_BUFFER,_,l.STATIC_DRAW);var E=_.BYTES_PER_ELEMENT,T=2*E,v=l.getAttribLocation(f.program,"attPosition");l.enableVertexAttribArray(v),l.vertexAttribPointer(v,2,l.FLOAT,!1,T,0),l.drawArrays(l.TRIANGLE_STRIP,0,4)},i.prototype.pen=function(r,t){var n=this._pencils;t=this.expandColor(t),t.forEach(function(t,i){n[4*r+i]=255*t})},i.prototype.blend=function(r){var t=this._gl;r?t.enable(t.BLEND):t.disable(t.BLEND)},t.exports._=a});
//# sourceMappingURL=kernel.js.map