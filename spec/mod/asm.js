require("asm",function(t,s,r){function i(t){var s,r,i,e,h=this.popAsNumber();if(0===h)s=0,r=0,i=640,e=480;else if(1==h)i=this.popAsNumber(),e=i,s=this.get("X")-i/2,r=this.get("Y")-e/2;else if(2==h)e=this.popAsNumber(),i=this.popAsNumber(),s=this.get("X")-i/2,r=this.get("Y")-e/2;else if(3==h)e=this.popAsNumber(),i=e,r=this.popAsNumber(),s=this.popAsNumber();else{for(;h-- >4;)this.pop();e=this.popAsNumber(),i=this.popAsNumber(),r=this.popAsNumber(),s=this.popAsNumber()}return this.kernel&&(console.info("box() color=",t),this.kernel.point(s,r,t),this.kernel.point(s+i,r,t),this.kernel.point(s,r+e,t),this.kernel.point(s+i,r+e,t),this.kernel.triStrip()),i*e/256}function e(t,s,r){this.kernel.blend(!1),this.kernel.point(t-8,s-8,r),this.kernel.point(t+8,s-8,r),this.kernel.point(t-8,s+8,r),this.kernel.point(t+8,s+8,r),this.kernel.triStrip(),this.kernel.blend(!0)}function h(t,s){if(void 0===t&&(t=function(){return!0}),void 0===s&&(s=function(t){return t}),0===this.get("ask.txt")){this.set("ask.txt",""),this.set("ask.cursor",Date.now());for(var r=this.popArgs(),i=r.join("\n"),h=0;h<i.length;h++)this.printChar(i.charCodeAt(h));return this._cursor--,this.skipFrame()}var o=this.get("x"),p=this.get("y"),u=(this.get("sx"),this.get("sy"),(Date.now()-this.get("ask.cursor"))%1e3),a=this.get("pen"),f=a[u<500?1:0];e.call(this,o,p,f);var c=n.last();if(!c)return this._cursor--,this.skipFrame();var l=c.key;if(1==l.length&&t(l)){n.test("SHIFT")||(l=l.toLowerCase()),this.set("ask.txt",this.get("ask.txt")+l);var m=l.charCodeAt(0);f=a[0],e.call(this,o,p,f),this.kernel.sprite(0,m%16*16,16*Math.floor(m/16),this.get("X"),this.get("Y"),16,16,1,1,0),o=this.get("X")+16,o>639&&(o-=640,this.set("Y",this.get("Y")-16)),this.set("X",o)}else if("BACKSPACE"==l&&this.get("ask.txt").length>0){f=a[0],e.call(this,o,p,f);var A=this.get("ask.txt");this.set("ask.txt",A.substr(0,A.length-1)),o=this.get("X")-16,o<0&&(o+=640,(p=this.get("Y")+16)>479&&(p-=480,this.set("Y",p))),this.set("X",o)}else if("ENTER"==l)return f=a[0],e.call(this,o,p,f),this.push(s(this.get("ask.txt"))),this.set("X",8),this.set("Y",this.get("Y")-16),this.set("ask.txt",0),0;return this._cursor--,this.skipFrame()}function o(t){return!isNaN(parseFloat(t))&&isFinite(t)}var p=function(){function s(){return i(r,arguments)}var r={en:{},fr:{}},i=t("$").intl;return s.all=r,s}(),n=t("keyboard"),u=t("speak"),a=function(t,s,r){var i=this;this._bytecode=t,this._cursor=0,this._cost=0,this.runtime=r||{stack:[],vars:{pen:[61440,4095,3840,240,15,255,3855,4080],x:8,y:472,sx:1,sy:1,r:0,cursor:1}},Object.defineProperty(a.prototype,"kernel",{get:function(){return this._kernel},set:function(t){this._kernel=t,i.runtime.vars.pen.forEach(function(s,r){t.pen(r,s)})},configurable:!0,enumerable:!0}),void 0!==s&&(this.kernel=s)};s.exports=a,a.prototype.printChar=function(t){var s=this.get("X"),r=this.get("Y");if(10==t)return this.set("X",8),r-=16*this.get("SY"),r<0&&(r+=480),void this.set("Y",r);"^~°`´¨".indexOf(String.fromCharCode(t))!=-1&&(s-=16*this.get("SX"),s<0&&(s+=640,r+=16*this.get("SY"),r>479&&(r-=480),this.set("y",r)),this.set("x",s));var i=(15&t)<<4;t>>=4;var e=(15&t)<<4;t>>=4;var h=t;this.kernel.sprite(h,i,e,s,r,16,16,this.get("SX"),this.get("SY"),this.get("R")),s+=16*this.get("SX"),s>639?(this.set("x",s-640),r-=16*this.get("SY"),r<0&&(r+=480),this.set("y",r)):this.set("X",s)},a.prototype.reset=function(){this._cost=0,this._cursor=0},a.prototype.next=function(t){t?this.runtime=t:t=this.runtime;for(var s,r;this._cost<2e4;){if(this._cursor>=this._bytecode.length)return!1;s=this._bytecode[this._cursor++],"function"==typeof s?(r=parseInt(s.call(this)),isNaN(r)&&(r=0),this._cost+=r):(this._cost++,this.push(s))}return this._cost-=2e4,!0},a.prototype.push=function(t){this._cost++,this.runtime.stack.push(t)},a.prototype.pop=function(t){if(0!=this.runtime.stack.length)return this._cost++,this.runtime.stack.pop()},a.prototype.exists=function(t){return void 0!==this.runtime.vars[(""+t).trim().toLowerCase()]},a.prototype.popAsNumber=function(){this._cost++;var t=parseFloat(this.pop()||0);return isNaN(t)?0:t},a.prototype.popArgs=function(t){void 0===t&&(t=Number.MAX_VALUE),t=Math.max(0,Math.floor(t));for(var s=this.popAsNumber();s>t;)this.pop(),s--;for(var r=[];s-- >0;)r.unshift(this.pop());return r},a.prototype.get=function(t){t=""+t;var s=this.runtime.vars[t.trim().toLowerCase()];return void 0===s&&(s=0),this._cost+=2,s},a.prototype.set=function(t,s){t=""+t,this.runtime.vars[t.trim().toLowerCase()]=s,this._cost+=3},a.prototype.erase=function(t){t=""+t,delete this.runtime.vars[t.trim().toLowerCase()]},a.prototype.getAsNumber=function(t){t=""+t;var s=parseFloat(this.runtime.vars[t.trim().toLowerCase()]);return isNaN(s)?0:s},a.prototype.isNumber=function(t){if("number"==typeof t)return!0;var s=parseFloat(t);return!isNaN(s)},a.prototype.asNumber=function(t){if("number"==typeof t)return t;var s=parseFloat(t);return isNaN(s)?0:s},a.prototype.skipFrame=function(t){return void 0===t&&(t=1),this._cost=2e4*t,0},a.SPEAK=function(){var t=""+this.pop();return u.speak(t),10},a.LEN=function(){var t=this.pop(),s=0;return Array.isArray(t)||"string"==typeof t?s=t.length:"number"==typeof t&&(s=(""+t).length),this.push(s),1},a.COLOR=function(){var t=this.popArgs(4);t.map(function(t){var s=parseInt(t);for(isNaN(s)&&(s=0),s%=16;s<0;)s+=16;return s});var s=0;switch(t.length){case 1:s=273*t[0];break;case 2:s=273*t[0]+4096*(15-t[3]);break;case 3:s=256*t[0]+16*t[1]+t[2];break;case 4:s=256*t[0]+16*t[1]+t[2]+4096*(15-t[3])}return this.push(s),1},a.DISK=function(){var t=this.get("x"),s=this.get("y"),r=this.get("pen")[1],i=this.kernel.expandColor(r),e=this.popArgs(3),h=100,o=100,p=0;return 1==e.length?(h=parseFloat(e[0]),o=h):2==e.length?(h=parseFloat(e[0]),o=parseFloat(e[1])):3==e.length&&(h=parseFloat(e[0]),o=parseFloat(e[1]),p=parseFloat(e[2])),this.kernel.disk(t,s,h,o,p,i[0],i[1],i[2],i[3]),h*o/256},a.COS=function(){var t=this.popAsNumber()*Math.PI/180;return this.push(Math.cos(t)),15},a.SIN=function(){var t=this.popAsNumber()*Math.PI/180;return this.push(Math.sin(t)),15},a.ASC=function(){var t=this.pop();if("number"==typeof t||"string"==typeof t){var s=(""+t).charCodeAt(0);this.push(s)}else this.push(0);return 0},a.CHR=function(){var t=this.popArgs(),s="";return t.forEach(function(t){s+=String.fromCharCode(parseInt(t)||0)}),this.push(s),0},a.SHIFT=function(){var t=""+this.pop(),s=this.get(t);return Array.isArray(s)?s.length>0?(this.push(s.shift()),this.set(t,s)):this.push(0):(s=""+s,this.push(s.charAt(0)),this.set(t,s.substr(1))),1},a.FRAME=function(){var t=this.popAsNumber();return t<1?0:2e4*t-this._cost},a.INK=function(){var t=Math.floor(this.popAsNumber()),s=Math.floor(this.popAsNumber()),r=Math.floor(this.popAsNumber())%64;t==-1&&(t=s);var i=t%16;t>>=4;var e=t%16;t>>=4;var h=t%16,o=s%16;s>>=4;var p=s%16;s>>=4;var n=s%16;return this.kernel&&this.kernel.ink(r,n,p,o,h,e,i),1},a.POINT=function(){var t=this.popAsNumber(),s=this.popAsNumber(),r=this.popAsNumber();return this.kernel&&this.kernel.point(r,s,t),5},a.TRIS=function(){return this.kernel&&this.kernel.triangles(),10},a.TRIANGLE=function(){var t=this.popAsNumber(),s=this.popAsNumber(),r=this.popAsNumber(),i=this.popAsNumber(),e=this.popAsNumber(),h=this.popAsNumber(),o=this.get("pen")[1];return this.kernel&&(this.kernel.point(h,e,o),this.kernel.point(i,r,o),this.kernel.point(s,t,o),this.kernel.triangles()),25},a.BOX=function(){return i.call(this,this.get("pen")[1])},a.CLS=function(){this.kernel.blend(!1);var t=i.call(this,this.get("pen")[0]);return this.kernel.blend(!0),t},a.BACK=function(){var t=this.popAsNumber(),s=this.popAsNumber(),r=this.kernel.expandColor(s);document.body.style.transition="background "+t+"ms",document.body.style.background="rgb("+255*r[0]+","+255*r[1]+","+255*r[2]+")"},a.RND=function(){var t=this.popAsNumber();if(0==t)this.push(Math.random());else{var s=this.popAsNumber();if(1==t)this.push(Math.ceil(Math.random()*s));else{var r=this.popAsNumber();if(r<s){var i=s;s=r,r=i}for(this.push(Math.floor(s+Math.random()*(1+r-s)));t>2;)this.pop(),t--}}return 2},a.WAIT=function(){var t=n.last();return t?(this.push(t.key),0):(this._cursor--,2e4-this._cost)},a.ASK=function(){h.call(this)},a.ASKNUM=function(){h.call(this,function(t){return"0123456789.-".indexOf(t)!=-1},function(t){return parseFloat(t)})},a.DEC=function(){var t=""+this.pop(),s=this.get(t)-1;return this.set(t,s),this.push(s),1},a.INC=function(){var t=""+this.pop(),s=this.get(t)+1;return this.set(t,s),this.push(s),1},a.VARADD=function(){var t=""+this.pop(),s=this.pop(),r=this.get(t);return Array.isArray(r)?Array.isArray(s)?r.push.apply(r,s):r.push(s):r+=s,this.set(t,r),this.push(r),1},a.PEN=function(){for(var t,s,r=this.get("pen"),i=this.popAsNumber();i-- >0;)t=Math.abs(Math.floor(this.popAsNumber())),s=7&i,this.kernel.pen(s+1,t),r[s+1]=t;return 7},a.PAPER=function(){var t=this.get("pen"),s=Math.abs(Math.floor(this.popAsNumber()));return this.kernel.pen(0,s),t[0]=s,1},a.GET=function(){var t=""+this.pop(),s=this.get(t);return this.push(s),0},a.SET=function(){var t=""+this.pop(),s=this.pop();return this.set(t,s),0},a.JMP=function(){var t=this.popAsNumber();return this._cursor=t,1},a.JZE=function(){var t=this.popAsNumber();return 0==this.popAsNumber()&&(this._cursor=t),1},a.JNZ=function(){var t=this.popAsNumber();return 0!=this.popAsNumber()&&(this._cursor=t),1},a.JGT=function(){var t=this.popAsNumber(),s=this.popAsNumber();return this.popAsNumber()>s&&(this._cursor=t),0},a.JLT=function(){var t=this.popAsNumber(),s=this.popAsNumber();return this.popAsNumber()<s&&(this._cursor=t),0},a.JGE=function(){var t=this.popAsNumber(),s=this.popAsNumber();return this.popAsNumber()>=s&&(this._cursor=t),0},a.JLE=function(){var t=this.popAsNumber(),s=this.popAsNumber();return this.popAsNumber()<=s&&(this._cursor=t),0},a.DEBUGGER=function(){return 0},a.ABS=function(){return this.push(Math.abs(this.popAsNumber())),0},a.NEG=function(){return this.push(-this.popAsNumber()),0},a.ADD=function(){var t=this.pop();if(void 0===t)return void this.push(0);var s=this.pop();return void 0===s?void this.push(t):Array.isArray(s)?(Array.isArray(t)?(s.push.apply(s,t),this.push(s),this._cost+=t.length):(s.push(t),this.push(s)),1):isNaN(s)||isNaN(t)?(s=""+s,t=""+t,this.push(s+t),s.length+t.length+2):(this.push(this.asNumber(s)+this.asNumber(t)),1)},a.MUL=function(){var t=this.pop();t=o(t)?parseFloat(t):""+t;var s=this.pop();if(typeof(s=o(s)?parseFloat(s):""+s)!=typeof t){var r="";if("number"==typeof s){var i=s;s=t,t=i}for(t=Math.min(t,4800);t-- >=1;)r+=s,this._cost++;return this.push(r),2}return this.push(s*t),2},a.DIV=function(){var t=this.popAsNumber(),s=this.popAsNumber();return 0==s?(this.push(0),0):Math.abs(t)<1e-10?(this.push(s>=0?Number.MAX_VALUE:-Number.MAX_VALUE),1):(this.push(s/t),4)},a.SUB=function(){return this.push(-this.popAsNumber()+this.popAsNumber()),1},a.AND=function(){var t=this.popAsNumber(),s=this.popAsNumber(),r=1;return 0==s?r=0:0==t&&(r=0),this.push(r),1},a.OR=function(){var t=this.popAsNumber(),s=this.popAsNumber(),r=0;return 0!=s?r=1:0!=t&&(r=1),this.push(r),1},a.XOR=function(){var t=this.popAsNumber()&&1,s=this.popAsNumber()&&1,r=0;return 0!=s?r=1:0!=t&&(r=1),this.push(r),1},a.GEQ=function(){var t=this.pop(),s=this.pop();return this.push(s>=t?1:0),1},a.LEQ=function(){var t=this.pop(),s=this.pop();return this.push(s<=t?1:0),1},a.GT=function(){var t=this.pop(),s=this.pop();return this.push(s>t?1:0),1},a.LT=function(){var t=this.pop(),s=this.pop();return this.push(s<t?1:0),1},a.MOD=function(){var t=this.popAsNumber(),s=this.popAsNumber();if(Math.abs(t)<1e-10)this.push(0);else{var r=s%t;r<0&&(r+=t),this.push(r)}return 1},a.EXP=function(){var t=this.popAsNumber(),s=this.popAsNumber();return this.push(Math.pow(s,t)),15},a.EQ=function(){var t=this.pop(),s=this.pop();return this.push(s==t?1:0),1},a.NEQ=function(){var t=this.pop(),s=this.pop();return this.push(s!=t?1:0),1},a.ERASE=function(){var t=this.pop();return delete this.erase(t),0},a.KEY=function(){var t=this.popAsNumber();if(0==t)return this.push(0),0;for(var s=1;t-- >0;){var r=""+this.pop();n.test(r)||(s=0)}return this.push(s),1},a.IIF=function(){var t=this.pop(),s=this.pop();return 0==this.popAsNumber()?this.push(t):this.push(s),0},a.FORE=function(){var t=this.popAsNumber(),s=""+this.pop(),r=""+this.pop(),i=""+this.pop(),e=this.get(s),h=parseInt(this.get(r));isNaN(h)&&(h=0);this.get(i);return h>=(e?e.length||0:0)?(this._cursor=t,1):("string"==typeof e?this.set(i,e.charAt(h)):this.set(i,e[h]),this.set(r,h+1),3)},a.FOR=function(){var t,s=Math.floor(this.popAsNumber()),r=this.popAsNumber(),i=this.popAsNumber(),e=this.popAsNumber(),h=this.pop().toLowerCase();return t=this.exists(h)?this.getAsNumber(h)+r:e,this.set(h,t),e=Math.min(e,i),i=Math.max(e,i),(t<e||t>i)&&(this._cursor=s),5},a.LOCATE=function(){for(var t=Math.floor(this.popAsNumber())%30;t<0;)t+=30;for(var s=Math.floor(this.popAsNumber())%40;s<0;)t+=40;return this.set("X",8+(s<<4)),this.set("Y",480-(8+(t<<4))),0},a.MOVE=function(){var t=Math.floor(this.popAsNumber()),s=Math.floor(this.popAsNumber());return this.set("X",s),this.set("Y",t),0},a.MOVER=function(){var t=Math.floor(this.popAsNumber()),s=Math.floor(this.popAsNumber());return this.set("X",s+this.get("X")),this.set("Y",t+this.get("Y")),0},a.SPRITE=function(){var t=this.popAsNumber(),s=this.popAsNumber(),r=this.popAsNumber();if(this.kernel){var i=(15&r)<<4;r>>=4;var e=(15&r)<<4;r>>=4;var h=r;this.kernel.sprite(h,i,e,this.get("X"),this.get("Y"),s<<4,t<<4,this.get("SX"),this.get("SY"),this.get("R"))}return 3*s*t},a.PRINTCHAR=function(){var t=Math.floor(this.popAsNumber());return this.printChar(t),1},s.exports._=p});
//# sourceMappingURL=asm.js.map