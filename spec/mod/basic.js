require("basic",function(t,e,s){function a(t){this._id=0,this.clear(),void 0===t&&(t=""),this._code=t;for(var e=new E(t);e.hasMoreCode();)n.call(this,e,"instruction","affectation")||e.hasMoreCode()&&!e.next("EOL")&&e.fatal("Caractère inattendu ! Je suis perdu...");this._asm.forEach(function(t,e,s){Array.isArray(t)&&(s[e]=this._labels[t[0]])},this)}function n(t){var e,s;for(e=1;e<arguments.length;e++){if(!(s=g[arguments[e].toLowerCase()]))throw Error('Unknonw parser: "'+arguments[e]+'"!');if(s.call(this,t))return!0}return!1}function r(t){t=t.substr(1).toUpperCase();for(var e="0123456789ABCDEF",s=0,a=0;a<t.length;a++)s=(s<<4)+e.indexOf(t.charAt(a));return this._asm.push(s),!0}function i(t){var e=t.next("VAR");e||t.fatal(m("missing-var-after-for"));var s=e.val;if(e=t.next("EQUAL","IN","COMMA"),e||t.fatal(m("missing-for-equal-or-to")),","==e.val){e=t.next("VAR"),e||t.fatal(m("missing-var-index-foreach",s));var a=e.val;return t.next("IN")||t.fatal(m("missing-foreach-in")),l.call(this,t,s,a)}if("IN"==e.val)return l.call(this,t,s);var r=this.newLabel(),i=this.newLabel();return this._asm.push(s,x.ERASE),this.setLabel(r),this._context.push({type:"FOR",labelA:r,labelB:i}),this._asm.push(s),n.call(this,t,"expression")||t.fatal(m("missing-expression")),t.next("TO")||t.fatal(m("missing-to")),n.call(this,t,"expression")||t.fatal(m("missing-expression")),t.next("STEP")?n.call(this,t,"expression")||t.fatal(m("missing-expression")):this._asm.push(1),t.next("EOL")||t.fatal(m("expected-eol")),this._asm.push([i],x.FOR),!0}function l(t,e,s){void 0===s&&(s="tmp"+this.nextID());var a=t.next("VAR");a||t.fatal(m("missing-list-foreach"));var n=a.val,r=this.newLabel(),i=this.newLabel();return this._asm.push(s,x.ERASE),this.setLabel(r),this._context.push({type:"FOR",labelA:r,labelB:i}),this._asm.push(e,s,n,[i],x.FORE),!0}function u(t){var e=this._context.pop();return e||t.fatal(m("unexpected-next")),"FOR"==e.type?(this._asm.push([e.labelA],x.JMP),this.setLabel(e.labelB)):t.fatal(m("unexpected-next")),!0}function o(t){n.call(this,t,"expression")||t.fatal(m("print-missing-arg")),this._asm.push("print.txt",x.SET),t.next("COMMA")?(n.call(this,t,"expression")||t.fatal(m("print-missing-arg")),this._asm.push("print.frm",x.SET)):this._asm.push(0,"print.frm",x.SET),t.next("EOL")||t.fatal(m("expected-eol"));var e=this.newLabel(),s=this.newLabel();return this.setLabel(e),this._asm.push("print.txt",x.GET,x.LEN,[s],x.JZE),this._asm.push("print.txt",x.SHIFT,x.ASC,x.PRINTCHAR),this._asm.push("print.frm",x.GET,x.FRAME),this._asm.push([e],x.JMP),this.setLabel(s),!0}function c(t,e,s){"function"!=typeof x[e]&&t.fatal(m("unknown-function",e));for(var a,r=0;n.call(this,t,"expression")&&(r++,a=t.next("COMMA","PAR_CLOSE","EOL"),a||t.fatal(m("missing-par-close")),"COMMA"==a.id););return 0==r&&(t.next("PAR_CLOSE")||t.fatal(m("missing-par-close"))),"number"==typeof s?s!=r&&t.fatal(m("fixed-args",e,s,r)):this._asm.push(r),this._asm.push(x[e]),!0}function h(t,e){"function"!=typeof x[e]&&t.fatal(m("unknown-instr",e));for(var s,a=0;n.call(this,t,"expression")&&(a++,s=t.next("COMMA","EOL"),s||t.fatal(m("unexpected-token")),"COMMA"==s.id););return this._asm.push(a,x[e]),!0}function p(t,e,s){var a=arguments.length-3;if(s+a>0){var r,i;for(r=0;r<s+a&&(i=!1,r>0&&(i=!t.next("COMMA")),n.call(this,t,"expression"));r++)i&&t.fatal(m("mising-comma"));r<s&&t.fatal(m("too-few-args",e,s)+"\n"+m(e.toLowerCase()));var l,u=r-s;for(r=u;r<a;r++)l=arguments[3+r],Array.isArray(l)?this._asm.push.apply(this._asm,l):this._asm.push(l);t.next("EOL")||t.fatal(m("too-many-args",s,s+a)+"\n"+m("instr-"+e))}return this._asm.push(x[e]),!0}function f(t){t=t.substr(1,t.length-2);for(var e,s="",a=0,n=0,r=0;r<t.length;r++)e=t.charAt(r),0==n?"\\"==e&&(s+=t.substr(a),n=1):(s+="n"==e?"\n":"t"==e?"\t":e,a=r+1,n=1);return s+=t.substr(a)}var m=function(){function e(){return a(s,arguments)}var s={fr:{"expected-eol":"L'instruction devrait s'arrêter là.","fixed-args":"$1 attend exactement $2 argument(s) et pas $3.","missing-comma":"Il faut séparer les arguments par des virgules.","missing-equal":"Après un nom de variable, il faut mettre un '='.","missing-expression":"J'ai besoin d'une expression : c'est-à-dire un nombre, une chaîne de caractères, une variable, un calcul...","missing-expression-after":'Il me faut une expression après "$1".',"missing-for-equal-or-to":"Après le nom de variable, il me faut un égal ou IN.","missing-par-close":"Il manque une paranthèse fermante !","missing-to":"Il faut le mot clef TO dans un FOR pour que ça fonctionne.","missing-var-after-for":"Il faut un nom de variable juste après FOR.","missing-var-index-foreach":"Après la virgule, il me faut la variable qui contiendra l'index du caractère $1.","print-missing-arg":"L'instruction PRINT attend le texte à afficher comme argument.","too-few-args":"L'instruction \"$1\" a besoin d'au moins $2 argument(s).","too-many-args":"Cette instruction attend au minimum $1 argument(s), et au maximum $2.","unexpected-token":"Il y a là un caractère que je ne comprends pas.","unexpected-next":"Ce NEXT ne correspond à aucun FOR.","unknown-function":"Je ne connais aucune fonction appelée $1.","unknown-instr":"Cette instruction m'est inconnue : $1."},en:{}},a=t("$").intl;return e.all=s,e}(),x=t("asm"),E=t("lexer"),v={and:x.AND,or:x.OR,xor:x.XOR,">=":x.GEQ,"<=":x.LEQ,"<>":x.NEQ,"^":x.EXP,"=":x.EQ,"%":x.MOD,"+":x.ADD,"*":x.MUL,"/":x.DIV,"-":x.SUB,"<":x.LT,">":x.GT},A={NL:"\n",PI:Math.PI},_={ABS:1,ASC:1,COS:1,IIF:3,LEN:1,NEG:1,SHIFT:1,SIN:1,WAIT:0};a.prototype.nextID=function(){return this._id++},a.prototype.asm=function(){return this._asm.slice()},a.prototype.clear=function(){this._code="",this._asm=[],this._labels={},this._labelId=0,this._context=[]},a.prototype.newLabel=function(){return this._labelId++},a.prototype.setLabel=function(t){this._labels[t]=this._asm.length};var g={instruction:function(t){var e=t.next("INST");if(!e)return!1;switch(e.val.toUpperCase()){case"LOCATE":return p.call(this,t,"LOCATE",2);case"SPRITE":return p.call(this,t,"SPRITE",1,1,1);case"MOVE":return p.call(this,t,"MOVE",0,320,240);case"MOVER":return p.call(this,t,"MOVER",0,16,0);case"FRAME":return p.call(this,t,"FRAME",0,1);case"POINT":return p.call(this,t,"POINT",2,["color",x.GET]);case"TRIS":return p.call(this,t,"TRIS",0);case"TRIANGLE":return p.call(this,t,"TRIANGLE",0,0,0,320,480,640,0);case"DISK":return h.call(this,t,"DISK");case"BOX":return h.call(this,t,"BOX");case"CLS":return h.call(this,t,"CLS");case"PEN":return h.call(this,t,"PEN");case"PAPER":return p.call(this,t,"PAPER",0,61440);case"FOR":return i.call(this,t);case"NEXT":return u.call(this,t);case"INK":return p.call(this,t,"INK",3,-1);case"PRINT":return o.call(this,t,"PRINT");case"SPEAK":return p.call(this,t,"SPEAK",0,"Je suis TLK-74.");case"BACK":return p.call(this,t,"BACK",0,7,0);case"DEBUGGER":return p.call(this,t,"DEBUGGER",0)}return t.fatal(m("unknown-instr",e.val.toUpperCase())),!1},affectation:function(t){var e=t.next("VAR");if(!e)return!1;var s=e.val;return t.next("EQUAL")||t.fatal(m("missing-equal")),n.call(this,t,"expression")||t.fatal(m("missing-expression")),this._asm.push(s,x.SET),!0},expression:function(t){if(!n.call(this,t,"atom"))return!1;var e=t.next("BINOP");return e&&(n.call(this,t,"expression")||t.fatal(m("missing-expression-after",e.val)),this._asm.push(v[e.val])),!0},atom:function(t){var e=t.next("FUNC","NUM","HEX","STR","VAR","PAR_OPEN","CONST");if(e)switch(e.id){case"NUM":return this._asm.push(parseFloat(e.val)),!0;case"HEX":return r.call(this,e.val);case"STR":return this._asm.push(f(e.val)),!0;case"VAR":return this._asm.push(e.val,x.GET),!0;case"CONST":var s=A[e.val.toUpperCase()];return s||t.fatal(m("unknown-const",e.val)),Array.isArray(s)?this._asm.push.apply(this._asm,s):this._asm.push(s),!0;case"FUNC":var a=e.val.substr(0,e.val.length-1).toUpperCase();return!!c.call(this,t,a,_[a]);case"PAR_OPEN":return n.call(this,t,"expression"),e=t.next("PAR_CLOSE"),e||t.fatal(m("missing-par-close")),!0}return!1}};e.exports=a,e.exports._=m});
//# sourceMappingURL=basic.js.map